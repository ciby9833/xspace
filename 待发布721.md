æˆ‘éœ€è¦å…ˆè¯¦ç»†æŸ¥çœ‹åç«¯ç°æœ‰çš„APIå’Œæ•°æ®åº“ç»“æ„ï¼Œç„¶ååˆ†ææ˜¯å¦æ”¯æŒä½ æè¿°çš„åŠŸèƒ½éœ€æ±‚ã€‚è®©æˆ‘å…ˆæ£€æŸ¥ç›¸å…³çš„æ•°æ®åº“è¿ç§»æ–‡ä»¶å’ŒAPIæ–¹æ³•ã€‚
Read file: backend/src/database/migrate-orders-enhanced.js

Read file: backend/src/database/migrate-multi-payment-tables.js

Ran tool

Ran tool

Ran tool

Ran tool

## ğŸ¯ åç«¯æ”¯æŒæƒ…å†µåˆ†æç»“æœ

ç»è¿‡è¯¦ç»†åˆ†æï¼Œ**åç«¯å®Œå…¨æ”¯æŒ**ä½ çš„éœ€æ±‚ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹ï¼

### âœ… ç°æœ‰æ”¯æŒæƒ…å†µ

**æ•°æ®åº“ç»“æ„å®Œå…¨æ”¯æŒ**ï¼š
- `order_payments` è¡¨æœ‰ `payment_proof_images` å­—æ®µï¼ˆTEXT[]æ•°ç»„ï¼‰å­˜å‚¨æ”¯ä»˜å‡­è¯
- `covers_player_ids` å­—æ®µå…³è”å¯¹åº”çš„ç©å®¶ID
- æ¯ä¸ªpaymentè®°å½•éƒ½æœ‰ç‹¬ç«‹IDï¼Œå¯å•ç‹¬ç®¡ç†å‡­è¯

**APIå®Œå…¨æ”¯æŒ**ï¼š
- `PUT /order-payments/:paymentId/proof` - ä¸ºç‰¹å®šä»˜æ¬¾è®°å½•ä¸Šä¼ /æ›´æ–°å‡­è¯
- æ”¯æŒæ›¿æ¢å’Œè¿½åŠ æ¨¡å¼æ›´æ–°å‡­è¯
- åˆ›å»ºå¤šäººæ”¯ä»˜è®¢å•æ—¶ï¼Œæ¯ä¸ªæ‹†åˆ†é¡¹éƒ½å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„paymentè®°å½•

**å®Œç¾åŒ¹é…éœ€æ±‚**ï¼š
- ä¸ªäººä»˜æ¬¾å¡ç‰‡ â†’ å¯¹åº”1ä¸ª`order_payment`è®°å½•
- åˆå¹¶ä»˜æ¬¾å¡ç‰‡ â†’ å¯¹åº”1ä¸ª`order_payment`è®°å½•ï¼Œ`covers_player_ids`åŒ…å«å¤šä¸ªç©å®¶
- æ¯ä¸ªå¡ç‰‡éƒ½å¯ä»¥é€šè¿‡paymentIdç‹¬ç«‹ä¸Šä¼ å‡­è¯

ç°åœ¨æˆ‘æ¥å®ç°å‰ç«¯åŠŸèƒ½ï¼š
Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

Ran tool

## âœ… åŠŸèƒ½å®ç°å®Œæˆï¼

æˆ‘å·²ç»æˆåŠŸä¸ºæ‹†åˆ†ä»˜æ¬¾å¡ç‰‡æ·»åŠ äº†ä»˜æ¬¾å‡­è¯ä¸Šä¼ åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å®ç°çš„è¯¦ç»†å†…å®¹ï¼š

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

**1. æ™ºèƒ½ä¸Šä¼ æŒ‰é’®æ˜¾ç¤º**
- åªæœ‰é€‰ä¸­1ä¸ªå¡ç‰‡æ—¶ï¼Œæ˜¾ç¤º"ä¸Šä¼ ä»˜æ¬¾å‡­è¯"æŒ‰é’®
- é€‰ä¸­å¤šä¸ªå¡ç‰‡æ—¶ï¼Œæ˜¾ç¤ºæç¤º"è¯·é€‰æ‹©æŸä¸ªå…·ä½“çš„äººä¸Šä¼ å‡­è¯"
- æŒ‰é’®é‡‡ç”¨è“è‰²æ¸å˜è®¾è®¡ï¼Œè§†è§‰çªå‡º

**2. å‡­è¯ä¸Šä¼ é€»è¾‘**
- æ”¯æŒå›¾ç‰‡æ ¼å¼éªŒè¯ï¼ˆåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼‰
- æ–‡ä»¶å¤§å°é™åˆ¶5MB
- æ”¯æŒå¤šé€‰æ–‡ä»¶ä¸Šä¼ 
- è‡ªåŠ¨å…³è”åˆ°é€‰ä¸­å¡ç‰‡çš„paymentè®°å½•ID
- ä¸Šä¼ å®Œæˆåè‡ªåŠ¨æ¸…é™¤é€‰ä¸­çŠ¶æ€

**3. å‡­è¯æ˜¾ç¤ºåŠŸèƒ½**
- **ä¸ªäººä»˜æ¬¾å¡ç‰‡**ï¼šåº•éƒ¨æ˜¾ç¤ºç»¿è‰²å‡­è¯æŒ‡ç¤ºæ¡ï¼Œæ˜¾ç¤ºå‡­è¯æ•°é‡
- **åˆå¹¶ä»˜æ¬¾å¡ç‰‡**ï¼šä¸­éƒ¨æ˜¾ç¤ºåœ†è§’å‡­è¯å¾½ç« ï¼Œæ˜¾ç¤ºå‡­è¯æ•°é‡
- æä¾›æŸ¥çœ‹å’Œåˆ é™¤æŒ‰é’®

**4. å‡­è¯ç®¡ç†åŠŸèƒ½**
- **æŸ¥çœ‹å‡­è¯**ï¼šç‚¹å‡»çœ¼ç›å›¾æ ‡é¢„è§ˆç¬¬ä¸€å¼ å‡­è¯
- **åˆ é™¤å‡­è¯**ï¼šç‚¹å‡»åˆ é™¤å›¾æ ‡ï¼Œå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†åˆ é™¤æ‰€æœ‰å‡­è¯
- **é‡æ–°ä¸Šä¼ **ï¼šåˆ é™¤åå¯ä»¥é‡æ–°é€‰æ‹©å¡ç‰‡ä¸Šä¼ æ–°çš„å‡­è¯

### ğŸ¨ UIè®¾è®¡äº®ç‚¹

**è§†è§‰å±‚æ¬¡æ¸…æ™°**ï¼š
- ä¸Šä¼ æŒ‰é’®ï¼šè“è‰²æ¸å˜ï¼Œä¸ä¸»è‰²è°ƒåè°ƒ
- å‡­è¯æŒ‡ç¤ºå™¨ï¼šç»¿è‰²ä¸»é¢˜ï¼Œè¡¨ç¤ºå·²å®ŒæˆçŠ¶æ€
- æ“ä½œæŒ‰é’®ï¼šæ‚¬åœæ•ˆæœï¼Œæå‡äº¤äº’ä½“éªŒ

**ç©ºé—´ä¼˜åŒ–**ï¼š
- ä¸ªäººå¡ç‰‡ï¼šç´§å‡‘çš„åº•éƒ¨å‡­è¯æ¡ï¼Œä¸å ç”¨è¿‡å¤šç©ºé—´
- åˆå¹¶å¡ç‰‡ï¼šä¸­éƒ¨å¾½ç« è®¾è®¡ï¼Œä¸å¡ç‰‡æ ·å¼ä¸€è‡´
- å“åº”å¼è®¾è®¡ï¼šåœ¨å°å±å¹•ä¸Šè‡ªé€‚åº”å¸ƒå±€

### ğŸ”§ æŠ€æœ¯å®ç°

**æ•°æ®ç®¡ç†**ï¼š
- `cardProofImages` å¯¹è±¡å­˜å‚¨æ¯ä¸ªå¡ç‰‡çš„å‡­è¯æ•°æ®
- ä½¿ç”¨å¡ç‰‡IDä½œä¸ºkeyï¼Œæ”¯æŒç‹¬ç«‹ç®¡ç†
- è‡ªåŠ¨æ¸…ç†å†…å­˜æ³„æ¼ï¼ˆé‡Šæ”¾blob URLï¼‰

**ç”¨æˆ·ä½“éªŒ**ï¼š
- ä¸Šä¼ è¿‡ç¨‹ä¸­æ˜¾ç¤ºloadingçŠ¶æ€
- æ“ä½œå®Œæˆåæ˜¾ç¤ºæˆåŠŸæç¤º
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

**åç«¯å…¼å®¹**ï¼š
- å·²ç¡®è®¤åç«¯å®Œå…¨æ”¯æŒï¼Œæ— éœ€ä¿®æ”¹
- ä½¿ç”¨ç°æœ‰çš„ `order_payments` è¡¨ç»“æ„
- åˆ©ç”¨ `payment_proof_images` å­—æ®µå­˜å‚¨å‡­è¯

### ğŸš€ ä½¿ç”¨æµç¨‹

1. **ç”Ÿæˆæ‹†åˆ†ä»˜æ¬¾** â†’ ç‚¹å‡»"æŒ‰äººæ•°æ‹†åˆ†ä»˜æ¬¾"
2. **é€‰æ‹©å¡ç‰‡** â†’ ç‚¹å‡»è¦ä¸Šä¼ å‡­è¯çš„å¡ç‰‡ï¼ˆä¸ªäººæˆ–åˆå¹¶ï¼‰
3. **ä¸Šä¼ å‡­è¯** â†’ ç‚¹å‡»"ä¸Šä¼ ä»˜æ¬¾å‡­è¯"æŒ‰é’®ï¼Œé€‰æ‹©å›¾ç‰‡æ–‡ä»¶
4. **æŸ¥çœ‹å‡­è¯** â†’ å¡ç‰‡æ˜¾ç¤ºå‡­è¯æ•°é‡ï¼Œç‚¹å‡»çœ¼ç›å›¾æ ‡æŸ¥çœ‹
5. **ç®¡ç†å‡­è¯** â†’ å¦‚éœ€é‡æ–°ä¸Šä¼ ï¼Œç‚¹å‡»åˆ é™¤å›¾æ ‡åé‡æ–°æ“ä½œ

è¿™ä¸ªå®ç°å®Œå…¨æ»¡è¶³äº†ä½ çš„éœ€æ±‚ï¼š**æ¯ä¸ªæ‹†åˆ†ä»˜æ¬¾å¡ç‰‡éƒ½å¯ä»¥ç‹¬ç«‹ä¸Šä¼ ä»˜æ¬¾å‡­è¯ï¼Œæ”¯æŒæŸ¥çœ‹ã€åˆ é™¤å’Œé‡æ–°ä¸Šä¼ ï¼Œå¹¶ä¸”ä¸¥æ ¼é™åˆ¶ä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªå¡ç‰‡ä¸Šä¼ å‡­è¯**ã€‚

æˆ‘æ¥åˆ†æä¸€ä¸‹å‰ç«¯ OrderPaymentConfirm.vue ç»„ä»¶çš„æ‹†åˆ†ä»˜æ¬¾åŠŸèƒ½ä¸åç«¯å®ç°çš„åŒ¹é…æƒ…å†µã€‚è®©æˆ‘å…ˆé˜…è¯»ç›¸å…³æ–‡ä»¶äº†è§£å½“å‰çš„å®ç°çŠ¶æ€ã€‚
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool
Read file: backend/src/services/orderService.js
Read file: backend/src/controllers/orderController.js

Ran tool
Read file: backend/src/routes/order.js
Read file: frontend/src/components/order/OrderPaymentConfirm.vue

Ran tool
Read file: backend/src/routes/order.js
Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue

Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Read file: frontend/src/api/order.js
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Read file: backend/src/models/orderPlayerModel.js
Read file: backend/src/models/orderPaymentModel.js

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

Ran tool
Read file: frontend/src/components/order/OrderPaymentConfirm.vue
Ran tool

åŸºäºæˆ‘çš„è¯¦ç»†åˆ†æï¼Œæˆ‘å‘ç°äº†å‰ç«¯ OrderPaymentConfirm.vue ç»„ä»¶ä¸åç«¯å¤šæ”¯ä»˜ API çš„é›†æˆå­˜åœ¨é—®é¢˜ã€‚è®©æˆ‘ä¸ºæ‚¨æä¾›å®Œæ•´çš„åˆ†ææŠ¥å‘Šï¼š

## ğŸ” å½“å‰å®ç°çŠ¶æ€åˆ†æ

### âœ… åç«¯å®ç°ï¼ˆå·²å®Œæˆï¼‰

**API ç«¯ç‚¹**ï¼š`/api/order/multi-payment`
- è·¯ç”±ï¼š`POST /api/order/multi-payment`
- æ§åˆ¶å™¨ï¼š`orderController.createOrderWithMultiPayment`
- æœåŠ¡ï¼š`orderService.createOrderWithMultiPayment`

**æ•°æ®å¤„ç†èƒ½åŠ›**ï¼š
- èƒ½å¤„ç†åŸºç¡€è®¢å•æ•°æ® (`basicOrderData`)
- èƒ½å¤„ç†å¤šç¬”ä»˜æ¬¾é…ç½® (`paymentItems`)
- èƒ½ä¸Šä¼ å›¾ç‰‡ (`uploadedImages`)
- è‡ªåŠ¨åˆ›å»ºç©å®¶è®°å½•ï¼ŒåŒ…å«ï¼šç±»å‹ã€æŠ˜æ‰£ã€åŸä»·ã€æŠ˜æ‰£é‡‘é¢ã€æŠ˜ååº”ä»˜é‡‘é¢
- è‡ªåŠ¨åˆ›å»ºæ”¯ä»˜è®°å½•ï¼ŒåŒ…å«ï¼šä»˜æ¬¾äººä¿¡æ¯ã€æ”¯ä»˜é‡‘é¢ã€ä»˜æ¬¾æ–¹å¼ã€å‡­è¯

**æ¨¡å‹æ”¯æŒ**ï¼š
- `orderPlayerModel` æ”¯æŒè§’è‰²å®šä»·æ¨¡æ¿ã€æŠ˜æ‰£ä¿¡æ¯ã€åŸä»·/æŠ˜åä»·ç­‰å­—æ®µ
- `orderPaymentModel` æ”¯æŒå¤šäººæ”¯ä»˜ã€è§’è‰²åˆ†ç»„ã€å‡­è¯ä¸Šä¼ ç­‰åŠŸèƒ½

### âŒ å‰ç«¯å®ç°é—®é¢˜ï¼ˆéœ€è¦ä¿®å¤ï¼‰

**ä¸»è¦é—®é¢˜**ï¼š
1. **API è°ƒç”¨é”™è¯¯**ï¼š`handleSubmit` æ–¹æ³•ä½¿ç”¨çš„æ˜¯ `orderAPI.create()` è€Œä¸æ˜¯ `createOrderWithMultiPayment`
2. **åŠŸèƒ½ç¼ºå¤±**ï¼šè™½ç„¶æœ‰æ‹†åˆ†ä»˜æ¬¾çš„ UI å’Œç”Ÿæˆé€»è¾‘ï¼Œä½†æ²¡æœ‰å®é™…çš„æäº¤é€»è¾‘
3. **æ•°æ®ç»“æ„ä¸åŒ¹é…**ï¼šå½“å‰æäº¤çš„æ•°æ®ç»“æ„ä¸åç«¯å¤šæ”¯ä»˜ API æœŸæœ›çš„æ ¼å¼ä¸ä¸€è‡´

### ğŸ› ï¸ éœ€è¦ä¿®å¤çš„å…·ä½“é—®é¢˜
Ran tool

## ğŸ“‹ æ€»ç»“æŠ¥å‘Š

### ğŸ¯ **æ ¸å¿ƒé—®é¢˜**
å‰ç«¯ç»„ä»¶çš„æ‹†åˆ†ä»˜æ¬¾åŠŸèƒ½**åªæœ‰ç•Œé¢å±•ç¤ºå’Œæ•°æ®ç”Ÿæˆ**ï¼Œä½†**ç¼ºå°‘å®é™…çš„å¤šæ”¯ä»˜APIè°ƒç”¨é€»è¾‘**ã€‚

### âœ… **åç«¯å®ç°æ­£ç¡®**
åç«¯çš„ `/api/order/multi-payment` æ¥å£å®Œå…¨èƒ½å¤Ÿå¤„ç†ç”¨æˆ·æè¿°çš„éœ€æ±‚ï¼š

1. **æ•°æ®æ¥æ”¶ç»“æ„**ï¼š
```javascript
{
  basicOrderData: {
    // åŸºç¡€è®¢å•ä¿¡æ¯
    customer_name, player_count, store_id, room_id, etc.
  },
  paymentItems: [
    {
      name: "è§’è‰²åç§°",
      type: "role_discount", 
      players: 2,
      unitPrice: 150000,
      amount: 300000,
      description: "æè¿°",
      payer_name: "ä»˜æ¬¾äºº",
      payment_method: "Bank Transfer",
      payment_status: "pending"
    }
  ],
  uploadedImages: [...]
}
```

2. **è‡ªåŠ¨åˆ›å»ºè®°å½•**ï¼š
   - âœ… ç©å®¶è®°å½•ï¼šåŒ…å«ç±»å‹ã€æŠ˜æ‰£ã€åŸä»·ã€æŠ˜æ‰£é‡‘é¢ã€æŠ˜ååº”ä»˜é‡‘é¢
   - âœ… æ”¯ä»˜è®°å½•ï¼šåŒ…å«ä»˜æ¬¾äººä¿¡æ¯ã€å‡­è¯ä¸Šä¼ å­—æ®µ
   - âœ… è®¢å•è®°å½•ï¼šæ ‡è®°ä¸ºå¤šæ”¯ä»˜æ¨¡å¼

### âŒ **å‰ç«¯éœ€è¦ä¿®å¤**

ç›®å‰å‰ç«¯çš„ `handleSubmit` æ–¹æ³•éœ€è¦æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼š

```javascript
const handleSubmit = async () => {
  // å½“å¯ç”¨æ‹†åˆ†ä»˜æ¬¾æ—¶ï¼Œä½¿ç”¨å¤šæ”¯ä»˜API
  if (showSplitPayment.value && splitPaymentItems.value.length > 0) {
    // è°ƒç”¨ createOrderWithMultiPayment API
    const response = await createOrderWithMultiPayment({
      basicOrderData: orderData,
      paymentItems: formatSplitPaymentItems(),
      uploadedImages: uploadedImages
    });
  } else {
    // ä½¿ç”¨æ ‡å‡†API
    const response = await orderAPI.create(orderData);
  }
}
```

### ğŸ”§ **ä¿®å¤å»ºè®®**
1. ä¿®æ”¹å‰ç«¯ `handleSubmit` æ–¹æ³•æ·»åŠ å¤šæ”¯ä»˜æ¨¡å¼åˆ¤æ–­
2. æ ¼å¼åŒ– `splitPaymentItems` æ•°æ®åŒ¹é…åç«¯æœŸæœ›ç»“æ„  
3. å¤„ç†æ¯ä¸ªä»˜æ¬¾é¡¹çš„å‡­è¯å›¾ç‰‡å…³è”
4. ç¡®ä¿æ‰€æœ‰ç©å®¶ä¿¡æ¯ï¼ˆç±»å‹ã€æŠ˜æ‰£ã€åŸä»·ç­‰ï¼‰æ­£ç¡®ä¼ é€’

**ç»“è®º**ï¼šåç«¯å®ç°å®Œå…¨æ­£å¸¸ï¼Œé—®é¢˜åœ¨äºå‰ç«¯æ²¡æœ‰è°ƒç”¨æ­£ç¡®çš„APIç«¯ç‚¹ã€‚ä¿®å¤å‰ç«¯é€»è¾‘åï¼Œæ•´ä¸ªæ‹†åˆ†ä»˜æ¬¾åŠŸèƒ½å°±èƒ½æ­£å¸¸å·¥ä½œã€‚