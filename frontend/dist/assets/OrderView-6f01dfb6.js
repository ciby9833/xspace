import{g as t,A as Me,r as O,b as xe,k as ze,l as we,q as Le,m as L,c as P,o as u,n as x,w as e,h as s,d as f,v as V,t as _,s as H,i as y,f as ue,P as $e,e as h,G as Ue,a as Re,z as qe,S as Ne,E as He,O as Te}from"./index-979b8016.js";import{o as Y}from"./order-662eb60a.js";import{s as je}from"./store-4f4116e5.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"};const De=Ae;function Se(N){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?Object(arguments[M]):{},T=Object.keys(U);typeof Object.getOwnPropertySymbols=="function"&&(T=T.concat(Object.getOwnPropertySymbols(U).filter(function(j){return Object.getOwnPropertyDescriptor(U,j).enumerable}))),T.forEach(function(j){Ee(N,j,U[j])})}return N}function Ee(N,M,U){return M in N?Object.defineProperty(N,M,{value:U,enumerable:!0,configurable:!0,writable:!0}):N[M]=U,N}var Ce=function(M,U){var T=Se({},M,U.attrs);return t(Me,Se({},T,{icon:De}),null)};Ce.displayName="BarChartOutlined";Ce.inheritAttrs=!1;const Ve=Ce;const Ye={key:1},Ge={key:0,style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Je={key:1,style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Qe={key:2,style:{"font-size":"12px",color:"#ff4d4f","margin-top":"4px"}},We={key:2},Xe={key:0,style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Ze={key:1,style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Ke={key:2,style:{"font-size":"12px",color:"#ff4d4f","margin-top":"4px"}},et={key:0,style:{"font-size":"12px",color:"#999","margin-top":"4px"}},tt={key:0},at=["src"],lt={__name:"OrderFormModal",props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(N,{emit:M}){const U=N,T=M,j=O(),W=O(!1),ae=O(!1),i=O(!1),w=O(!1),C=O([]),X=O(!1),G=O(""),Z=O([]),D=O([]),ee=O([]),R=O([]),A=O({}),K=O([]),pe=()=>{Object.keys(l).forEach(r=>{r==="player_count"?l[r]=1:r==="language"?l[r]="CN":r==="booking_type"?l[r]="Booking":r==="payment_status"?l[r]="Not Yet":r==="free_pay"?l[r]="Free":r==="total_amount"||r==="promo_quantity"?l[r]=0:typeof l[r]=="boolean"?l[r]=!1:l[r]=null}),C.value=[]},l=xe({order_type:null,store_id:null,room_id:null,customer_name:"",customer_phone:"",order_date:null,start_time:null,end_time:null,player_count:1,language:"CN",booking_type:"Booking",payment_status:"Not Yet",total_amount:0,script_id:null,escape_room_id:null,is_group_booking:!1,include_photos:!1,include_cctv:!1,notes:"",game_host_id:null,pic_id:null,pic_payment:"",free_pay:"Free",payment_method:null,promo_quantity:0,internal_support:!1}),me={order_type:[{required:!0,message:"请选择订单类型"}],store_id:[{required:!0,message:"请选择门店"}],room_id:[{required:!0,message:"请选择房间"}],customer_name:[{required:!0,message:"请输入客户姓名"}],customer_phone:[{required:!0,message:"请输入客户电话"}],order_date:[{required:!0,message:"请选择订单日期"}],start_time:[{required:!0,message:"请选择开始时间"}],end_time:[{required:!0,message:"请选择结束时间"}],player_count:[{required:!0,message:"请输入玩家人数"}],language:[{required:!0,message:"请选择语言"}],booking_type:[{required:!0,message:"请选择预订类型"}],payment_status:[{required:!0,message:"请选择支付状态"}],game_host_id:[{required:!0,message:"请选择Game Host"}],free_pay:[{required:!0,message:"请选择支付类型"}],script_id:[{validator:(r,a)=>l.order_type==="剧本杀"&&!a?Promise.reject("剧本杀订单必须选择剧本"):Promise.resolve()}],escape_room_id:[{validator:(r,a)=>l.order_type==="密室"&&!a?Promise.reject("密室订单必须选择密室主题"):Promise.resolve()}],payment_method:[{validator:(r,a)=>l.free_pay==="Pay"&&!a?Promise.reject("付费订单必须选择付款方式"):Promise.resolve()}],total_amount:[{validator:(r,a)=>l.free_pay==="Pay"&&(!a||a<=0)?Promise.reject("付费订单必须输入有效金额"):Promise.resolve()}]};ze(()=>R.value.filter(r=>r.status!=="正常"?!1:l.order_date&&l.start_time&&l.end_time&&A.value[r.id]?A.value[r.id].is_available:!0)),we(()=>U.formData,async r=>{r&&Object.keys(r).length>0?(console.log("加载订单数据:",r),Object.keys(l).forEach(a=>{a==="order_date"&&r[a]?l[a]=Ue(r[a]):(a==="start_time"||a==="end_time")&&r[a]?l[a]=Ue(r[a],"HH:mm"):r[a]!==void 0&&r[a]!==null&&(l[a]=r[a])}),r.is_free!==void 0&&(l.free_pay=r.is_free?"Free":"Pay"),r.images&&Array.isArray(r.images)?C.value=r.images.map((a,d)=>({uid:a.id||`${d}`,name:a.image_name||`image_${d+1}`,status:"done",url:a.image_url,response:a})):C.value=[],r.store_id&&await ie(r.store_id)):pe()},{immediate:!0,deep:!0}),we(()=>l.store_id,async(r,a)=>{var d;r&&r!==a&&(U.isEdit&&!a&&((d=U.formData)==null?void 0:d.store_id)===r||(l.script_id=null,l.escape_room_id=null,l.room_id=null),D.value=[],ee.value=[],R.value=[],A.value={},K.value=[],await ie(r))}),we([()=>l.order_date,()=>l.start_time,()=>l.end_time],async([r,a,d])=>{l.store_id&&r&&a&&d&&R.value.length>0&&await de()},{deep:!0}),Le(()=>{fe()});const fe=async()=>{try{ae.value=!0;const r=await Y.getAvailableStores();Z.value=r.data||[],Z.value.length===1&&(l.store_id=Z.value[0].id)}catch(r){console.error("加载门店列表失败:",r),L.error("加载门店列表失败")}finally{ae.value=!1}},ie=async r=>{if(r)try{i.value=!0;const d=(await Y.getStoreResources(r)).data||{};D.value=d.scripts||[],ee.value=d.escape_rooms||[],R.value=d.rooms||[],K.value=d.users||[],l.order_date&&l.start_time&&l.end_time&&await de()}catch(a){console.error("加载门店资源失败:",a),L.error("加载门店资源失败")}finally{i.value=!1}},de=async()=>{var r;if(!(!l.store_id||!l.order_date||!l.start_time||!l.end_time))try{w.value=!0;const a=l.order_date.format("YYYY-MM-DD"),d=l.start_time.format("HH:mm"),v=l.end_time.format("HH:mm"),c=R.value.map(async $=>{var oe;try{const E=await Y.checkRoomAvailability(l.store_id,$.id,{date:a,start_time:d,end_time:v,exclude_order_id:U.isEdit&&((oe=U.formData)!=null&&oe.id)?U.formData.id:void 0});return{roomId:$.id,...E.data}}catch(E){return console.error(`检查房间 ${$.name} 可用性失败:`,E),{roomId:$.id,is_available:!1,conflicts:[]}}}),b=await Promise.all(c),S={};b.forEach($=>{S[$.roomId]=$}),A.value=S,l.room_id&&!((r=A.value[l.room_id])!=null&&r.is_available)&&(l.room_id=null,L.warning("当前选择的房间在该时间段不可用，请重新选择"))}catch(a){console.error("检查房间可用性失败:",a)}finally{w.value=!1}},ve=r=>{var v;const a=A.value[r.id];let d="";return a?a.is_available?d=" ✅":d=` ❌ (${((v=a.conflicts)==null?void 0:v.length)||0}个冲突)`:r.status!=="正常"&&(d=` (${r.status})`),`${r.name} [${r.room_type}, 容量${r.capacity}]${d}`},ce=r=>r.type==="image/jpeg"||r.type==="image/png"?r.size/1024/1024<2?C.value.length>=5?(L.error("最多只能上传5张图片!"),!1):!0:(L.error("图片大小不能超过 2MB!"),!1):(L.error("只能上传 JPG/PNG 格式的图片!"),!1),ye=r=>{G.value=r.url||r.thumbUrl,X.value=!0},ge=r=>{const a=C.value.findIndex(d=>d.uid===r.uid);return a>-1&&C.value.splice(a,1),!0},ne=async()=>{var d;const r=C.value.filter(v=>v.originFileObj&&v.status!=="error"),a=C.value.filter(v=>v.response||v.url&&!v.originFileObj).map(v=>v.response||{image_url:v.url,image_name:v.name,image_type:"proof"});if(r.length===0)return a;try{const v=new FormData;r.forEach($=>{v.append("images",$.originFileObj)});const c=await Y.uploadImages(v);console.log("图片上传响应:",c);let b=[];(d=c.data)!=null&&d.images?b=c.data.images:c.data&&Array.isArray(c.data)?b=c.data:(console.warn("意外的响应格式:",c),b=[]);const S=Array.isArray(b)?b:[];return[...a,...S]}catch(v){throw console.error("图片上传失败:",v),L.error("图片上传失败: "+(v.message||"未知错误")),v}},le=async()=>{var r,a;try{if(await j.value.validate(),l.room_id&&l.order_date&&l.start_time&&l.end_time){const v=l.order_date.format("YYYY-MM-DD"),c=l.start_time.format("HH:mm"),b=l.end_time.format("HH:mm");if(!(await Y.checkRoomAvailability(l.store_id,l.room_id,{date:v,start_time:c,end_time:b,exclude_order_id:U.isEdit&&((r=U.formData)!=null&&r.id)?U.formData.id:void 0})).data.is_available){L.error("所选房间在该时间段不可用，请重新选择");return}}W.value=!0;const d={...l};if(d.order_date&&(d.order_date=d.order_date.format("YYYY-MM-DD")),d.start_time&&(d.start_time=d.start_time.format("HH:mm")),d.end_time&&(d.end_time=d.end_time.format("HH:mm")),l.free_pay==="Pay"&&C.value.length>0)try{const v=await ne();d.images=v}catch{W.value=!1;return}else d.images=[];d.is_free=d.free_pay==="Free",d.order_type==="剧本杀"?(delete d.escape_room_id,delete d.is_group_booking,delete d.include_photos,delete d.include_cctv):d.order_type==="密室"&&delete d.script_id,U.isEdit&&((a=U.formData)!=null&&a.id)&&(d.id=U.formData.id),T("submit",d)}catch(d){console.error("表单验证失败:",d)}finally{W.value=!1}},re=()=>{j.value.resetFields(),D.value=[],ee.value=[],R.value=[],A.value={},K.value=[],C.value=[],X.value=!1,G.value="",T("update:visible",!1)};return(r,a)=>{const d=P("a-select-option"),v=P("a-select"),c=P("a-form-item"),b=P("a-col"),S=P("a-row"),$=P("a-input"),oe=P("a-date-picker"),E=P("a-time-picker"),q=P("a-input-number"),I=P("a-radio"),be=P("a-radio-group"),se=P("a-checkbox"),_e=P("a-divider"),p=P("a-textarea"),n=P("a-upload"),F=P("a-form"),z=P("a-modal");return u(),x(z,{open:N.visible,title:N.isEdit?"编辑订单":"新增订单","confirm-loading":W.value,width:"800px",onOk:le,onCancel:re},{default:e(()=>[t(F,{ref_key:"formRef",ref:j,model:l,rules:me,layout:"vertical"},{default:e(()=>[t(S,{gutter:16},{default:e(()=>[t(b,{span:12},{default:e(()=>[t(c,{label:"订单类型",name:"order_type"},{default:e(()=>[t(v,{value:l.order_type,"onUpdate:value":a[0]||(a[0]=o=>l.order_type=o),placeholder:"选择订单类型"},{default:e(()=>[t(d,{value:"剧本杀"},{default:e(()=>a[28]||(a[28]=[s("剧本杀")])),_:1,__:[28]}),t(d,{value:"密室"},{default:e(()=>a[29]||(a[29]=[s("密室")])),_:1,__:[29]})]),_:1},8,["value"])]),_:1})]),_:1}),t(b,{span:12},{default:e(()=>[t(c,{label:"门店",name:"store_id"},{default:e(()=>[t(v,{value:l.store_id,"onUpdate:value":a[1]||(a[1]=o=>l.store_id=o),placeholder:"选择门店",loading:ae.value,"show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(Z.value,o=>(u(),x(d,{key:o.id,value:o.id},{default:e(()=>[s(_(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:12},{default:e(()=>[t(c,{label:"客户姓名",name:"customer_name"},{default:e(()=>[t($,{value:l.customer_name,"onUpdate:value":a[2]||(a[2]=o=>l.customer_name=o),placeholder:"输入客户姓名"},null,8,["value"])]),_:1})]),_:1}),t(b,{span:12},{default:e(()=>[t(c,{label:"客户电话",name:"customer_phone"},{default:e(()=>[t($,{value:l.customer_phone,"onUpdate:value":a[3]||(a[3]=o=>l.customer_phone=o),placeholder:"输入客户电话"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(c,{label:"订单日期",name:"order_date"},{default:e(()=>[t(oe,{value:l.order_date,"onUpdate:value":a[4]||(a[4]=o=>l.order_date=o),placeholder:"选择日期",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"开始时间",name:"start_time"},{default:e(()=>[t(E,{value:l.start_time,"onUpdate:value":a[5]||(a[5]=o=>l.start_time=o),placeholder:"选择开始时间",format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"结束时间",name:"end_time"},{default:e(()=>[t(E,{value:l.end_time,"onUpdate:value":a[6]||(a[6]=o=>l.end_time=o),placeholder:"选择结束时间",format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(c,{label:"玩家人数",name:"player_count"},{default:e(()=>[t(q,{value:l.player_count,"onUpdate:value":a[7]||(a[7]=o=>l.player_count=o),min:1,max:20,placeholder:"玩家人数",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"语言",name:"language"},{default:e(()=>[t(v,{value:l.language,"onUpdate:value":a[8]||(a[8]=o=>l.language=o),placeholder:"选择语言"},{default:e(()=>[t(d,{value:"CN"},{default:e(()=>a[30]||(a[30]=[s("🇨🇳 中文")])),_:1,__:[30]}),t(d,{value:"EN"},{default:e(()=>a[31]||(a[31]=[s("🇺🇸 英语")])),_:1,__:[31]}),t(d,{value:"IND"},{default:e(()=>a[32]||(a[32]=[s("🇮🇩 印尼语")])),_:1,__:[32]})]),_:1},8,["value"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"预订类型",name:"booking_type"},{default:e(()=>[t(v,{value:l.booking_type,"onUpdate:value":a[9]||(a[9]=o=>l.booking_type=o),placeholder:"选择预订类型"},{default:e(()=>[t(d,{value:"Booking"},{default:e(()=>a[33]||(a[33]=[s("预订")])),_:1,__:[33]}),t(d,{value:"Walk In"},{default:e(()=>a[34]||(a[34]=[s("临时")])),_:1,__:[34]}),t(d,{value:"Traveloka"},{default:e(()=>a[35]||(a[35]=[s("Traveloka")])),_:1,__:[35]}),t(d,{value:"Tiket.com"},{default:e(()=>a[36]||(a[36]=[s("Tiket.com")])),_:1,__:[36]}),t(d,{value:"Gamehost/Staff Booking"},{default:e(()=>a[37]||(a[37]=[s("Gamehost/Staff Booking")])),_:1,__:[37]}),t(d,{value:"MyValue（Gramedia）"},{default:e(()=>a[38]||(a[38]=[s("MyValue（Gramedia）")])),_:1,__:[38]}),t(d,{value:"Promo"},{default:e(()=>a[39]||(a[39]=[s("Promo")])),_:1,__:[39]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(c,{label:"Game Host",name:"game_host_id"},{default:e(()=>[t(v,{value:l.game_host_id,"onUpdate:value":a[10]||(a[10]=o=>l.game_host_id=o),placeholder:"选择Game Host",loading:i.value,disabled:!l.store_id,"show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(K.value,o=>(u(),x(d,{key:o.id,value:o.id},{default:e(()=>[s(_(o.name)+" ("+_(o.username)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"PIC负责人",name:"pic_id"},{default:e(()=>[t(v,{value:l.pic_id,"onUpdate:value":a[11]||(a[11]=o=>l.pic_id=o),placeholder:"选择PIC（选填）",loading:i.value,disabled:!l.store_id,allowClear:"","show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(K.value,o=>(u(),x(d,{key:o.id,value:o.id},{default:e(()=>[s(_(o.name)+" ("+_(o.username)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{label:"PIC Payment",name:"pic_payment"},{default:e(()=>[t($,{value:l.pic_payment,"onUpdate:value":a[12]||(a[12]=o=>l.pic_payment=o),placeholder:"PIC Payment（选填）"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:12},{default:e(()=>[t(c,{label:"支付类型",name:"free_pay"},{default:e(()=>[t(be,{value:l.free_pay,"onUpdate:value":a[13]||(a[13]=o=>l.free_pay=o)},{default:e(()=>[t(I,{value:"Free"},{default:e(()=>a[40]||(a[40]=[s("免费")])),_:1,__:[40]}),t(I,{value:"Pay"},{default:e(()=>a[41]||(a[41]=[s("付费")])),_:1,__:[41]})]),_:1},8,["value"])]),_:1})]),_:1}),t(b,{span:12},{default:e(()=>[t(c,{label:"支付状态",name:"payment_status"},{default:e(()=>[t(v,{value:l.payment_status,"onUpdate:value":a[14]||(a[14]=o=>l.payment_status=o),placeholder:"选择支付状态"},{default:e(()=>[t(d,{value:"FULL"},{default:e(()=>a[42]||(a[42]=[s("已付全款")])),_:1,__:[42]}),t(d,{value:"DP"},{default:e(()=>a[43]||(a[43]=[s("已付定金")])),_:1,__:[43]}),t(d,{value:"Not Yet"},{default:e(()=>a[44]||(a[44]=[s("未付款")])),_:1,__:[44]}),t(d,{value:"Free"},{default:e(()=>a[45]||(a[45]=[s("免费")])),_:1,__:[45]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),l.free_pay==="Pay"?(u(),x(S,{key:0,gutter:16},{default:e(()=>[t(b,{span:12},{default:e(()=>[t(c,{label:"付款方式",name:"payment_method"},{default:e(()=>[t(v,{value:l.payment_method,"onUpdate:value":a[15]||(a[15]=o=>l.payment_method=o),placeholder:"选择付款方式"},{default:e(()=>[t(d,{value:"Bank Transfer"},{default:e(()=>a[46]||(a[46]=[s("Bank Transfer")])),_:1,__:[46]}),t(d,{value:"QR BCA"},{default:e(()=>a[47]||(a[47]=[s("QR BCA")])),_:1,__:[47]}),t(d,{value:"DEBIT"},{default:e(()=>a[48]||(a[48]=[s("DEBIT")])),_:1,__:[48]}),t(d,{value:"CC"},{default:e(()=>a[49]||(a[49]=[s("CC")])),_:1,__:[49]})]),_:1},8,["value"])]),_:1})]),_:1}),t(b,{span:12},{default:e(()=>[t(c,{label:"订单金额",name:"total_amount"},{default:e(()=>[t(q,{value:l.total_amount,"onUpdate:value":a[16]||(a[16]=o=>l.total_amount=o),min:0,placeholder:"订单金额",style:{width:"100%"},formatter:o=>`Rp ${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/Rp\s?|(,*)/g,"")},null,8,["value","formatter","parser"])]),_:1})]),_:1})]),_:1})):y("",!0),t(S,{gutter:16},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(c,{label:"优惠数量",name:"promo_quantity"},{default:e(()=>[t(q,{value:l.promo_quantity,"onUpdate:value":a[17]||(a[17]=o=>l.promo_quantity=o),min:0,placeholder:"优惠数量（选填）",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{name:"internal_support"},{default:e(()=>[t(se,{checked:l.internal_support,"onUpdate:checked":a[18]||(a[18]=o=>l.internal_support=o)},{default:e(()=>a[50]||(a[50]=[s("内部补位")])),_:1,__:[50]},8,["checked"])]),_:1})]),_:1})]),_:1}),l.order_type==="剧本杀"?(u(),f("div",Ye,[t(_e,null,{default:e(()=>a[51]||(a[51]=[s("剧本杀信息")])),_:1,__:[51]}),t(S,{gutter:16},{default:e(()=>[t(b,{span:24},{default:e(()=>[t(c,{label:"剧本",name:"script_id"},{default:e(()=>[t(v,{value:l.script_id,"onUpdate:value":a[19]||(a[19]=o=>l.script_id=o),placeholder:"选择剧本",loading:i.value,disabled:!l.store_id,"show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(D.value,o=>(u(),x(d,{key:o.id,value:o.id},{default:e(()=>{var B,J;return[s(_(o.name)+" (Rp "+_(((B=o.store_price)==null?void 0:B.toLocaleString())||((J=o.price)==null?void 0:J.toLocaleString())||"价格待定")+") ",1)]}),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","disabled"]),l.store_id?i.value?(u(),f("div",Je," 正在加载门店剧本... ")):D.value.length===0?(u(),f("div",Qe," 该门店暂无可用剧本 ")):y("",!0):(u(),f("div",Ge," 请先选择门店 "))]),_:1})]),_:1})]),_:1})])):y("",!0),l.order_type==="密室"?(u(),f("div",We,[t(_e,null,{default:e(()=>a[52]||(a[52]=[s("密室信息")])),_:1,__:[52]}),t(S,{gutter:16},{default:e(()=>[t(b,{span:24},{default:e(()=>[t(c,{label:"密室主题",name:"escape_room_id"},{default:e(()=>[t(v,{value:l.escape_room_id,"onUpdate:value":a[20]||(a[20]=o=>l.escape_room_id=o),placeholder:"选择密室主题",loading:i.value,disabled:!l.store_id,"show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(ee.value,o=>(u(),x(d,{key:o.id,value:o.id},{default:e(()=>{var B,J;return[s(_(o.name)+" (Rp "+_(((B=o.store_price)==null?void 0:B.toLocaleString())||((J=o.price)==null?void 0:J.toLocaleString())||"价格待定")+") ",1)]}),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","disabled"]),l.store_id?i.value?(u(),f("div",Ze," 正在加载门店密室... ")):ee.value.length===0?(u(),f("div",Ke," 该门店暂无可用密室 ")):y("",!0):(u(),f("div",Xe," 请先选择门店 "))]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(c,{name:"is_group_booking"},{default:e(()=>[t(se,{checked:l.is_group_booking,"onUpdate:checked":a[21]||(a[21]=o=>l.is_group_booking=o)},{default:e(()=>a[53]||(a[53]=[s("拼团")])),_:1,__:[53]},8,["checked"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{name:"include_photos"},{default:e(()=>[t(se,{checked:l.include_photos,"onUpdate:checked":a[22]||(a[22]=o=>l.include_photos=o)},{default:e(()=>a[54]||(a[54]=[s("包含拍照")])),_:1,__:[54]},8,["checked"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(c,{name:"include_cctv"},{default:e(()=>[t(se,{checked:l.include_cctv,"onUpdate:checked":a[23]||(a[23]=o=>l.include_cctv=o)},{default:e(()=>a[55]||(a[55]=[s("包含监控")])),_:1,__:[55]},8,["checked"])]),_:1})]),_:1})]),_:1})])):y("",!0),t(S,{gutter:16},{default:e(()=>[t(b,{span:12},{default:e(()=>[t(c,{label:"房间",name:"room_id"},{default:e(()=>[t(v,{value:l.room_id,"onUpdate:value":a[24]||(a[24]=o=>l.room_id=o),placeholder:"选择房间",loading:i.value||w.value,disabled:!l.store_id,"show-search":"","option-filter-prop":"children"},{default:e(()=>[(u(!0),f(H,null,V(R.value,o=>(u(),x(d,{key:o.id,value:o.id,disabled:o.status!=="正常"||A.value[o.id]&&!A.value[o.id].is_available},{default:e(()=>[s(_(ve(o)),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["value","loading","disabled"]),w.value?(u(),f("div",et," 正在检查房间可用性... ")):y("",!0)]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(b,{span:24},{default:e(()=>[t(c,{label:"备注",name:"notes"},{default:e(()=>[t(p,{value:l.notes,"onUpdate:value":a[25]||(a[25]=o=>l.notes=o),placeholder:"输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1})]),_:1}),l.free_pay==="Pay"?(u(),x(S,{key:3,gutter:16},{default:e(()=>[t(b,{span:24},{default:e(()=>[t(c,{label:"支付凭证"},{default:e(()=>[t(n,{"file-list":C.value,"onUpdate:fileList":a[26]||(a[26]=o=>C.value=o),"list-type":"picture-card","before-upload":ce,onPreview:ye,onRemove:ge,multiple:!0,accept:"image/*","max-count":5,action:null,"custom-request":()=>{},"show-upload-list":!0},{default:e(()=>[C.value.length<5?(u(),f("div",tt,[t(ue($e)),a[56]||(a[56]=h("div",{style:{"margin-top":"8px"}},"上传图片",-1))])):y("",!0)]),_:1},8,["file-list"]),a[57]||(a[57]=h("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 支持JPG、PNG格式，最多上传5张图片，每张不超过2MB ",-1))]),_:1,__:[57]})]),_:1})]),_:1})):y("",!0)]),_:1},8,["model"]),t(z,{open:X.value,footer:null,onCancel:a[27]||(a[27]=()=>X.value=!1)},{default:e(()=>[h("img",{alt:"preview",style:{width:"100%"},src:G.value},null,8,at)]),_:1},8,["open"])]),_:1},8,["open","title","confirm-loading"])}}},ot=Ie(lt,[["__scopeId","data-v-ac30546e"]]);const st={class:"order-container"},nt={class:"header-actions"},rt={class:"actions"},ut={key:0,class:"order-info"},it={class:"order-header"},dt={class:"order-id"},_t={class:"order-details"},pt={class:"order-date"},mt={class:"order-time"},ft={key:0,class:"order-subject"},vt={key:1,class:"order-subject"},ct={key:1,class:"customer-info"},yt={class:"customer-name"},gt={class:"customer-phone"},bt={class:"player-count"},kt={key:2,class:"store-room-info"},ht={class:"store-name"},wt={class:"room-name"},xt={class:"language-booking"},Ct={key:3,class:"payment-proof"},Pt={key:0,class:"proof-images"},Ot={class:"image-count"},Ut={class:"proof-thumbnails"},St=["src","alt","onClick"],zt={key:0,class:"more-indicator"},Lt={key:1,class:"no-proof"},$t={key:4,class:"game-host"},It={key:0,class:"host-name"},Ft={key:1,class:"no-host"},Bt={key:5,class:"pic-info"},Mt={key:0,class:"pic-name"},Rt={key:1,class:"pic-payment"},qt={key:2,class:"no-pic"},Nt={key:6,class:"payment-info"},Ht={class:"payment-amount"},Tt={key:0,class:"free-order"},jt={key:1,class:"amount"},At={key:8,class:"create-info"},Dt={class:"create-time"},Et={class:"create-by"},Vt={key:0,class:"update-info"},Yt={key:9,class:"action-buttons"},Gt={key:0,class:"order-detail"},Jt={key:0,class:"free-order"},Qt={key:1,class:"amount"},Wt={class:"order-images"},Xt=["src","alt","onClick"],Zt=["src"],Kt={key:0,class:"proof-preview-container"},ea={class:"proof-preview-main"},ta=["src","alt"],aa={key:0,class:"proof-preview-nav"},la={class:"proof-nav-info"},oa={key:1,class:"proof-preview-thumbnails"},sa=["src","alt","onClick"],na={__name:"OrderView",setup(N){const M=Re(),U=ze(()=>M.hasPermission("order.manage")),T=O(!1),j=O(!1),W=O([]),ae=O([]),i=O(null),w=xe({store_id:null,order_type:null,status:null,payment_status:null,customer_search:null}),C=xe({current:1,pageSize:20,total:0}),X=O(!1),G=O(!1),Z=O({}),D=O(!1),ee=[{title:"订单信息",key:"order_info",width:280,fixed:"left"},{title:"客户信息",key:"customer_info",width:150},{title:"门店房间",key:"store_room_info",width:180},{title:"付款凭证",key:"payment_proof",width:120},{title:"Game Host",key:"game_host",width:100},{title:"PIC负责人",key:"pic_info",width:100},{title:"支付信息",key:"payment_info",width:150},{title:"状态",key:"status",width:80},{title:"创建信息",key:"create_info",width:150},{title:"操作",key:"action",width:180,fixed:"right"}];Le(()=>{R(),A()});const R=async()=>{try{T.value=!0;const p=K();p.page=C.current,p.pageSize=C.pageSize;const n=await Y.getList(p);n.data&&(n.data.list?(W.value=n.data.list,C.total=n.data.total||0,C.current=n.data.page||C.current,C.pageSize=n.data.pageSize||C.pageSize):(W.value=n.data||[],C.total=n.data.length||0))}catch(p){console.error("加载订单列表失败:",p),L.error("加载订单列表失败")}finally{T.value=!1}},A=async()=>{try{const p=await je.getStoreList();ae.value=p.data||[]}catch(p){console.error("加载门店列表失败:",p)}},K=()=>{const p={};return w.store_id&&(p.store_id=w.store_id),w.order_type&&(p.order_type=w.order_type),w.status&&(p.status=w.status),w.payment_status&&(p.payment_status=w.payment_status),w.customer_search&&(/^\d+$/.test(w.customer_search)?p.customer_phone=w.customer_search:p.customer_name=w.customer_search),p},pe=()=>{C.current=1,R()},l=()=>{Object.keys(w).forEach(p=>{w[p]=null}),C.current=1,R()},me=(p,n,F)=>{C.current=p.current,C.pageSize=p.pageSize,R()},fe=()=>{D.value=!1,Z.value={},G.value=!0},ie=()=>{L.info("统计报表功能开发中...")},de=async()=>{try{j.value=!0;const p=K(),n=await Y.exportOrders(p),F=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),z=window.URL.createObjectURL(F),o=document.createElement("a");o.href=z;const B=new Date,J=B.toISOString().split("T")[0],ke=B.toTimeString().split(" ")[0].replace(/:/g,"-");o.download=`订单列表_${J}_${ke}.xlsx`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(z),L.success("订单导出成功")}catch(p){console.error("导出订单失败:",p),L.error("导出订单失败")}finally{j.value=!1}},ve=p=>{i.value=p,X.value=!0},ce=p=>{D.value=!0,Z.value={...p},G.value=!0},ye=p=>{Te.confirm({title:"确认删除",content:`确定要删除订单 ${p.id.substring(0,8)} 吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await Y.delete(p.id),L.success("删除成功"),R()}catch(n){console.error("删除失败:",n),L.error("删除失败")}}})},ge=async p=>{try{D.value?(await Y.update(p.id,p),L.success("更新成功")):(await Y.create(p),L.success("创建成功")),G.value=!1,R()}catch(n){console.error("操作失败:",n),L.error("操作失败")}},ne=p=>new Date(p).toLocaleDateString("zh-CN"),le=p=>p?new Date(p).toLocaleString("zh-CN"):"",re=p=>new Intl.NumberFormat("id-ID").format(p),r=p=>({CN:"中文",EN:"英语",IND:"印尼语"})[p]||p,a=p=>p==="剧本杀"?"blue":"green",d=p=>({pending:"orange",confirmed:"blue",in_progress:"cyan",completed:"green",cancelled:"red"})[p]||"default",v=p=>({pending:"待确认",confirmed:"已确认",in_progress:"进行中",completed:"已完成",cancelled:"已取消"})[p]||p,c=p=>({FULL:"green",DP:"orange","Not Yet":"red",Free:"purple"})[p]||"default",b=p=>({FULL:"已付全款",DP:"已付定金","Not Yet":"未付款",Free:"免费"})[p]||p,S=O(!1),$=O(""),oe=p=>{$.value=p,S.value=!0},E=O(!1),q=O([]),I=O(0),be=(p,n=0)=>{q.value=p,I.value=n,E.value=!0},se=()=>{I.value>0&&I.value--},_e=()=>{I.value<q.value.length-1&&I.value++};return(p,n)=>{const F=P("a-button"),z=P("a-select-option"),o=P("a-select"),B=P("a-form-item"),J=P("a-input"),ke=P("a-form"),Pe=P("a-card"),Q=P("a-tag"),Fe=P("a-table"),k=P("a-descriptions-item"),Be=P("a-descriptions"),he=P("a-modal");return u(),f("div",st,[h("div",nt,[n[12]||(n[12]=h("h2",null,"订单管理",-1)),h("div",rt,[U.value?(u(),x(F,{key:0,type:"primary",onClick:fe},{default:e(()=>[t(ue($e)),n[9]||(n[9]=s(" 新增订单 "))]),_:1,__:[9]})):y("",!0),t(F,{type:"default",onClick:ie},{default:e(()=>[t(ue(Ve)),n[10]||(n[10]=s(" 统计报表 "))]),_:1,__:[10]}),t(F,{type:"default",onClick:de,loading:j.value},{default:e(()=>[t(ue(qe)),n[11]||(n[11]=s(" 导出订单 "))]),_:1,__:[11]},8,["loading"])])]),t(Pe,{class:"filter-card"},{default:e(()=>[t(ke,{layout:"inline",model:w,onFinish:pe},{default:e(()=>[t(B,{label:"门店"},{default:e(()=>[t(o,{value:w.store_id,"onUpdate:value":n[0]||(n[0]=g=>w.store_id=g),placeholder:"选择门店",style:{width:"150px"},"allow-clear":""},{default:e(()=>[(u(!0),f(H,null,V(ae.value,g=>(u(),x(z,{key:g.id,value:g.id},{default:e(()=>[s(_(g.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(B,{label:"订单类型"},{default:e(()=>[t(o,{value:w.order_type,"onUpdate:value":n[1]||(n[1]=g=>w.order_type=g),placeholder:"选择类型",style:{width:"120px"},"allow-clear":""},{default:e(()=>[t(z,{value:"剧本杀"},{default:e(()=>n[13]||(n[13]=[s("剧本杀")])),_:1,__:[13]}),t(z,{value:"密室"},{default:e(()=>n[14]||(n[14]=[s("密室")])),_:1,__:[14]})]),_:1},8,["value"])]),_:1}),t(B,{label:"订单状态"},{default:e(()=>[t(o,{value:w.status,"onUpdate:value":n[2]||(n[2]=g=>w.status=g),placeholder:"选择状态",style:{width:"120px"},"allow-clear":""},{default:e(()=>[t(z,{value:"pending"},{default:e(()=>n[15]||(n[15]=[s("待确认")])),_:1,__:[15]}),t(z,{value:"confirmed"},{default:e(()=>n[16]||(n[16]=[s("已确认")])),_:1,__:[16]}),t(z,{value:"in_progress"},{default:e(()=>n[17]||(n[17]=[s("进行中")])),_:1,__:[17]}),t(z,{value:"completed"},{default:e(()=>n[18]||(n[18]=[s("已完成")])),_:1,__:[18]}),t(z,{value:"cancelled"},{default:e(()=>n[19]||(n[19]=[s("已取消")])),_:1,__:[19]})]),_:1},8,["value"])]),_:1}),t(B,{label:"支付状态"},{default:e(()=>[t(o,{value:w.payment_status,"onUpdate:value":n[3]||(n[3]=g=>w.payment_status=g),placeholder:"支付状态",style:{width:"120px"},"allow-clear":""},{default:e(()=>[t(z,{value:"FULL"},{default:e(()=>n[20]||(n[20]=[s("已付全款")])),_:1,__:[20]}),t(z,{value:"DP"},{default:e(()=>n[21]||(n[21]=[s("已付定金")])),_:1,__:[21]}),t(z,{value:"Not Yet"},{default:e(()=>n[22]||(n[22]=[s("未付款")])),_:1,__:[22]}),t(z,{value:"Free"},{default:e(()=>n[23]||(n[23]=[s("免费")])),_:1,__:[23]})]),_:1},8,["value"])]),_:1}),t(B,{label:"客户信息"},{default:e(()=>[t(J,{value:w.customer_search,"onUpdate:value":n[4]||(n[4]=g=>w.customer_search=g),placeholder:"姓名或电话",style:{width:"150px"},"allow-clear":""},null,8,["value"])]),_:1}),t(B,null,{default:e(()=>[t(F,{type:"primary","html-type":"submit"},{default:e(()=>[t(ue(Ne)),n[24]||(n[24]=s(" 查询 "))]),_:1,__:[24]}),t(F,{onClick:l,style:{"margin-left":"8px"}},{default:e(()=>n[25]||(n[25]=[s(" 重置 ")])),_:1,__:[25]})]),_:1})]),_:1},8,["model"])]),_:1}),t(Pe,null,{default:e(()=>[t(Fe,{columns:ee,"data-source":W.value,loading:T.value,"row-key":"id",scroll:{x:1900},pagination:{current:C.current,pageSize:C.pageSize,total:C.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(g,m)=>`第 ${m[0]}-${m[1]} 条，共 ${g} 条记录`,pageSizeOptions:["10","20","50","100"]},onChange:me},{bodyCell:e(({column:g,record:m})=>[g.key==="order_info"?(u(),f("div",ut,[h("div",it,[h("span",dt,_(m.id.substring(0,8)),1),t(Q,{color:a(m.order_type),size:"small"},{default:e(()=>[s(_(m.order_type),1)]),_:2},1032,["color"])]),h("div",_t,[h("div",pt,_(ne(m.order_date))+" "+_(m.weekday),1),h("div",mt,_(m.start_time)+" - "+_(m.end_time),1),m.script_name?(u(),f("div",ft,"剧本："+_(m.script_name),1)):y("",!0),m.escape_room_name?(u(),f("div",vt,"密室："+_(m.escape_room_name),1)):y("",!0)])])):g.key==="customer_info"?(u(),f("div",ct,[h("div",yt,_(m.customer_name),1),h("div",gt,_(m.customer_phone||"未提供"),1),h("div",bt,[s(_(m.player_count)+"人 ",1),m.internal_support?(u(),x(Q,{key:0,size:"small",color:"orange"},{default:e(()=>n[26]||(n[26]=[s("内部补位")])),_:1,__:[26]})):y("",!0)])])):g.key==="store_room_info"?(u(),f("div",kt,[h("div",ht,_(m.store_name||"未知门店"),1),h("div",wt,_(m.room_name||"未分配房间"),1),h("div",xt,[t(Q,{size:"small",color:"blue"},{default:e(()=>[s(_(r(m.language)),1)]),_:2},1024),t(Q,{size:"small",color:"green"},{default:e(()=>[s(_(m.booking_type),1)]),_:2},1024)])])):g.key==="payment_proof"?(u(),f("div",Ct,[m.images&&m.images.length>0?(u(),f("div",Pt,[h("div",Ot,_(m.images.length)+"张凭证",1),h("div",Ut,[(u(!0),f(H,null,V(m.images.slice(0,3),(te,Oe)=>(u(),f("img",{key:Oe,src:te.image_url,alt:te.image_name,class:"proof-thumbnail",onClick:ra=>be(m.images,Oe)},null,8,St))),128)),m.images.length>3?(u(),f("div",zt," +"+_(m.images.length-3),1)):y("",!0)])])):(u(),f("div",Lt,n[27]||(n[27]=[h("span",null,"无凭证",-1)])))])):g.key==="game_host"?(u(),f("div",$t,[m.game_host_name?(u(),f("div",It,_(m.game_host_name),1)):(u(),f("div",Ft,n[28]||(n[28]=[h("span",null,"未分配",-1)])))])):g.key==="pic_info"?(u(),f("div",Bt,[m.pic_name?(u(),f("div",Mt,_(m.pic_name),1)):y("",!0),m.pic_payment?(u(),f("div",Rt,[t(Q,{size:"small",color:"orange"},{default:e(()=>[s(_(m.pic_payment),1)]),_:2},1024)])):y("",!0),!m.pic_name&&!m.pic_payment?(u(),f("div",qt,n[29]||(n[29]=[h("span",null,"未分配",-1)]))):y("",!0)])):g.key==="payment_info"?(u(),f("div",Nt,[h("div",Ht,[m.is_free?(u(),f("span",Tt,"免费")):(u(),f("span",jt,"Rp "+_(re(m.total_amount)),1))]),t(Q,{color:c(m.payment_status),size:"small"},{default:e(()=>[s(_(b(m.payment_status)),1)]),_:2},1032,["color"])])):g.key==="status"?(u(),x(Q,{key:7,color:d(m.status)},{default:e(()=>[s(_(v(m.status)),1)]),_:2},1032,["color"])):g.key==="create_info"?(u(),f("div",At,[h("div",Dt,_(le(m.created_at)),1),h("div",Et,_(m.created_by_name||"系统"),1),m.updated_at&&m.updated_at!==m.created_at?(u(),f("div",Vt,[h("small",null,"更新: "+_(le(m.updated_at)),1)])):y("",!0)])):g.key==="action"?(u(),f("div",Yt,[t(F,{type:"link",size:"small",onClick:te=>ve(m)},{default:e(()=>n[30]||(n[30]=[s(" 查看 ")])),_:2,__:[30]},1032,["onClick"]),U.value?(u(),x(F,{key:0,type:"link",size:"small",onClick:te=>ce(m)},{default:e(()=>n[31]||(n[31]=[s(" 编辑 ")])),_:2,__:[31]},1032,["onClick"])):y("",!0),U.value?(u(),x(F,{key:1,type:"link",size:"small",onClick:te=>ye(m),danger:""},{default:e(()=>n[32]||(n[32]=[s(" 删除 ")])),_:2,__:[32]},1032,["onClick"])):y("",!0)])):y("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(ot,{visible:G.value,"onUpdate:visible":n[5]||(n[5]=g=>G.value=g),"form-data":Z.value,"is-edit":D.value,onSubmit:ge},null,8,["visible","form-data","is-edit"]),t(he,{open:X.value,"onUpdate:open":n[6]||(n[6]=g=>X.value=g),title:"订单详情",width:"1000px",footer:null},{default:e(()=>[i.value?(u(),f("div",Gt,[t(Be,{column:2,bordered:""},{default:e(()=>[t(k,{label:"订单编号",span:2},{default:e(()=>[s(_(i.value.id),1)]),_:1}),t(k,{label:"订单类型"},{default:e(()=>[s(_(i.value.order_type),1)]),_:1}),t(k,{label:"订单状态"},{default:e(()=>[t(Q,{color:d(i.value.status)},{default:e(()=>[s(_(v(i.value.status)),1)]),_:1},8,["color"])]),_:1}),t(k,{label:"客户姓名"},{default:e(()=>[s(_(i.value.customer_name),1)]),_:1}),t(k,{label:"客户电话"},{default:e(()=>[s(_(i.value.customer_phone||"未提供"),1)]),_:1}),t(k,{label:"玩家人数"},{default:e(()=>[s(_(i.value.player_count)+"人",1)]),_:1}),t(k,{label:"客户语言"},{default:e(()=>[s(_(r(i.value.language)),1)]),_:1}),t(k,{label:"门店"},{default:e(()=>[s(_(i.value.store_name),1)]),_:1}),t(k,{label:"房间"},{default:e(()=>[s(_(i.value.room_name),1)]),_:1}),t(k,{label:"订单日期"},{default:e(()=>[s(_(ne(i.value.order_date))+" "+_(i.value.weekday),1)]),_:1}),t(k,{label:"时间段"},{default:e(()=>[s(_(i.value.start_time)+" - "+_(i.value.end_time),1)]),_:1}),i.value.script_name?(u(),x(k,{key:0,label:"剧本",span:2},{default:e(()=>[s(_(i.value.script_name),1)]),_:1})):y("",!0),i.value.escape_room_name?(u(),x(k,{key:1,label:"密室主题",span:2},{default:e(()=>[s(_(i.value.escape_room_name),1)]),_:1})):y("",!0),i.value.order_type==="密室"?(u(),f(H,{key:2},[t(k,{label:"拼团"},{default:e(()=>[s(_(i.value.is_group_booking?"是":"否"),1)]),_:1}),t(k,{label:"包含拍照"},{default:e(()=>[s(_(i.value.include_photos?"是":"否"),1)]),_:1}),t(k,{label:"包含监控",span:2},{default:e(()=>[s(_(i.value.include_cctv?"是":"否"),1)]),_:1})],64)):y("",!0),i.value.game_host_name||i.value.npc_name||i.value.pic_name||i.value.pic_payment?(u(),f(H,{key:3},[i.value.game_host_name?(u(),x(k,{key:0,label:"Game Host"},{default:e(()=>[s(_(i.value.game_host_name),1)]),_:1})):y("",!0),i.value.npc_name?(u(),x(k,{key:1,label:"NPC"},{default:e(()=>[s(_(i.value.npc_name),1)]),_:1})):y("",!0),i.value.pic_name?(u(),x(k,{key:2,label:"PIC负责人"},{default:e(()=>[s(_(i.value.pic_name),1)]),_:1})):y("",!0),i.value.pic_payment?(u(),x(k,{key:3,label:"PIC Payment",span:i.value.pic_name?1:2},{default:e(()=>[s(_(i.value.pic_payment),1)]),_:1},8,["span"])):y("",!0)],64)):y("",!0),t(k,{label:"预订类型"},{default:e(()=>[s(_(i.value.booking_type),1)]),_:1}),t(k,{label:"内部补位"},{default:e(()=>[s(_(i.value.internal_support?"是":"否"),1)]),_:1}),t(k,{label:"支付状态"},{default:e(()=>[t(Q,{color:c(i.value.payment_status)},{default:e(()=>[s(_(b(i.value.payment_status)),1)]),_:1},8,["color"])]),_:1}),t(k,{label:"订单金额"},{default:e(()=>[i.value.is_free?(u(),f("span",Jt,"免费")):(u(),f("span",Qt,"Rp "+_(re(i.value.total_amount)),1))]),_:1}),i.value.payment_method?(u(),x(k,{key:4,label:"付款方式",span:i.value.payment_date?1:2},{default:e(()=>[s(_(i.value.payment_method),1)]),_:1},8,["span"])):y("",!0),i.value.payment_date?(u(),x(k,{key:5,label:"付款日期"},{default:e(()=>[s(_(ne(i.value.payment_date)),1)]),_:1})):y("",!0),i.value.promo_code||i.value.promo_quantity||i.value.promo_discount?(u(),f(H,{key:6},[i.value.promo_code?(u(),x(k,{key:0,label:"优惠码",span:i.value.promo_quantity?1:2},{default:e(()=>[s(_(i.value.promo_code),1)]),_:1},8,["span"])):y("",!0),i.value.promo_quantity?(u(),x(k,{key:1,label:"优惠数量"},{default:e(()=>[s(_(i.value.promo_quantity),1)]),_:1})):y("",!0),i.value.promo_discount?(u(),x(k,{key:2,label:"优惠折扣",span:2},{default:e(()=>[s("Rp "+_(re(i.value.promo_discount)),1)]),_:1})):y("",!0)],64)):y("",!0),i.value.notes?(u(),x(k,{key:7,label:"备注",span:2},{default:e(()=>[s(_(i.value.notes),1)]),_:1})):y("",!0),t(k,{label:"创建时间"},{default:e(()=>[s(_(le(i.value.created_at)),1)]),_:1}),t(k,{label:"创建人"},{default:e(()=>[s(_(i.value.created_by_name||"系统"),1)]),_:1}),i.value.updated_at&&i.value.updated_at!==i.value.created_at?(u(),x(k,{key:8,label:"更新时间",span:i.value.updated_by_name?1:2},{default:e(()=>[s(_(le(i.value.updated_at)),1)]),_:1},8,["span"])):y("",!0),i.value.updated_by_name?(u(),x(k,{key:9,label:"更新人"},{default:e(()=>[s(_(i.value.updated_by_name),1)]),_:1})):y("",!0),i.value.images&&i.value.images.length>0?(u(),x(k,{key:10,label:"付款凭证",span:2},{default:e(()=>[h("div",Wt,[(u(!0),f(H,null,V(i.value.images,(g,m)=>(u(),f("img",{key:m,src:g.image_url,alt:g.image_name,class:"order-image",onClick:te=>oe(g.image_url)},null,8,Xt))),128))])]),_:1})):y("",!0)]),_:1})])):y("",!0)]),_:1},8,["open"]),t(he,{open:S.value,"onUpdate:open":n[7]||(n[7]=g=>S.value=g),footer:null,width:"80%",style:{maxWidth:"800px"}},{default:e(()=>[h("img",{src:$.value,style:{width:"100%"}},null,8,Zt)]),_:1},8,["open"]),t(he,{open:E.value,"onUpdate:open":n[8]||(n[8]=g=>E.value=g),title:"付款凭证",footer:null,width:"90%",style:{maxWidth:"1000px"}},{default:e(()=>[q.value.length>0?(u(),f("div",Kt,[h("div",ea,[h("img",{src:q.value[I.value].image_url,alt:q.value[I.value].image_name,class:"proof-preview-image"},null,8,ta)]),q.value.length>1?(u(),f("div",aa,[t(F,{onClick:se,disabled:I.value===0,type:"text"},{default:e(()=>n[33]||(n[33]=[s(" 上一张 ")])),_:1,__:[33]},8,["disabled"]),h("span",la,_(I.value+1)+" / "+_(q.value.length),1),t(F,{onClick:_e,disabled:I.value===q.value.length-1,type:"text"},{default:e(()=>n[34]||(n[34]=[s(" 下一张 ")])),_:1,__:[34]},8,["disabled"])])):y("",!0),q.value.length>1?(u(),f("div",oa,[(u(!0),f(H,null,V(q.value,(g,m)=>(u(),f("img",{key:m,src:g.image_url,alt:g.image_name,class:He(["proof-preview-thumb",{active:m===I.value}]),onClick:te=>I.value=m},null,10,sa))),128))])):y("",!0)])):y("",!0)]),_:1},8,["open"])])}}},pa=Ie(na,[["__scopeId","data-v-40213fbb"]]);export{pa as default};
