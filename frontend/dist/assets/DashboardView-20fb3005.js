import{g as e,A as H,a as J,r as C,b as Q,q as W,c as l,o as _,d as R,w as t,m as $,f as r,n as b,i as O,h as f,t as P,e as X,s as Y,v as Z}from"./index-979b8016.js";import{u as ee}from"./user-5fd5b22f.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import{U as ae}from"./UserOutlined-0ca42527.js";import{B as oe}from"./BankOutlined-05c77fb5.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};const se=re;function j(m){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(p){return Object.getOwnPropertyDescriptor(s,p).enumerable}))),c.forEach(function(p){ne(m,p,s[p])})}return m}function ne(m,a,s){return a in m?Object.defineProperty(m,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):m[a]=s,m}var B=function(a,s){var c=j({},a,s.attrs);return e(H,j({},c,{icon:se}),null)};B.displayName="KeyOutlined";B.inheritAttrs=!1;const le=B;const ue={class:"dashboard"},de={__name:"DashboardView",setup(m){const a=J(),s=C(!1),c=C(!1),p=C(!1),U=C(),v=C({userCount:0,companyCount:0,storeCount:0,todayOrders:0}),u=Q({currentPassword:"",newPassword:"",confirmPassword:""}),z={currentPassword:[{required:!0,message:"请输入当前密码"}],newPassword:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度至少6位"}],confirmPassword:[{required:!0,message:"请确认新密码"},{validator:(n,o)=>o!==u.newPassword?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve()}]},D=n=>({platform:"purple",company:"blue",store:"green"})[n]||"default",N=n=>({platform:"平台级",company:"公司级",store:"门店级"})[n]||n,q=n=>({superadmin:"purple",admin:"blue",manager:"green",supervisor:"orange",service:"cyan",host:"gold"})[n]||"default",F=()=>{u.currentPassword="",u.newPassword="",u.confirmPassword="",c.value=!0},K=async()=>{try{await U.value.validate(),p.value=!0,await ee.resetUserPassword(a.user.id,u.newPassword),$.success("密码修改成功，请重新登录"),c.value=!1,setTimeout(()=>{a.logout()},1500)}catch(n){console.error("修改密码失败:",n),$.error("修改密码失败")}finally{p.value=!1}},M=async()=>{s.value=!0;try{await new Promise(n=>setTimeout(n,1e3)),a.isPlatformAdmin?v.value={userCount:156,companyCount:12,storeCount:45,todayOrders:234}:a.isCompanyAdmin?v.value={userCount:23,companyCount:0,storeCount:8,todayOrders:67}:v.value={userCount:5,companyCount:0,storeCount:0,todayOrders:12}}catch(n){console.error("获取统计数据失败:",n)}finally{s.value=!1}};return W(()=>{M()}),(n,o)=>{const k=l("a-statistic"),w=l("a-card"),g=l("a-col"),V=l("a-row"),A=l("a-button"),E=l("a-space"),y=l("a-descriptions-item"),h=l("a-tag"),I=l("a-descriptions"),x=l("a-input-password"),S=l("a-form-item"),T=l("a-form"),G=l("a-modal");return _(),R("div",ue,[e(V,{gutter:16},{default:t(()=>[e(g,{span:6},{default:t(()=>[e(w,{title:"用户总数",bordered:!1},{default:t(()=>[e(k,{value:v.value.userCount,loading:s.value,suffix:"人"},null,8,["value","loading"])]),_:1})]),_:1}),r(a).isPlatformAdmin?(_(),b(g,{key:0,span:6},{default:t(()=>[e(w,{title:"公司数量",bordered:!1},{default:t(()=>[e(k,{value:v.value.companyCount,loading:s.value,suffix:"家"},null,8,["value","loading"])]),_:1})]),_:1})):O("",!0),r(a).isPlatformAdmin||r(a).isCompanyAdmin?(_(),b(g,{key:1,span:6},{default:t(()=>[e(w,{title:"门店数量",bordered:!1},{default:t(()=>[e(k,{value:v.value.storeCount,loading:s.value,suffix:"家"},null,8,["value","loading"])]),_:1})]),_:1})):O("",!0),e(g,{span:6},{default:t(()=>[e(w,{title:"今日订单",bordered:!1},{default:t(()=>[e(k,{value:v.value.todayOrders,loading:s.value,suffix:"单"},null,8,["value","loading"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:16,style:{"margin-top":"16px"}},{default:t(()=>[e(g,{span:12},{default:t(()=>[e(w,{title:"快速操作",bordered:!1},{default:t(()=>[e(E,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(A,{type:"primary",size:"large",block:"",onClick:o[0]||(o[0]=d=>n.$router.push("/users"))},{default:t(()=>[e(r(ae)),o[6]||(o[6]=f(" 用户管理 "))]),_:1,__:[6]}),r(a).isPlatformAdmin?(_(),b(A,{key:0,size:"large",block:"",onClick:o[1]||(o[1]=d=>n.$router.push("/company"))},{default:t(()=>[e(r(oe)),o[7]||(o[7]=f(" 公司管理 "))]),_:1,__:[7]})):O("",!0),e(A,{size:"large",block:"",onClick:F},{default:t(()=>[e(r(le)),o[8]||(o[8]=f(" 修改密码 "))]),_:1,__:[8]})]),_:1})]),_:1})]),_:1}),e(g,{span:12},{default:t(()=>[e(w,{title:"用户信息",bordered:!1},{default:t(()=>[e(I,{column:1},{default:t(()=>{var d,L;return[e(y,{label:"姓名"},{default:t(()=>{var i;return[f(P(((i=r(a).user)==null?void 0:i.name)||"-"),1)]}),_:1}),e(y,{label:"邮箱"},{default:t(()=>{var i;return[f(P(((i=r(a).user)==null?void 0:i.email)||"-"),1)]}),_:1}),e(y,{label:"账户级别"},{default:t(()=>[e(h,{color:D(r(a).accountLevel)},{default:t(()=>[f(P(N(r(a).accountLevel)),1)]),_:1},8,["color"])]),_:1}),e(y,{label:"角色"},{default:t(()=>[e(h,{color:q(r(a).userRole)},{default:t(()=>[f(P(r(a).userRole||"-"),1)]),_:1},8,["color"])]),_:1}),(d=r(a).user)!=null&&d.company_name?(_(),b(y,{key:0,label:"公司"},{default:t(()=>{var i;return[f(P((i=r(a).user)==null?void 0:i.company_name),1)]}),_:1})):O("",!0),(L=r(a).user)!=null&&L.stores&&r(a).user.stores.length>0?(_(),b(y,{key:1,label:"门店"},{default:t(()=>[X("div",null,[(_(!0),R(Y,null,Z(r(a).user.stores,i=>(_(),b(h,{key:i.id,color:"green"},{default:t(()=>[f(P(i.name),1)]),_:2},1024))),128))])]),_:1})):O("",!0)]}),_:1})]),_:1})]),_:1})]),_:1}),e(G,{open:c.value,"onUpdate:open":o[5]||(o[5]=d=>c.value=d),title:"修改密码","ok-button-props":{loading:p.value},onOk:K},{default:t(()=>[e(T,{ref_key:"passwordFormRef",ref:U,model:u,rules:z,layout:"vertical"},{default:t(()=>[e(S,{label:"当前密码",name:"currentPassword"},{default:t(()=>[e(x,{value:u.currentPassword,"onUpdate:value":o[2]||(o[2]=d=>u.currentPassword=d),placeholder:"请输入当前密码"},null,8,["value"])]),_:1}),e(S,{label:"新密码",name:"newPassword"},{default:t(()=>[e(x,{value:u.newPassword,"onUpdate:value":o[3]||(o[3]=d=>u.newPassword=d),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),e(S,{label:"确认新密码",name:"confirmPassword"},{default:t(()=>[e(x,{value:u.confirmPassword,"onUpdate:value":o[4]||(o[4]=d=>u.confirmPassword=d),placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"])])}}},_e=te(de,[["__scopeId","data-v-82c41300"]]);export{_e as default};
