import{x as V,a as se,r as f,b as T,q as ue,c as d,o as g,d as re,e as z,f as k,n as w,w as o,i as C,g as n,y as $,T as me,B as L,m as y,P as ie,h as r,t as v}from"./index-979b8016.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const N={getCompanyList(){return V.get("/api/company")},createCompany(x){return V.post("/api/company",x)},getCompanyDetail(x){return V.get(`/api/company/${x}`)},updateCompany(x,p){return V.put(`/api/company/${x}`,p)}};const ce={class:"company-view"},pe={class:"page-header"},_e={__name:"CompanyView",setup(x){const p=se(),E=f(!1),U=f(!1),I=f(!1),q=f(!1),R=f(!1),A=f([]),O=f(),S=f(),m=f(null),W=[{title:"公司名称",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type",customRender:({text:t})=>t||"-"},{title:"联系人",dataIndex:"contact_name",key:"contact_name",customRender:({text:t})=>t||"-"},{title:"联系电话",dataIndex:"contact_phone",key:"contact_phone",customRender:({text:t})=>t||"-"},{title:"联系邮箱",dataIndex:"contact_email",key:"contact_email",customRender:({text:t})=>t||"-"},{title:"门店数量",dataIndex:"store_count",key:"store_count",customRender:({text:t})=>t||0},{title:"用户数量",dataIndex:"user_count",key:"user_count",customRender:({text:t})=>t||0},{title:"状态",dataIndex:"status",key:"status",customRender:({text:t})=>{const u={active:{text:"正常",color:"success"},inactive:{text:"停用",color:"error"}}[t]||{text:"未知",color:"default"};return $(me,{color:u.color},()=>u.text)}},{title:"操作",key:"action",customRender:({record:t})=>{const e=p.hasPermission("company.edit")||p.hasPermission("company.*")||p.isPlatformAdmin;return $("div",{class:"action-buttons"},[$(L,{type:"link",onClick:()=>Y(t)},()=>"查看"),e&&$(L,{type:"link",onClick:()=>Z(t)},()=>"编辑")])}}],l=T({company_name:"",company_type:"加盟",contact_name:"",contact_email:"",contact_phone:"",admin_name:"",admin_email:"",admin_phone:"",admin_password:"",admin_account_level:"company"}),s=T({name:"",contact_name:"",contact_email:"",contact_phone:"",status:"active"}),M=(t,e)=>e?/^8[1-9][0-9]{6,9}$/.test(e)?Promise.resolve():Promise.reject(new Error("请输入有效的印尼手机号（8开头，8-12位数字）")):Promise.resolve(),G={company_name:[{required:!0,message:"请输入公司名称"}],contact_name:[{required:!0,message:"请输入联系人姓名"}],contact_email:[{type:"email",message:"请输入正确的邮箱格式"}],contact_phone:[{validator:M}],admin_name:[{required:!0,message:"请输入管理员姓名"}],admin_email:[{required:!0,message:"请输入管理员邮箱"},{type:"email",message:"请输入正确的邮箱格式"}],admin_phone:[{validator:M}],admin_password:[{required:!0,message:"请输入初始密码"},{min:6,message:"密码长度至少6位"}],admin_account_level:[{required:!0,message:"请选择管理员账户级别"}]},H={name:[{required:!0,message:"请输入公司名称"}],contact_name:[{required:!0,message:"请输入联系人姓名"}],contact_email:[{type:"email",message:"请输入正确的邮箱格式"}],contact_phone:[{validator:M}]},B=async()=>{try{E.value=!0;const t=await N.getCompanyList();t.success&&t.data?A.value=Array.isArray(t.data)?t.data:[t.data]:(A.value=[],y.warning("暂无公司数据"))}catch(t){console.error("获取公司列表失败:",t),y.error("获取公司列表失败"),A.value=[]}finally{E.value=!1}},J=async()=>{try{await O.value.validate();const t={name:l.company_name,type:l.company_type,contact_name:l.contact_name,contact_email:l.contact_email,contact_phone:l.contact_phone,admin_name:l.admin_name,admin_email:l.admin_email,admin_password:l.admin_password,admin_account_level:l.admin_account_level};t.contact_phone&&t.contact_phone.length>0&&t.contact_phone.startsWith("8")&&(t.contact_phone=`0${t.contact_phone}`),U.value=!0;const e=await N.createCompany(t);console.log("创建公司响应:",e),y.success("公司创建成功"),I.value=!1,Object.keys(l).forEach(u=>{u==="company_type"?l[u]="加盟":u==="admin_account_level"?l[u]="company":l[u]=""}),await B()}catch(t){if(console.error("创建公司失败:",t),t.response&&t.response.status===400&&t.response.data.details){const u=t.response.data.details.map(h=>h.msg).join("；");y.error(`参数验证失败：${u}`)}else t.response&&t.response.data.error?y.error(t.response.data.error):y.error("创建公司失败")}finally{U.value=!1}},K=t=>{q.value=!0,m.value=t},Q=t=>{R.value=!0,m.value=t,s.name=t.name,s.contact_name=t.contact_name,s.contact_email=t.contact_email,s.contact_phone=t.contact_phone,s.status=t.status},X=async()=>{var t,e;try{await S.value.validate(),U.value=!0;const u=await N.updateCompany(m.value.id,s);y.success("更新公司信息成功"),R.value=!1,await B()}catch(u){console.error("更新公司信息失败:",u),(e=(t=u.response)==null?void 0:t.data)!=null&&e.error?y.error(u.response.data.error):y.error("更新公司信息失败")}finally{U.value=!1}},Y=t=>{m.value=t,q.value=!0},Z=async t=>{R.value=!0,m.value=t,s.name=t.name,s.contact_name=t.contact_name,s.contact_email=t.contact_email,s.contact_phone=t.contact_phone,s.status=t.status};return ue(()=>{B()}),(t,e)=>{const u=d("a-button"),h=d("a-tag"),ee=d("a-space"),ae=d("a-table"),_=d("a-input"),i=d("a-form-item"),P=d("a-select-option"),F=d("a-select"),te=d("a-divider"),ne=d("a-input-password"),j=d("a-form"),D=d("a-modal"),b=d("a-descriptions-item"),oe=d("a-descriptions");return g(),re("div",ce,[z("div",pe,[e[20]||(e[20]=z("h2",null,"公司管理",-1)),k(p).hasPermission("company.create")&&k(p).isPlatformAdmin?(g(),w(u,{key:0,type:"primary",onClick:e[0]||(e[0]=a=>I.value=!0)},{default:o(()=>[n(k(ie)),e[19]||(e[19]=r(" 创建公司 "))]),_:1,__:[19]})):C("",!0)]),n(ae,{columns:W,"data-source":A.value,loading:E.value,"row-key":"id"},{bodyCell:o(({column:a,record:c})=>[a.key==="type"?(g(),w(h,{key:0,color:c.type==="直营"?"blue":"green"},{default:o(()=>[r(v(c.type),1)]),_:2},1032,["color"])):C("",!0),a.key==="status"?(g(),w(h,{key:1,color:c.status==="active"?"success":"default"},{default:o(()=>[r(v(c.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):C("",!0),a.key==="action"?(g(),w(ee,{key:2},{default:o(()=>[k(p).hasPermission("company.view")?(g(),w(u,{key:0,size:"small",onClick:le=>K(c)},{default:o(()=>e[21]||(e[21]=[r(" 查看 ")])),_:2,__:[21]},1032,["onClick"])):C("",!0),k(p).hasPermission("company.edit")?(g(),w(u,{key:1,size:"small",type:"primary",onClick:le=>Q(c)},{default:o(()=>e[22]||(e[22]=[r(" 编辑 ")])),_:2,__:[22]},1032,["onClick"])):C("",!0)]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading"]),n(D,{open:I.value,"onUpdate:open":e[11]||(e[11]=a=>I.value=a),title:"创建公司","ok-button-props":{loading:U.value},onOk:J},{default:o(()=>[n(j,{ref_key:"createFormRef",ref:O,model:l,rules:G,layout:"vertical"},{default:o(()=>[n(i,{label:"公司名称",name:"company_name"},{default:o(()=>[n(_,{value:l.company_name,"onUpdate:value":e[1]||(e[1]=a=>l.company_name=a),placeholder:"请输入公司名称"},null,8,["value"])]),_:1}),n(i,{label:"公司类型",name:"company_type"},{default:o(()=>[n(F,{value:l.company_type,"onUpdate:value":e[2]||(e[2]=a=>l.company_type=a),placeholder:"请选择公司类型"},{default:o(()=>[n(P,{value:"直营"},{default:o(()=>e[23]||(e[23]=[r("直营")])),_:1,__:[23]}),n(P,{value:"加盟"},{default:o(()=>e[24]||(e[24]=[r("加盟")])),_:1,__:[24]})]),_:1},8,["value"])]),_:1}),n(i,{label:"联系人",name:"contact_name"},{default:o(()=>[n(_,{value:l.contact_name,"onUpdate:value":e[3]||(e[3]=a=>l.contact_name=a),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),n(i,{label:"联系邮箱",name:"contact_email"},{default:o(()=>[n(_,{value:l.contact_email,"onUpdate:value":e[4]||(e[4]=a=>l.contact_email=a),placeholder:"请输入联系邮箱（可选）",type:"email"},null,8,["value"])]),_:1}),n(i,{label:"联系电话",name:"contact_phone"},{default:o(()=>[n(_,{value:l.contact_phone,"onUpdate:value":e[5]||(e[5]=a=>l.contact_phone=a),placeholder:"请输入联系电话（可选）","addon-before":"+62"},null,8,["value"])]),_:1}),n(te,null,{default:o(()=>e[25]||(e[25]=[r("管理员账号信息")])),_:1,__:[25]}),n(i,{label:"管理员姓名",name:"admin_name"},{default:o(()=>[n(_,{value:l.admin_name,"onUpdate:value":e[6]||(e[6]=a=>l.admin_name=a),placeholder:"请输入管理员姓名"},null,8,["value"])]),_:1}),n(i,{label:"管理员邮箱",name:"admin_email"},{default:o(()=>[n(_,{value:l.admin_email,"onUpdate:value":e[7]||(e[7]=a=>l.admin_email=a),placeholder:"请输入管理员邮箱",type:"email"},null,8,["value"])]),_:1}),n(i,{label:"管理员手机号",name:"admin_phone"},{default:o(()=>[n(_,{value:l.admin_phone,"onUpdate:value":e[8]||(e[8]=a=>l.admin_phone=a),placeholder:"请输入管理员手机号（可选）","addon-before":"+62"},null,8,["value"])]),_:1}),n(i,{label:"初始密码",name:"admin_password"},{default:o(()=>[n(ne,{value:l.admin_password,"onUpdate:value":e[9]||(e[9]=a=>l.admin_password=a),placeholder:"请设置初始密码"},null,8,["value"])]),_:1}),n(i,{label:"账户级别",name:"admin_account_level"},{default:o(()=>[n(F,{value:l.admin_account_level,"onUpdate:value":e[10]||(e[10]=a=>l.admin_account_level=a),placeholder:"请选择管理员账户级别",disabled:!k(p).isPlatformAdmin},{default:o(()=>[n(P,{value:"company"},{default:o(()=>e[26]||(e[26]=[r("公司级账户")])),_:1,__:[26]}),k(p).isPlatformAdmin?(g(),w(P,{key:0,value:"store"},{default:o(()=>e[27]||(e[27]=[r("门店级账户")])),_:1,__:[27]})):C("",!0)]),_:1},8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"]),n(D,{open:q.value,"onUpdate:open":e[12]||(e[12]=a=>q.value=a),title:"公司详情",footer:null,width:"600px"},{default:o(()=>[n(oe,{bordered:""},{default:o(()=>[n(b,{label:"公司名称",span:3},{default:o(()=>{var a;return[r(v((a=m.value)==null?void 0:a.name),1)]}),_:1}),n(b,{label:"公司类型",span:3},{default:o(()=>{var a;return[n(h,{color:((a=m.value)==null?void 0:a.type)==="直营"?"blue":"green"},{default:o(()=>{var c;return[r(v((c=m.value)==null?void 0:c.type),1)]}),_:1},8,["color"])]}),_:1}),n(b,{label:"联系人",span:3},{default:o(()=>{var a;return[r(v((a=m.value)==null?void 0:a.contact_name),1)]}),_:1}),n(b,{label:"联系邮箱",span:3},{default:o(()=>{var a;return[r(v(((a=m.value)==null?void 0:a.contact_email)||"-"),1)]}),_:1}),n(b,{label:"联系电话",span:3},{default:o(()=>{var a;return[r(v(((a=m.value)==null?void 0:a.contact_phone)||"-"),1)]}),_:1}),n(b,{label:"门店数",span:3},{default:o(()=>{var a;return[r(v((a=m.value)==null?void 0:a.store_count),1)]}),_:1}),n(b,{label:"员工数",span:3},{default:o(()=>{var a;return[r(v((a=m.value)==null?void 0:a.user_count),1)]}),_:1}),n(b,{label:"状态",span:3},{default:o(()=>{var a;return[n(h,{color:((a=m.value)==null?void 0:a.status)==="active"?"success":"default"},{default:o(()=>{var c;return[r(v(((c=m.value)==null?void 0:c.status)==="active"?"启用":"禁用"),1)]}),_:1},8,["color"])]}),_:1})]),_:1})]),_:1},8,["open"]),n(D,{open:R.value,"onUpdate:open":e[18]||(e[18]=a=>R.value=a),title:"编辑公司","ok-button-props":{loading:U.value},onOk:X},{default:o(()=>[n(j,{ref_key:"editFormRef",ref:S,model:s,rules:H,layout:"vertical"},{default:o(()=>[n(i,{label:"公司名称",name:"name"},{default:o(()=>[n(_,{value:s.name,"onUpdate:value":e[13]||(e[13]=a=>s.name=a),placeholder:"请输入公司名称"},null,8,["value"])]),_:1}),n(i,{label:"联系人",name:"contact_name"},{default:o(()=>[n(_,{value:s.contact_name,"onUpdate:value":e[14]||(e[14]=a=>s.contact_name=a),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),n(i,{label:"联系邮箱",name:"contact_email"},{default:o(()=>[n(_,{value:s.contact_email,"onUpdate:value":e[15]||(e[15]=a=>s.contact_email=a),placeholder:"请输入联系邮箱（可选）",type:"email"},null,8,["value"])]),_:1}),n(i,{label:"联系电话",name:"contact_phone"},{default:o(()=>[n(_,{value:s.contact_phone,"onUpdate:value":e[16]||(e[16]=a=>s.contact_phone=a),placeholder:"请输入联系电话（可选）","addon-before":"+62"},null,8,["value"])]),_:1}),n(i,{label:"状态",name:"status"},{default:o(()=>[n(F,{value:s.status,"onUpdate:value":e[17]||(e[17]=a=>s.status=a)},{default:o(()=>[n(P,{value:"active"},{default:o(()=>e[28]||(e[28]=[r("启用")])),_:1,__:[28]}),n(P,{value:"inactive"},{default:o(()=>e[29]||(e[29]=[r("禁用")])),_:1,__:[29]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"])])}}},ye=de(_e,[["__scopeId","data-v-280b11a8"]]);export{ye as default};
