import{g as l,A as re,r as h,b as St,q as Tt,m as w,c as T,o as d,d as p,w as c,e,f as O,M as _t,t as v,h as k,s as R,v as V,n as K,W as Pt,Q as da,i as S,K as ca,H as va,X as ma,L as pa,Y as zt,N as je,p as Fe,J as _a,u as fa,G as N,k as Me,l as Ue,Z as ft,_ as gt,S as ga,E as we,$ as ya,U as ba,D as ha,a0 as ka}from"./index-979b8016.js";import{o as yt,g as Oa,a as wa,c as $a,b as Ca,d as Ye,p as Da}from"./order-662eb60a.js";import{g as Ia}from"./user-5fd5b22f.js";import{_ as xt}from"./_plugin-vue_export-helper-c27b6911.js";import{U as He}from"./UserOutlined-0ca42527.js";import{B as Sa}from"./BankOutlined-05c77fb5.js";import{U as Ta}from"./UploadOutlined-d2112608.js";var Pa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"};const za=Pa;function bt(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){xa(i,g,o[g])})}return i}function xa(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var We=function(r,o){var _=bt({},r,o.attrs);return l(re,bt({},_,{icon:za}),null)};We.displayName="CameraOutlined";We.inheritAttrs=!1;const $e=We;var Ma={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};const Ua=Ma;function ht(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){ja(i,g,o[g])})}return i}function ja(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var qe=function(r,o){var _=ht({},r,o.attrs);return l(re,ht({},_,{icon:Ua}),null)};qe.displayName="CreditCardOutlined";qe.inheritAttrs=!1;const Ge=qe;var Ha={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar",theme:"outlined"};const Na=Ha;function kt(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){Ba(i,g,o[g])})}return i}function Ba(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var Ze=function(r,o){var _=kt({},r,o.attrs);return l(re,kt({},_,{icon:Na}),null)};Ze.displayName="DollarOutlined";Ze.inheritAttrs=!1;const Ra=Ze;var Va={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M834.1 469.2A347.49 347.49 0 00751.2 354l-29.1-26.7a8.09 8.09 0 00-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 01-47.5 46.1 352.6 352.6 0 00-100.3 121.5A347.75 347.75 0 00160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0075.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 00760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0027.7-136c0-48.8-10-96.2-29.9-140.9zM713 808.5c-53.7 53.2-125 82.4-201 82.4s-147.3-29.2-201-82.4c-53.5-53.1-83-123.5-83-198.4 0-43.5 9.8-85.2 29.1-124 18.8-37.9 46.8-71.8 80.8-97.9a349.6 349.6 0 0058.6-56.8c25-30.5 44.6-64.5 58.2-101a240 240 0 0012.1-46.5c24.1 22.2 44.3 49 61.2 80.4 33.4 62.6 48.8 118.3 45.8 165.7a74.01 74.01 0 0024.4 59.8 73.36 73.36 0 0053.4 18.8c19.7-1 37.8-9.7 51-24.4 13.3-14.9 24.8-30.1 34.4-45.6 14 17.9 25.7 37.4 35 58.4 15.9 35.8 24 73.9 24 113.1 0 74.9-29.5 145.4-83 198.4z"}}]},name:"fire",theme:"outlined"};const Ea=Va;function Ot(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){Aa(i,g,o[g])})}return i}function Aa(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var Qe=function(r,o){var _=Ot({},r,o.attrs);return l(re,Ot({},_,{icon:Ea}),null)};Qe.displayName="FireOutlined";Qe.inheritAttrs=!1;const La=Qe;var Ya={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 310H732.4c13.6-21.4 21.6-46.8 21.6-74 0-76.1-61.9-138-138-138-41.4 0-78.7 18.4-104 47.4-25.3-29-62.6-47.4-104-47.4-76.1 0-138 61.9-138 138 0 27.2 7.9 52.6 21.6 74H144c-17.7 0-32 14.3-32 32v200c0 4.4 3.6 8 8 8h40v344c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V550h40c4.4 0 8-3.6 8-8V342c0-17.7-14.3-32-32-32zm-334-74c0-38.6 31.4-70 70-70s70 31.4 70 70-31.4 70-70 70h-70v-70zm-138-70c38.6 0 70 31.4 70 70v70h-70c-38.6 0-70-31.4-70-70s31.4-70 70-70zM180 482V378h298v104H180zm48 68h250v308H228V550zm568 308H546V550h250v308zm48-376H546V378h298v104z"}}]},name:"gift",theme:"outlined"};const Ga=Ya;function wt(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){Fa(i,g,o[g])})}return i}function Fa(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var Je=function(r,o){var _=wt({},r,o.attrs);return l(re,wt({},_,{icon:Ga}),null)};Je.displayName="GiftOutlined";Je.inheritAttrs=!1;const Wa=Je;var qa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"};const Za=qa;function $t(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){Qa(i,g,o[g])})}return i}function Qa(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var Xe=function(r,o){var _=$t({},r,o.attrs);return l(re,$t({},_,{icon:Za}),null)};Xe.displayName="PictureOutlined";Xe.inheritAttrs=!1;const Ja=Xe;var Xa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M468 128H160c-17.7 0-32 14.3-32 32v308c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V136c0-4.4-3.6-8-8-8zm-56 284H192V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210H136c-4.4 0-8 3.6-8 8v308c0 17.7 14.3 32 32 32h308c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zm-56 284H192V612h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm590-630H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V160c0-17.7-14.3-32-32-32zm-32 284H612V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210h-48c-4.4 0-8 3.6-8 8v134h-78V556c0-4.4-3.6-8-8-8H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h78v102c0 4.4 3.6 8 8 8h190c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zM746 832h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm142 0h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"qrcode",theme:"outlined"};const Ka=Xa;function Ct(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){el(i,g,o[g])})}return i}function el(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var Ke=function(r,o){var _=Ct({},r,o.attrs);return l(re,Ct({},_,{icon:Ka}),null)};Ke.displayName="QrcodeOutlined";Ke.inheritAttrs=!1;const tl=Ke;var al={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"};const ll=al;function Dt(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){sl(i,g,o[g])})}return i}function sl(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var et=function(r,o){var _=Dt({},r,o.attrs);return l(re,Dt({},_,{icon:ll}),null)};et.displayName="TagOutlined";et.inheritAttrs=!1;const Mt=et;var nl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"};const ol=nl;function It(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(o).filter(function(g){return Object.getOwnPropertyDescriptor(o,g).enumerable}))),_.forEach(function(g){rl(i,g,o[g])})}return i}function rl(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var tt=function(r,o){var _=It({},r,o.attrs);return l(re,It({},_,{icon:ol}),null)};tt.displayName="TeamOutlined";tt.inheritAttrs=!1;const Ut=tt;const il={class:"payment-confirm-container"},ul={class:"booking-summary-card"},dl={class:"compact-header"},cl={class:"booking-info-grid"},vl={class:"info-item"},ml={class:"value"},pl={class:"info-item"},_l={class:"value"},fl={class:"info-item"},gl={class:"value"},yl={class:"info-item"},bl={class:"value highlight"},hl={class:"info-item"},kl={class:"value highlight"},Ol={class:"form-card"},wl={class:"compact-header"},$l={class:"form-grid"},Cl={class:"form-item"},Dl={class:"form-item"},Il={class:"form-item"},Sl={class:"form-item"},Tl={class:"form-card"},Pl={class:"compact-header"},zl={class:"form-grid"},xl={class:"form-item"},Ml={class:"staff-option"},Ul={class:"real-name"},jl={class:"form-item"},Hl={class:"staff-option"},Nl={class:"real-name"},Bl={class:"form-item",style:{display:"none"}},Rl={class:"form-card"},Vl={class:"compact-header"},El={class:"payment-section"},Al={class:"payment-type-selector"},Ll={key:0,class:"payment-details"},Yl={class:"form-grid"},Gl={class:"form-item"},Fl={class:"form-item"},Wl={class:"form-item"},ql={key:1,class:"free-notice"},Zl={class:"form-card"},Ql={class:"compact-header"},Jl={class:"form-grid"},Xl={class:"form-item"},Kl={class:"form-item"},es={key:0,class:"form-card"},ts={class:"compact-header"},as={class:"photo-section"},ls={class:"photo-actions"},ss={key:0,class:"images-preview"},ns={class:"images-grid"},os=["src","alt"],rs={class:"image-overlay"},is={class:"images-info"},us={key:1,class:"empty-photos"},ds={class:"empty-icon"},cs={class:"form-card"},vs={class:"compact-header"},ms={class:"textarea-container"},ps={class:"action-buttons"},_s={class:"camera-container"},fs={class:"camera-controls"},gs=["src"],ys={__name:"OrderPaymentConfirm",props:{bookingData:{type:Object,required:!0}},emits:["cancel","success"],setup(i,{emit:r}){const o=i,_=r,g=h(!1),A=h(!1),Y=h(!1),ee=h([]),ie=h(!1),ue=h(!1),de=h(!1),Z=h(),P=h(),f=h(null),C=h([]),$=h(!1),G=h(""),u=St({player_count:null,customer_name:"",customer_phone:"",language:"",game_host_id:null,pic_id:null,pic_payment:"",free_pay:"",payment_status:"",booking_type:"",payment_method:"",promo_quantity:null,total_amount:null,notes:""});Tt(()=>{D(),Q()});const D=()=>{o.bookingData.store_price&&(u.total_amount=o.bookingData.store_price),o.bookingData.store_price>0&&(u.free_pay="Pay",u.payment_status="Not Yet")},Q=async()=>{if(o.bookingData.store_id)try{A.value=!0;const y=await Ia(o.bookingData.store_id);ee.value=y.data||[]}catch(y){console.error("加载Game Host失败:",y),w.error("加载Game Host失败")}finally{A.value=!1}},F=y=>{if(!y)return"";const a=new Date(y),M=["SUN","MON","TUE","WED","THU","FRI","SAT"][a.getDay()];return`${y} ${M}`},W=(y,a)=>{const x=a.label||a.children||"",M=y.toLowerCase();if(typeof x=="string")return x.toLowerCase().includes(M);const I=a.value,j=ee.value.find(ne=>ne.user_id===I);return j?j.username.toLowerCase().includes(M)||j.real_name&&j.real_name.toLowerCase().includes(M):!1},U=async()=>{ie.value=!0,ue.value=!0;try{const y=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});await _a(),Z.value&&(Z.value.srcObject=y,f.value=y,de.value=!0)}catch(y){console.error("无法访问相机:",y),w.error("无法访问相机，请检查权限设置")}finally{ue.value=!1}},se=()=>{f.value&&(f.value.getTracks().forEach(y=>y.stop()),f.value=null),de.value=!1,ie.value=!1},te=()=>{if(!Z.value||!P.value)return;const y=Z.value,a=P.value,x=a.getContext("2d");a.width=y.videoWidth,a.height=y.videoHeight,x.drawImage(y,0,0),a.toBlob(M=>{const I=URL.createObjectURL(M),j=new Date().getTime();C.value.push({url:I,blob:M,name:`payment_${j}.jpg`,type:"payment"}),w.success("拍照成功"),se()},"image/jpeg",.8)},q=y=>{if(!y.type.startsWith("image/"))return w.error("只能上传图片文件"),!1;if(!(y.size/1024/1024<5))return w.error("图片大小不能超过5MB"),!1;const M=URL.createObjectURL(y);return C.value.push({url:M,blob:y,name:y.name,type:"payment"}),w.success("图片添加成功"),!1},J=y=>{G.value=y,$.value=!0},he=y=>{const a=C.value[y];URL.revokeObjectURL(a.url),C.value.splice(y,1),w.success("图片删除成功")},pe=()=>{var y;if(!u.player_count||u.player_count<1)return w.error("请输入有效的游戏人数"),!1;if(!((y=u.customer_name)!=null&&y.trim()))return w.error("请输入客户姓名"),!1;if(!u.language)return w.error("请选择客户语言"),!1;if(!u.game_host_id)return w.error("请选择Game Host"),!1;if(!u.free_pay)return w.error("请选择支付类型"),!1;if(u.free_pay==="Pay"){if(!u.payment_status)return w.error("请选择支付状态"),!1;if(!u.payment_method)return w.error("请选择付款方式"),!1;if(!u.total_amount||u.total_amount<=0)return w.error("请输入有效的总金额"),!1}return u.booking_type?!0:(w.error("请选择预订类型"),!1)},_e=async()=>{var y,a;if(pe())try{Y.value=!0;let x=[];C.value.length>0&&(x=await ve());const I={中文:"CN",英语:"EN",印尼语:"IND",CN:"CN",EN:"EN",IND:"IND"}[u.language]||u.language,j={order_type:o.bookingData.item_type==="script"?"剧本杀":"密室",store_id:o.bookingData.store_id,room_id:o.bookingData.room_id,order_date:o.bookingData.date,start_time:o.bookingData.start_time,end_time:o.bookingData.end_time,...o.bookingData.item_type==="script"?{script_id:o.bookingData.item_id,script_name:o.bookingData.item_name}:{escape_room_id:o.bookingData.item_id,escape_room_name:o.bookingData.item_name},customer_name:u.customer_name,customer_phone:u.customer_phone||null,player_count:u.player_count,language:I,game_host_id:u.game_host_id,pic_id:u.pic_id||null,pic_payment:u.pic_payment,free_pay:u.free_pay,payment_status:u.free_pay==="Free"?"Free":u.payment_status,booking_type:u.booking_type,payment_method:u.free_pay==="Pay"?u.payment_method:null,promo_quantity:u.promo_quantity||null,total_amount:u.free_pay==="Pay"?u.total_amount:0,notes:u.notes,images:x,status:"confirmed"};console.log("创建订单数据:",j);const ne=await yt.create(j);w.success("订单创建成功！"),_("success",ne.data)}catch(x){console.error("创建订单失败:",x),w.error(((a=(y=x.response)==null?void 0:y.data)==null?void 0:a.message)||"创建订单失败")}finally{Y.value=!1}},ve=async()=>{try{const y=new FormData;return C.value.forEach((x,M)=>{y.append("images",x.blob,x.name)}),(await yt.uploadImages(y)).data.images||[]}catch(y){return console.error("上传图片失败:",y),w.error("上传付款凭证失败"),[]}},ce=()=>{C.value.forEach(y=>{URL.revokeObjectURL(y.url)}),_("cancel")};return(y,a)=>{const x=T("a-input-number"),M=T("a-input"),I=T("a-select-option"),j=T("a-select"),ne=T("a-radio-button"),me=T("a-radio-group"),Ce=T("a-alert"),ae=T("a-button"),fe=T("a-upload"),Ne=T("a-textarea"),Be=T("a-spin"),De=T("a-modal");return d(),p("div",il,[l(Be,{spinning:g.value,tip:"加载中..."},{default:c(()=>[e("div",ul,[e("div",dl,[l(O(_t),{class:"header-icon"}),a[16]||(a[16]=e("span",{class:"header-title"},"预订信息确认",-1))]),e("div",cl,[e("div",vl,[a[17]||(a[17]=e("label",null,"项目名称",-1)),e("span",ml,v(i.bookingData.item_name),1)]),e("div",pl,[a[18]||(a[18]=e("label",null,"门店",-1)),e("span",_l,v(i.bookingData.store_name),1)]),e("div",fl,[a[19]||(a[19]=e("label",null,"房间",-1)),e("span",gl,v(i.bookingData.room_name),1)]),e("div",yl,[a[20]||(a[20]=e("label",null,"日期",-1)),e("span",bl,v(F(i.bookingData.date)),1)]),e("div",hl,[a[21]||(a[21]=e("label",null,"时间",-1)),e("span",kl,v(i.bookingData.start_time)+" - "+v(i.bookingData.end_time),1)])])]),e("div",Ol,[e("div",wl,[l(O(He),{class:"header-icon"}),a[22]||(a[22]=e("span",{class:"header-title"},"客户信息",-1))]),e("div",$l,[e("div",Cl,[a[23]||(a[23]=e("label",{class:"required"},"游戏人数",-1)),l(x,{value:u.player_count,"onUpdate:value":a[0]||(a[0]=b=>u.player_count=b),min:1,max:20,placeholder:"请输入人数",class:"full-width"},null,8,["value"])]),e("div",Dl,[a[24]||(a[24]=e("label",{class:"required"},"客户姓名",-1)),l(M,{value:u.customer_name,"onUpdate:value":a[1]||(a[1]=b=>u.customer_name=b),placeholder:"请输入客户姓名"},null,8,["value"])]),e("div",Il,[a[25]||(a[25]=e("label",null,"客户电话",-1)),l(M,{value:u.customer_phone,"onUpdate:value":a[2]||(a[2]=b=>u.customer_phone=b),placeholder:"请输入客户电话（选填）"},null,8,["value"])]),e("div",Sl,[a[29]||(a[29]=e("label",{class:"required"},"客户语言",-1)),l(j,{value:u.language,"onUpdate:value":a[3]||(a[3]=b=>u.language=b),placeholder:"请选择客户语言",class:"full-width"},{default:c(()=>[l(I,{value:"印尼语"},{default:c(()=>a[26]||(a[26]=[k("🇮🇩 印尼语")])),_:1,__:[26]}),l(I,{value:"英语"},{default:c(()=>a[27]||(a[27]=[k("🇺🇸 英语")])),_:1,__:[27]}),l(I,{value:"中文"},{default:c(()=>a[28]||(a[28]=[k("🇨🇳 中文")])),_:1,__:[28]})]),_:1},8,["value"])])])]),e("div",Tl,[e("div",Pl,[l(O(Ut),{class:"header-icon"}),a[30]||(a[30]=e("span",{class:"header-title"},"工作人员配置",-1))]),e("div",zl,[e("div",xl,[a[31]||(a[31]=e("label",{class:"required"},"Game Host",-1)),l(j,{value:u.game_host_id,"onUpdate:value":a[4]||(a[4]=b=>u.game_host_id=b),placeholder:"请选择Game Host",loading:A.value,class:"full-width","show-search":"","filter-option":W},{default:c(()=>[(d(!0),p(R,null,V(ee.value,b=>(d(),K(I,{key:b.user_id,value:b.user_id},{default:c(()=>[e("div",Ml,[l(O(He)),e("span",null,v(b.username),1),e("span",Ul,"("+v(b.real_name||b.username)+")",1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),e("div",jl,[a[32]||(a[32]=e("label",null,"PIC 负责人",-1)),l(j,{value:u.pic_id,"onUpdate:value":a[5]||(a[5]=b=>u.pic_id=b),placeholder:"请选择PIC（选填）",loading:A.value,class:"full-width",allowClear:"","show-search":"","filter-option":W},{default:c(()=>[(d(!0),p(R,null,V(ee.value,b=>(d(),K(I,{key:b.user_id,value:b.user_id},{default:c(()=>[e("div",Hl,[l(O(He)),e("span",null,v(b.username),1),e("span",Nl,"("+v(b.real_name||b.username)+")",1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),e("div",Bl,[a[33]||(a[33]=e("label",null,"PIC Payment",-1)),l(M,{value:u.pic_payment,"onUpdate:value":a[6]||(a[6]=b=>u.pic_payment=b),placeholder:"PIC Payment"},null,8,["value"])])])]),e("div",Rl,[e("div",Vl,[l(O(Ge),{class:"header-icon"}),a[34]||(a[34]=e("span",{class:"header-title"},"支付信息",-1))]),e("div",El,[e("div",Al,[a[37]||(a[37]=e("label",{class:"required"},"支付类型",-1)),l(me,{value:u.free_pay,"onUpdate:value":a[7]||(a[7]=b=>u.free_pay=b),class:"payment-radio-group"},{default:c(()=>[l(ne,{value:"Free",class:"free-option"},{default:c(()=>[l(O(Wa)),a[35]||(a[35]=k(" Free "))]),_:1,__:[35]}),l(ne,{value:"Pay",class:"pay-option"},{default:c(()=>[l(O(Ra)),a[36]||(a[36]=k(" Pay "))]),_:1,__:[36]})]),_:1},8,["value"])]),u.free_pay==="Pay"?(d(),p("div",Ll,[e("div",Yl,[e("div",Gl,[a[41]||(a[41]=e("label",{class:"required"},"支付状态",-1)),l(j,{value:u.payment_status,"onUpdate:value":a[8]||(a[8]=b=>u.payment_status=b),placeholder:"请选择支付状态",class:"full-width"},{default:c(()=>[l(I,{value:"FULL"},{default:c(()=>[l(O(_t),{style:{color:"#52c41a"}}),a[38]||(a[38]=k(" FULL (已全付) "))]),_:1,__:[38]}),l(I,{value:"DP"},{default:c(()=>[l(O(Pt),{style:{color:"#faad14"}}),a[39]||(a[39]=k(" DP (定金) "))]),_:1,__:[39]}),l(I,{value:"Not Yet"},{default:c(()=>[l(O(da),{style:{color:"#ff4d4f"}}),a[40]||(a[40]=k(" Not Yet (未付) "))]),_:1,__:[40]})]),_:1},8,["value"])]),e("div",Fl,[a[46]||(a[46]=e("label",{class:"required"},"付款方式",-1)),l(j,{value:u.payment_method,"onUpdate:value":a[9]||(a[9]=b=>u.payment_method=b),placeholder:"请选择付款方式",class:"full-width"},{default:c(()=>[l(I,{value:"Bank Transfer"},{default:c(()=>[l(O(Sa)),a[42]||(a[42]=k(" Bank Transfer "))]),_:1,__:[42]}),l(I,{value:"QR BCA"},{default:c(()=>[l(O(tl)),a[43]||(a[43]=k(" QR BCA "))]),_:1,__:[43]}),l(I,{value:"DEBIT"},{default:c(()=>[l(O(Ge)),a[44]||(a[44]=k(" DEBIT "))]),_:1,__:[44]}),l(I,{value:"CC"},{default:c(()=>[l(O(Ge)),a[45]||(a[45]=k(" CC "))]),_:1,__:[45]})]),_:1},8,["value"])]),e("div",Wl,[a[47]||(a[47]=e("label",{class:"required"},"总金额",-1)),l(x,{value:u.total_amount,"onUpdate:value":a[10]||(a[10]=b=>u.total_amount=b),min:0,placeholder:"请输入总金额",class:"full-width",formatter:b=>`Rp ${b}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:b=>b.replace(/Rp\s?|(,*)/g,"")},null,8,["value","formatter","parser"])])])])):u.free_pay==="Free"?(d(),p("div",ql,[l(Ce,{message:"免费游戏",description:"此订单为免费游戏，无需支付费用",type:"success","show-icon":""})])):S("",!0)])]),e("div",Zl,[e("div",Ql,[l(O(Mt),{class:"header-icon"}),a[48]||(a[48]=e("span",{class:"header-title"},"预订详情",-1))]),e("div",Jl,[e("div",Xl,[a[56]||(a[56]=e("label",{class:"required"},"预订类型",-1)),l(j,{value:u.booking_type,"onUpdate:value":a[11]||(a[11]=b=>u.booking_type=b),placeholder:"请选择预订类型",class:"full-width"},{default:c(()=>[l(I,{value:"Booking"},{default:c(()=>a[49]||(a[49]=[k("📅 Booking")])),_:1,__:[49]}),l(I,{value:"Walk In"},{default:c(()=>a[50]||(a[50]=[k("🚶 Walk In")])),_:1,__:[50]}),l(I,{value:"Traveloka"},{default:c(()=>a[51]||(a[51]=[k("✈️ Traveloka")])),_:1,__:[51]}),l(I,{value:"Tiket.com"},{default:c(()=>a[52]||(a[52]=[k("🎫 Tiket.com")])),_:1,__:[52]}),l(I,{value:"Gamehost/Staff Booking"},{default:c(()=>a[53]||(a[53]=[k("👨‍💼 Gamehost/Staff Booking")])),_:1,__:[53]}),l(I,{value:"MyValue（Gramedia）"},{default:c(()=>a[54]||(a[54]=[k("📚 MyValue（Gramedia）")])),_:1,__:[54]}),l(I,{value:"Promo"},{default:c(()=>a[55]||(a[55]=[k("🎉 Promo")])),_:1,__:[55]})]),_:1},8,["value"])]),e("div",Kl,[a[57]||(a[57]=e("label",null,"促销数量",-1)),l(x,{value:u.promo_quantity,"onUpdate:value":a[12]||(a[12]=b=>u.promo_quantity=b),min:0,placeholder:"请输入促销数量（选填）",class:"full-width"},null,8,["value"])])])]),u.free_pay==="Pay"?(d(),p("div",es,[e("div",ts,[l(O($e),{class:"header-icon"}),a[58]||(a[58]=e("span",{class:"header-title"},"付款凭证",-1)),a[59]||(a[59]=e("span",{class:"header-subtitle"},"拍摄客户付款凭证图片",-1))]),e("div",as,[e("div",ls,[l(ae,{type:"primary",onClick:U,loading:ue.value,class:"camera-btn"},{default:c(()=>[l(O($e)),a[60]||(a[60]=k(" 拍摄付款凭证 "))]),_:1,__:[60]},8,["loading"]),l(fe,{"file-list":[],"before-upload":q,accept:"image/*","show-upload-list":!1},{default:c(()=>[l(ae,{class:"upload-btn"},{default:c(()=>[l(O(Ta)),a[61]||(a[61]=k(" 从相册选择 "))]),_:1,__:[61]})]),_:1})]),C.value.length>0?(d(),p("div",ss,[e("div",ns,[(d(!0),p(R,null,V(C.value,(b,ke)=>(d(),p("div",{key:ke,class:"image-item"},[e("img",{src:b.url,alt:`付款凭证${ke+1}`},null,8,os),e("div",rs,[l(ae,{type:"text",size:"small",onClick:oe=>J(b.url),class:"preview-btn"},{default:c(()=>[l(O(ca))]),_:2},1032,["onClick"]),l(ae,{type:"text",size:"small",onClick:oe=>he(ke),class:"remove-btn"},{default:c(()=>[l(O(va))]),_:2},1032,["onClick"])])]))),128))]),e("div",is,[l(O(ma)),k(" 已添加 "+v(C.value.length)+" 张付款凭证图片 ",1)])])):(d(),p("div",us,[e("div",ds,[l(O($e))]),a[62]||(a[62]=e("p",null,"暂无付款凭证图片",-1)),a[63]||(a[63]=e("p",{class:"empty-hint"},"点击上方按钮拍摄或选择图片",-1))]))])])):S("",!0),e("div",cs,[e("div",vs,[l(O(pa),{class:"header-icon"}),a[64]||(a[64]=e("span",{class:"header-title"},"备注信息",-1))]),e("div",ms,[l(Ne,{value:u.notes,"onUpdate:value":a[13]||(a[13]=b=>u.notes=b),placeholder:"请输入备注信息（选填）",rows:3},null,8,["value"])])]),e("div",ps,[l(ae,{onClick:ce,class:"cancel-btn"},{default:c(()=>[l(O(zt)),a[65]||(a[65]=k(" 返回预订 "))]),_:1,__:[65]}),l(ae,{type:"primary",onClick:_e,loading:Y.value,class:"submit-btn"},{default:c(()=>[l(O(je)),a[66]||(a[66]=k(" 确认创建订单 "))]),_:1,__:[66]},8,["loading"])])]),_:1},8,["spinning"]),l(De,{open:ie.value,"onUpdate:open":a[14]||(a[14]=b=>ie.value=b),title:"拍摄付款凭证",footer:null,width:"90%",style:{maxWidth:"600px"},onCancel:se},{default:c(()=>[e("div",_s,[e("video",{ref_key:"videoRef",ref:Z,autoplay:"",playsinline:"",class:"camera-video",style:Fe({display:de.value?"block":"none"})},null,4),e("canvas",{ref_key:"canvasRef",ref:P,class:"camera-canvas",style:{display:"none"}},null,512),e("div",fs,[l(ae,{type:"primary",size:"large",onClick:te,disabled:!de.value,class:"capture-btn"},{default:c(()=>[l(O($e)),a[67]||(a[67]=k(" 拍照 "))]),_:1,__:[67]},8,["disabled"]),l(ae,{size:"large",onClick:se,class:"close-camera-btn"},{default:c(()=>a[68]||(a[68]=[k(" 关闭相机 ")])),_:1,__:[68]})])])]),_:1},8,["open"]),l(De,{open:$.value,"onUpdate:open":a[15]||(a[15]=b=>$.value=b),footer:null,width:"80%",style:{maxWidth:"800px"}},{default:c(()=>[e("img",{src:G.value,style:{width:"100%"}},null,8,gs)]),_:1},8,["open"])])}}},bs=xt(ys,[["__scopeId","data-v-b9422a96"]]);const hs={class:"booking-container"},ks={class:"booking-tabs"},Os={class:"booking-content"},ws={class:"booking-filters"},$s={class:"filter-group search-group"},Cs={class:"filter-group"},Ds={key:0,style:{color:"#ff4d4f","margin-left":"4px"}},Is={key:0,class:"filter-group"},Ss={key:1,class:"filter-group"},Ts={class:"filter-group"},Ps={class:"filter-group"},zs={class:"filter-actions"},xs={class:"booking-items"},Ms={key:0,class:"empty-state"},Us={key:1,class:"items-grid"},js=["onClick"],Hs={class:"item-cover"},Ns=["src","alt"],Bs={key:1,class:"no-image"},Rs={class:"item-type-badge"},Vs={key:2,class:"image-count"},Es={class:"item-info"},As={class:"item-name"},Ls={class:"item-details"},Ys={class:"detail-row"},Gs={class:"detail-row"},Fs={key:0,class:"detail-row"},Ws={key:1,class:"detail-row"},qs={key:2,class:"detail-row"},Zs={class:"item-price"},Qs={class:"price-value"},Js={class:"store-count"},Xs={key:1,class:"booking-detail"},Ks={class:"detail-content"},en={class:"detail-close"},tn={class:"detail-header"},an={class:"item-tags"},ln={key:0,class:"detail-images"},sn={class:"image-gallery"},nn=["src","alt","onClick"],on={class:"detail-description"},rn={class:"detail-attributes"},un={class:"attr-row"},dn={class:"attr-row"},cn={key:0,class:"attr-row"},vn={key:1,class:"attr-row"},mn={class:"booking-section"},pn={key:0},_n={key:0,class:"selected-indicator"},fn={key:1,class:"collapse-icon"},gn={class:"step-content"},yn={class:"store-info"},bn={class:"store-name"},hn={class:"store-address"},kn={class:"store-price"},On={key:1,class:"booking-step auto-store-info"},wn={class:"step-header"},$n={class:"step-number"},Cn={class:"step-content"},Dn={class:"auto-store-card"},In={class:"store-info"},Sn={class:"store-name"},Tn={class:"store-address"},Pn={class:"store-price"},zn={class:"auto-reason"},xn={key:2,class:"booking-step modern-time-selection"},Mn={class:"step-header"},Un={class:"step-number"},jn={key:0,class:"selected-indicator"},Hn={class:"step-content"},Nn={key:0,class:"store-closed-notice"},Bn={key:1,class:"modern-calendar-container"},Rn={class:"calendar-header"},Vn={class:"date-range-selector"},En={class:"view-controls"},An={key:0,class:"room-selector"},Ln={key:1,class:"time-grid-container"},Yn={class:"time-grid"},Gn={class:"day-name"},Fn={class:"day-date"},Wn={class:"time-grid-body"},qn={class:"time-label"},Zn=["data-date","data-hour","onClick"],Qn=["onClick"],Jn={key:2},Xn={key:0,class:"no-rooms"},Kn={key:3,class:"booking-step booking-actions"},eo={class:"step-header"},to={class:"step-number"},ao={class:"step-content"},lo={class:"booking-summary"},so={class:"summary-item"},no={class:"summary-item"},oo={class:"summary-item"},ro={class:"summary-item"},io={class:"summary-item total-price"},uo={key:1},co={class:"payment-content"},vo={key:0,class:"image-preview"},mo={class:"carousel-arrow prev-arrow"},po={class:"carousel-arrow next-arrow"},_o=["src","alt"],fo={class:"preview-counter"},go={class:"custom-time-form"},yo={class:"form-item"},bo={class:"form-item"},ho={class:"form-item"},ko={class:"form-item"},Oo={key:0,class:"occupancy-detail"},wo={class:"detail-header"},$o={class:"conflicting-orders"},Co={class:"order-info"},Do={class:"order-header"},Io={class:"order-type"},So={class:"order-details"},To={key:0},Po={key:1},zo={__name:"BookingView",setup(i){fa();const r=h(!1),o=h(!1),_=h(!1),g=h(!1),A=h("booking"),Y=h("all"),ee=h(null),ie=h([]),ue=h({script_types:[],escape_room_horror_levels:[]}),de=h([]),Z=h(""),P=St({store_id:null,script_types:[],horror_levels:[],min_players:null,max_players:null,min_price:null,max_price:null}),f=h(null),C=h(null),$=h(null),G=h(!0),u=h(null);h(N().startOf("week"));const D=h({date:null,startTime:null,endTime:null,roomId:null}),Q=h("none"),F=h(null),W=h(null),U=h([]),se=h(new Map),te=h([N(),N().add(6,"day")]),q=h(null),J=h(null),he=h(!1),pe=h([]),_e=h(0),ve=h(!1),ce=h(null),y=h(null),a=h(null),x=h(!1),M=h(null),I=h(!0),j=()=>{I.value=!I.value},ne=Me(()=>ie.value),me=Me(()=>{const s=[],t=N().startOf("day");if(te.value&&te.value.length===2){const m=te.value[0],B=te.value[1].diff(m,"day")+1;for(let L=0;L<B;L++){const E=m.add(L,"day");E.isBefore(t)||s.push({date:E.format("YYYY-MM-DD"),dayName:["周日","周一","周二","周三","周四","周五","周六"][E.day()],dayNumber:E.format("DD"),dayjs:E})}}return s}),Ce=Me(()=>{const s=[];for(let t=9;t<=23;t++)for(let m=0;m<60&&!(t===23&&m>0);m+=30)s.push(t+m/60);return s}),ae=Me(()=>N());Tt(()=>{fe(),Ne()}),Ue(f,s=>{s?Be(s.type,s.id):Ht()}),Ue($,()=>{q.value=null,J.value=null,U.value=[],u.value=null,D.value={date:null,startTime:null,endTime:null,roomId:null},Q.value="none",F.value=null,W.value=null,se.value.clear(),$.value&&(I.value=!1,De())}),Ue(u,()=>{u.value&&Se()}),Ue(q,s=>{s&&$.value&&b(),J.value=null});const fe=async()=>{var s,t;try{r.value=!0;const m={item_type:Y.value,keyword:Z.value||void 0,store_id:P.store_id||void 0,min_players:P.min_players||void 0,max_players:P.max_players||void 0,min_price:P.min_price||void 0,max_price:P.max_price||void 0,script_types:P.script_types.length>0?P.script_types:void 0,horror_levels:P.horror_levels.length>0?P.horror_levels:void 0};Object.keys(m).forEach(B=>{m[B]===void 0&&delete m[B]}),console.log("📋 加载预订项目:",m);const z=await Oa(m);console.log("📋 预订项目响应:",z),ie.value=((s=z.data)==null?void 0:s.items)||[],ue.value=((t=z.data)==null?void 0:t.categories)||{},console.log("📋 项目数据:",{items:ie.value.length,categories:ue.value})}catch(m){console.error("加载预订项目失败:",m),w.error("加载预订项目失败")}finally{r.value=!1}},Ne=async()=>{try{console.log("🏪 加载可选门店...");const s=await wa();console.log("🏪 门店响应:",s),de.value=s.data||[],console.log("🏪 门店数据:",{stores:de.value.length})}catch(s){console.error("加载门店列表失败:",s),w.error("加载门店列表失败")}},Be=async(s,t)=>{try{o.value=!0,console.log("🎯 加载项目详情:",{itemType:s,itemId:t});const m=await Ca(s,t);console.log("🎯 项目详情响应:",m),C.value=m.data,console.log("🎯 项目详情数据:",C.value),C.value&&(G.value=C.value.need_store_selection,!G.value&&C.value.auto_selected_store?($.value=C.value.auto_selected_store.store_id,console.log("🏪 自动选择门店:",{storeId:$.value,storeName:C.value.auto_selected_store.store_name,reason:C.value.total_user_stores===1?"用户只有一个门店":"项目只在一个门店上架"})):($.value!==null&&($.value=null),I.value=!0)),q.value=null,J.value=null,U.value=[],u.value=null,D.value={date:null,startTime:null,endTime:null,roomId:null},Q.value="none",F.value=null,W.value=null,se.value.clear()}catch(m){console.error("加载项目详情失败:",m),w.error("加载项目详情失败")}finally{o.value=!1}},De=async()=>{var s;if(!(!$.value||!f.value))try{_.value=!0;const m={date:N().format("YYYY-MM-DD"),item_type:f.value.type,item_id:f.value.id};console.log("🏠 加载房间列表:",{storeId:$.value,params:m});const z=await Ye($.value,m);console.log("📅 房间列表响应:",z),U.value=((s=z.data)==null?void 0:s.rooms)||[],console.log("🏠 房间列表数据:",U.value),U.value.length===1&&(u.value=U.value[0].room_id)}catch(t){console.error("加载房间列表失败:",t),w.error("加载房间列表失败")}finally{_.value=!1}},b=async()=>{var s;if(!f.value){console.log("🏠 未选择项目，无法加载房间时间表");return}try{_.value=!0;const t={date:q.value.format("YYYY-MM-DD"),item_type:f.value.type,item_id:f.value.id};console.log("🏠 加载房间时间表:",{storeId:$.value,params:t});const m=await Ye($.value,t);console.log("📅 房间时间表响应:",m),U.value=((s=m.data)==null?void 0:s.rooms)||[],console.log("🕐 房间时间表数据:",U.value)}catch(t){console.error("加载房间时间表失败:",t),w.error("加载房间时间表失败")}finally{_.value=!1}},ke=s=>{Y.value=s,Z.value="",lt()},oe=()=>{fe()},at=()=>{fe()},lt=()=>{Z.value="",Object.keys(P).forEach(s=>{Array.isArray(P[s])?P[s]=[]:P[s]=null}),fe()},jt=s=>{f.value=s},st=()=>{f.value=null,G.value=!0,$.value=null,q.value=null,J.value=null,U.value=[],I.value=!0},Ht=()=>{G.value&&($.value=null,I.value=!0),q.value=null,J.value=null,U.value=[]},Nt=()=>{},Bt=async()=>{try{if(g.value=!0,!D.value.date||!D.value.startTime||!D.value.endTime||!D.value.roomId){w.error("请先选择完整的时间段");return}const s={store_id:$.value,room_id:D.value.roomId,item_type:f.value.type,item_id:f.value.id,date:D.value.date,start_time:X(D.value.startTime),end_time:X(D.value.endTime)},t=await Da(s);if(!t.data.is_available){w.error(t.data.message||"选择的时间段不可用");return}ee.value={item_type:f.value.type,item_id:f.value.id,item_name:f.value.name,store_id:$.value,store_name:Ve(),room_id:D.value.roomId,room_name:rt(),date:D.value.date,start_time:X(D.value.startTime),end_time:X(D.value.endTime),store_price:it()},A.value="payment"}catch(s){console.error("预检查失败:",s),w.error("预检查失败，请重试")}finally{g.value=!1}},Rt=s=>{A.value=s},Re=s=>s?s.startsWith("http")?s:`http://localhost:3000${s}`:"",nt=s=>{s.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik03NSA2MEw5MCA0NUwxMTUgNzBMMTM1IDUwTDE2NSA4MEwxNjUgMTIwSDM1VjgwTDU1IDYwTDc1IDYwWiIgZmlsbD0iI0QwRDBEMCIvPgo8Y2lyY2xlIGN4PSI2MCIgY3k9IjUwIiByPSIxMCIgZmlsbD0iI0QwRDBEMCIvPgo8dGV4dCB4PSIxMDAiIHk9IjkwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5OTk5IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiPuaXoOWbvueJhzwvdGV4dD4KPHN2Zz4="},Ie=s=>new Intl.NumberFormat("id-ID").format(s||0),Vt=s=>{const t=N(s),z=["SUN","MON","TUE","WED","THU","FRI","SAT"][t.day()];return`${t.format("YYYY-MM-DD")} ${z}`},Et=s=>s&&s<N().startOf("day"),ot=(s,t=0)=>{pe.value=s,_e.value=t,he.value=!0},Ve=()=>{if(!C.value||!$.value)return"";const s=C.value.available_stores.find(t=>t.store_id===$.value);return(s==null?void 0:s.store_name)||""},rt=()=>{var m;const s=u.value||((m=J.value)==null?void 0:m.room_id);if(!s)return"";const t=U.value.find(z=>z.room_id===s);return(t==null?void 0:t.room_name)||""},it=()=>{var t,m;if(!C.value||!$.value)return((t=f.value)==null?void 0:t.price)||0;const s=C.value.available_stores.find(z=>z.store_id===$.value);return(s==null?void 0:s.store_price)||((m=f.value)==null?void 0:m.price)||0},At=async()=>{if(!ce.value||!y.value){w.error("请选择开始和结束时间");return}if(ce.value>=y.value){w.error("结束时间必须晚于开始时间");return}try{g.value=!0;const s={date:q.value.format("YYYY-MM-DD"),start_time:ce.value.format("HH:mm"),end_time:y.value.format("HH:mm")};console.log("🕐 检查自定义时间段:",{storeId:$.value,roomId:a.value,params:s});const t=await $a($.value,a.value,s);console.log("🕐 自定义时间段响应:",t),t.data.is_available?(J.value={start_time:s.start_time,end_time:s.end_time,is_available:!0,slot_type:"custom",room_id:a.value},ve.value=!1,w.success("自定义时间段可用")):(M.value={room_id:a.value,time_slot:`${s.start_time} - ${s.end_time}`,conflicting_orders:t.data.conflict_details||[]},x.value=!0,ve.value=!1)}catch(s){console.error("检查自定义时间段失败:",s),w.error("检查时间段失败，请重试")}finally{g.value=!1}},Lt=()=>{ve.value=!1,ce.value=null,y.value=null,a.value=null},ut=s=>{const t=U.value.find(m=>m.room_id===s);return(t==null?void 0:t.room_name)||"未知房间"},Yt=()=>{if(!$.value||!C.value)return!1;if(C.value.auto_selected_store)return C.value.auto_selected_store.store_status==="已停业";const s=C.value.available_stores.find(t=>t.store_id===$.value);return(s==null?void 0:s.store_status)==="已停业"},dt=()=>{if(!D.value.date||!D.value.startTime||!D.value.endTime)return"";const s=N(D.value.date).format("M月D日"),t=X(D.value.startTime),m=X(D.value.endTime);return`${s} ${t} - ${m}`},X=s=>{const t=Math.floor(s),m=s%1*60;return`${t.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},Gt=()=>{te.value=[N(),N().add(6,"day")],Se()},Ft=s=>N(s).isSame(N(),"day"),Wt=s=>N(s).isBefore(N(),"day"),Ee=(s,t)=>N(s).hour(Math.floor(t)).minute(t%1*60).isBefore(ae.value),qt=()=>{vt(),Se()},Zt=(s,t)=>{const m=[];return Ee(s,t)&&m.push("past"),ge(s,t)?m.push("occupied"):Ee(s,t)||m.push("available"),Qt(s,t)&&m.push("selected"),Jt(s,t)&&m.push("start-selected"),m},Qt=(s,t)=>!D.value.date||!D.value.startTime||!D.value.endTime||D.value.date!==s?!1:t>=D.value.startTime&&t<=D.value.endTime,Jt=(s,t)=>Q.value==="selecting_end"&&W.value===s&&F.value===t,Xt=(s,t)=>{if(Ee(s,t)){w.warning("不能选择过去的时间");return}if(ge(s,t)){w.warning("该时间段已被占用");return}if(Q.value==="none")F.value=t,W.value=s,Q.value="selecting_end",D.value={date:null,startTime:null,endTime:null,roomId:u.value},w.info("已选择开始时间，请选择结束时间");else if(Q.value==="selecting_end"){if(W.value!==s){w.warning("开始时间和结束时间必须在同一天");return}if(t<=F.value){F.value=t,W.value=s,w.info("已重新选择开始时间，请选择结束时间");return}const m=F.value,z=t;if(Ce.value.some(L=>L>=m&&L<z&&ge(s,L))){w.warning("选择的时间范围内包含已占用的时间段，请重新选择"),Q.value="none",F.value=null,W.value=null;return}if(z-m<.5){w.warning("至少需要选择30分钟");return}D.value={date:s,startTime:m,endTime:z,roomId:u.value},q.value=N(s),J.value={start_time:X(m),end_time:X(z),room_id:u.value,is_available:!0},Q.value="none",F.value=null,W.value=null,w.success("时间选择完成")}},ge=(s,t)=>{const m=`${u.value}-${s}`,z=se.value.get(m);return z?z.find(B=>{const L=parseFloat(B.start_hour),E=parseFloat(B.end_hour);return t>=L&&t<E}):null},Kt=(s,t)=>{const m=ge(s,t);m&&(M.value={room_id:u.value,time_slot:`${X(m.start_hour)} - ${X(m.end_hour)}`,conflicting_orders:m.orders||[]},x.value=!0)},Se=async()=>{var s,t,m,z;if(!(!u.value||!$.value))try{_.value=!0,se.value.clear();for(const B of me.value){const E=(z=(m=(await Ye($.value,{date:B.date,item_type:(s=f.value)==null?void 0:s.type,item_id:(t=f.value)==null?void 0:t.id})).data)==null?void 0:m.rooms)==null?void 0:z.find(ye=>ye.room_id===u.value);if(E&&E.current_orders){const ye=`${u.value}-${B.date}`,Te=E.current_orders.map(le=>({start_hour:ct(le.start_time),end_hour:ct(le.end_time),title:le.customer_name||le.order_type,orders:[le]}));se.value.set(ye,Te)}}}catch(B){console.error("加载房间占用信息失败:",B),w.error("加载房间占用信息失败")}finally{_.value=!1}},ct=s=>{const[t,m]=s.split(":").map(Number);return t+m/60},ea=s=>{s&&s.length===2&&s[1].diff(s[0],"day")+1>7&&(w.warning("最多只能选择7天"),te.value=[s[0],s[0].add(6,"day")]),vt(),u.value&&Se()},vt=()=>{D.value={date:null,startTime:null,endTime:null,roomId:u.value},Q.value="none",F.value=null,W.value=null},ta=()=>{A.value="booking"},aa=s=>{w.success("订单创建成功！"),la()},la=()=>{f.value=null,C.value=null,$.value=null,q.value=null,J.value=null,U.value=[],ee.value=null,I.value=!0,G.value=!0,A.value="booking"};return(s,t)=>{const m=T("a-tab-pane"),z=T("a-tabs"),B=T("a-input"),L=T("a-select-option"),E=T("a-select"),ye=T("a-checkbox"),Te=T("a-checkbox-group"),le=T("a-input-number"),Pe=T("a-col"),mt=T("a-row"),ze=T("a-button"),Ae=T("a-empty"),xe=T("a-spin"),be=T("a-tag"),sa=T("a-divider"),na=T("a-radio"),oa=T("a-radio-group"),ra=T("a-alert"),ia=T("a-range-picker"),ua=T("a-carousel"),Le=T("a-modal"),pt=T("a-time-picker");return d(),p("div",hs,[e("div",ks,[l(z,{activeKey:A.value,"onUpdate:activeKey":t[1]||(t[1]=n=>A.value=n),size:"large",onChange:Rt},{default:c(()=>[l(m,{key:"booking",tab:"项目预订"},{default:c(()=>[l(z,{activeKey:Y.value,"onUpdate:activeKey":t[0]||(t[0]=n=>Y.value=n),size:"default",onChange:ke},{default:c(()=>[l(m,{key:"all",tab:"全部"}),l(m,{key:"script",tab:"剧本杀"}),l(m,{key:"escape_room",tab:"密室"})]),_:1},8,["activeKey"])]),_:1}),l(m,{key:"payment",tab:"收款确认",disabled:!ee.value},null,8,["disabled"])]),_:1},8,["activeKey"])]),ft(e("div",Os,[e("div",ws,[e("div",$s,[t[21]||(t[21]=e("h4",null,"搜索",-1)),l(B,{value:Z.value,"onUpdate:value":t[2]||(t[2]=n=>Z.value=n),placeholder:"搜索剧本杀或密室名称...",allowClear:"",onChange:at,onPressEnter:at},{prefix:c(()=>[l(O(ga))]),_:1},8,["value"])]),e("div",Cs,[t[22]||(t[22]=e("h4",null,"门店筛选",-1)),l(E,{value:P.store_id,"onUpdate:value":t[3]||(t[3]=n=>P.store_id=n),placeholder:"选择门店",allowClear:"",onChange:oe,style:{width:"100%"}},{default:c(()=>[(d(!0),p(R,null,V(de.value,n=>(d(),K(L,{key:n.id,value:n.id},{default:c(()=>[k(v(n.name)+" ",1),n.is_active?S("",!0):(d(),p("span",Ds,"(已停业)"))]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),t[28]||(t[28]=e("h3",null,"类型筛选",-1)),Y.value==="all"||Y.value==="script"?(d(),p("div",Is,[t[23]||(t[23]=e("h4",null,"剧本类型",-1)),l(Te,{value:P.script_types,"onUpdate:value":t[4]||(t[4]=n=>P.script_types=n),onChange:oe},{default:c(()=>[(d(!0),p(R,null,V(ue.value.script_types,n=>(d(),p("div",{key:n.type,class:"filter-item"},[l(ye,{value:n.type},{default:c(()=>[k(v(n.type)+" ("+v(n.count)+") ",1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"])])):S("",!0),Y.value==="all"||Y.value==="escape_room"?(d(),p("div",Ss,[t[24]||(t[24]=e("h4",null,"恐怖等级",-1)),l(Te,{value:P.horror_levels,"onUpdate:value":t[5]||(t[5]=n=>P.horror_levels=n),onChange:oe},{default:c(()=>[(d(!0),p(R,null,V(ue.value.escape_room_horror_levels,n=>(d(),p("div",{key:n.horror_level,class:"filter-item"},[l(ye,{value:n.horror_level},{default:c(()=>[k(v(n.horror_level)+" ("+v(n.count)+") ",1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"])])):S("",!0),e("div",Ts,[t[25]||(t[25]=e("h4",null,"游戏人数",-1)),l(mt,{gutter:8},{default:c(()=>[l(Pe,{span:12},{default:c(()=>[l(le,{value:P.min_players,"onUpdate:value":t[6]||(t[6]=n=>P.min_players=n),placeholder:"最少",min:1,size:"small",onChange:oe},null,8,["value"])]),_:1}),l(Pe,{span:12},{default:c(()=>[l(le,{value:P.max_players,"onUpdate:value":t[7]||(t[7]=n=>P.max_players=n),placeholder:"最多",min:1,size:"small",onChange:oe},null,8,["value"])]),_:1})]),_:1})]),e("div",Ps,[t[26]||(t[26]=e("h4",null,"价格范围",-1)),l(mt,{gutter:8},{default:c(()=>[l(Pe,{span:12},{default:c(()=>[l(le,{value:P.min_price,"onUpdate:value":t[8]||(t[8]=n=>P.min_price=n),placeholder:"最低价",min:0,size:"small",onChange:oe},null,8,["value"])]),_:1}),l(Pe,{span:12},{default:c(()=>[l(le,{value:P.max_price,"onUpdate:value":t[9]||(t[9]=n=>P.max_price=n),placeholder:"最高价",min:0,size:"small",onChange:oe},null,8,["value"])]),_:1})]),_:1})]),e("div",zs,[l(ze,{onClick:lt,size:"small"},{default:c(()=>t[27]||(t[27]=[k("重置筛选")])),_:1,__:[27]})])]),e("div",xs,[l(xe,{spinning:r.value,tip:"加载中..."},{default:c(()=>[ne.value.length===0?(d(),p("div",Ms,[l(Ae,{description:"暂无可预订项目"})])):(d(),p("div",Us,[(d(!0),p(R,null,V(ne.value,n=>{var H,Oe;return d(),p("div",{key:`${n.type}-${n.id}`,class:we(["item-card",{selected:((H=f.value)==null?void 0:H.id)===n.id&&((Oe=f.value)==null?void 0:Oe.type)===n.type}]),onClick:xo=>jt(n)},[e("div",Hs,[n.cover_image?(d(),p("img",{key:0,src:Re(n.cover_image),alt:n.name,onError:nt},null,40,Ns)):(d(),p("div",Bs,[l(O(Ja))])),e("div",Rs,v(n.type==="script"?"剧本杀":"密室"),1),n.images&&n.images.length>1?(d(),p("div",Vs,[l(O($e)),k(" "+v(n.images.length)+"张 ",1)])):S("",!0)]),e("div",Es,[e("h3",As,v(n.name),1),e("div",Ls,[e("div",Ys,[l(O(He)),e("span",null,v(n.min_players)+"-"+v(n.max_players)+"人",1)]),e("div",Gs,[l(O(Pt)),e("span",null,v(n.duration)+"分钟",1)]),n.type==="script"?(d(),p("div",Fs,[l(O(Mt)),e("span",null,v(n.category)+" · "+v(n.secondary_category),1)])):S("",!0),n.type==="escape_room"?(d(),p("div",Ws,[l(O(La)),e("span",null,v(n.category),1)])):S("",!0),n.npc_count>0?(d(),p("div",qs,[l(O(Ut)),e("span",null,v(n.npc_count)+"个NPC",1)])):S("",!0)]),e("div",Zs,[t[29]||(t[29]=e("span",{class:"price-label"},"起",-1)),e("span",Qs,"Rp "+v(Ie(n.price)),1)]),e("div",Js,v(n.store_count)+"家门店可选 ",1)])],10,js)}),128))]))]),_:1},8,["spinning"])]),f.value?(d(),p("div",{key:0,class:"detail-overlay",onClick:st})):S("",!0),f.value?(d(),p("div",Xs,[e("div",Ks,[e("div",en,[l(ze,{type:"text",size:"small",onClick:st,class:"close-btn"},{icon:c(()=>[l(O(ya))]),_:1})]),e("div",tn,[e("h2",null,v(f.value.name),1),e("div",an,[l(be,{color:f.value.type==="script"?"blue":"green"},{default:c(()=>[k(v(f.value.type==="script"?"剧本杀":"密室"),1)]),_:1},8,["color"]),f.value.difficulty?(d(),K(be,{key:0},{default:c(()=>[k(v(f.value.difficulty),1)]),_:1})):S("",!0),f.value.category?(d(),K(be,{key:1},{default:c(()=>[k(v(f.value.category),1)]),_:1})):S("",!0)])]),f.value.images&&f.value.images.length>0?(d(),p("div",ln,[e("div",sn,[(d(!0),p(R,null,V(f.value.images.slice(0,3),(n,H)=>(d(),p("img",{key:H,src:Re(n),alt:`${f.value.name} 图片 ${H+1}`,onClick:Oe=>ot(f.value.images,H),onError:nt},null,40,nn))),128)),f.value.images.length>3?(d(),p("div",{key:0,class:"more-images",onClick:t[10]||(t[10]=n=>ot(f.value.images,3))}," +"+v(f.value.images.length-3),1)):S("",!0)])])):S("",!0),e("div",on,[t[30]||(t[30]=e("h4",null,"项目介绍",-1)),e("p",null,v(f.value.description||"暂无介绍"),1)]),e("div",rn,[e("div",un,[t[31]||(t[31]=e("span",{class:"attr-label"},"游戏人数：",-1)),e("span",null,v(f.value.min_players)+"-"+v(f.value.max_players)+"人",1)]),e("div",dn,[t[32]||(t[32]=e("span",{class:"attr-label"},"游戏时长：",-1)),e("span",null,v(f.value.duration)+"分钟",1)]),f.value.npc_count>0?(d(),p("div",cn,[t[33]||(t[33]=e("span",{class:"attr-label"},"NPC数量：",-1)),e("span",null,v(f.value.npc_count)+"个",1)])):S("",!0),f.value.props?(d(),p("div",vn,[t[34]||(t[34]=e("span",{class:"attr-label"},"游戏道具：",-1)),e("span",null,v(f.value.props),1)])):S("",!0)]),l(sa),e("div",mn,[l(xe,{spinning:o.value,tip:"加载门店信息..."},{default:c(()=>[C.value&&C.value.available_stores.length>0?(d(),p("div",pn,[G.value?(d(),p("div",{key:0,class:we(["booking-step store-selection",{collapsed:$.value&&!I.value,"has-selection":$.value}])},[e("div",{class:"step-header",onClick:t[11]||(t[11]=n=>$.value?j():null)},[t[35]||(t[35]=e("div",{class:"step-number"},"1",-1)),t[36]||(t[36]=e("h5",null,"选择门店",-1)),$.value?(d(),p("div",_n,[l(O(je)),e("span",null,v(Ve()),1)])):S("",!0),$.value?(d(),p("div",fn,[I.value?(d(),K(O(ba),{key:0})):(d(),K(O(ha),{key:1}))])):S("",!0)]),e("div",gn,[l(oa,{value:$.value,"onUpdate:value":t[12]||(t[12]=n=>$.value=n),onChange:Nt},{default:c(()=>[(d(!0),p(R,null,V(C.value.available_stores,n=>(d(),p("div",{key:n.store_id,class:"store-option"},[l(na,{value:n.store_id},{default:c(()=>[e("div",yn,[e("div",bn,[k(v(n.store_name)+" ",1),n.store_status==="已停业"?(d(),K(be,{key:0,color:"red",size:"small"},{default:c(()=>t[37]||(t[37]=[k("已停业")])),_:1,__:[37]})):S("",!0)]),e("div",hn,v(n.store_address),1),e("div",kn," Rp "+v(Ie(n.store_price||f.value.price)),1)])]),_:2},1032,["value"])]))),128))]),_:1},8,["value"])])],2)):S("",!0),!G.value&&C.value.auto_selected_store?(d(),p("div",On,[e("div",wn,[e("div",$n,[l(O(je))]),t[38]||(t[38]=e("h5",null,"已自动选择门店",-1))]),e("div",Cn,[e("div",Dn,[e("div",In,[e("div",Sn,[k(v(C.value.auto_selected_store.store_name)+" ",1),C.value.auto_selected_store.store_status==="已停业"?(d(),K(be,{key:0,color:"red",size:"small"},{default:c(()=>t[39]||(t[39]=[k("已停业")])),_:1,__:[39]})):S("",!0)]),e("div",Tn,v(C.value.auto_selected_store.store_address),1),e("div",Pn," Rp "+v(Ie(C.value.auto_selected_store.store_price||f.value.price)),1)]),e("div",zn,[l(be,{color:"green",size:"small"},{default:c(()=>[k(v(C.value.total_user_stores===1?"您只有一个可用门店":"该项目只在此门店上架"),1)]),_:1})])])])])):S("",!0),$.value?(d(),p("div",xn,[e("div",Mn,[e("div",Un,v(G.value?2:1),1),t[40]||(t[40]=e("h5",null,"选择日期和时间",-1)),D.value.startTime&&D.value.endTime?(d(),p("div",jn,[l(O(je)),e("span",null,v(dt()),1)])):S("",!0)]),e("div",Hn,[Yt()?(d(),p("div",Nn,[l(ra,{message:"门店已停业",description:"该门店已停业，无法进行预订。请选择其他门店。",type:"warning","show-icon":"",size:"small"})])):(d(),p("div",Bn,[e("div",Rn,[e("div",Vn,[l(ia,{value:te.value,"onUpdate:value":t[13]||(t[13]=n=>te.value=n),size:"small","disabled-date":Et,onChange:ea,placeholder:"['开始日期', '结束日期']"},null,8,["value"])]),e("div",En,[l(ze,{type:"text",size:"small",onClick:Gt},{default:c(()=>t[41]||(t[41]=[k(" 今天 ")])),_:1,__:[41]})])]),U.value.length>0?(d(),p("div",An,[t[42]||(t[42]=e("label",null,"选择房间：",-1)),l(E,{value:u.value,"onUpdate:value":t[14]||(t[14]=n=>u.value=n),placeholder:"请选择房间",style:{width:"200px"},onChange:qt},{default:c(()=>[(d(!0),p(R,null,V(U.value,n=>(d(),K(L,{key:n.room_id,value:n.room_id},{default:c(()=>[k(v(n.room_name)+" ("+v(n.capacity)+"人) ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):S("",!0),u.value?(d(),p("div",Ln,[l(xe,{spinning:_.value,tip:"加载时间表..."},{default:c(()=>[e("div",Yn,[e("div",{class:"time-grid-header",style:Fe({gridTemplateColumns:`80px repeat(${me.value.length}, 1fr)`})},[t[43]||(t[43]=e("div",{class:"time-label-column"},null,-1)),(d(!0),p(R,null,V(me.value,n=>(d(),p("div",{key:n.date,class:we(["day-column",{today:Ft(n.date),past:Wt(n.date)}])},[e("div",Gn,v(n.dayName),1),e("div",Fn,v(n.dayNumber),1)],2))),128))],4),e("div",Wn,[(d(!0),p(R,null,V(Ce.value,n=>(d(),p("div",{key:n,class:"time-row",style:Fe({gridTemplateColumns:`80px repeat(${me.value.length}, 1fr)`})},[e("div",qn,v(X(n)),1),(d(!0),p(R,null,V(me.value,H=>(d(),p("div",{key:`${H.date}-${n}`,class:we(["time-cell",Zt(H.date,n)]),"data-date":H.date,"data-hour":n,onClick:Oe=>Xt(H.date,n)},[ge(H.date,n)?(d(),p("div",{key:0,class:"occupancy-info",onClick:Oe=>Kt(H.date,n)},v(ge(H.date,n).title),9,Qn)):S("",!0)],10,Zn))),128))],4))),128))])])]),_:1},8,["spinning"]),t[44]||(t[44]=e("div",{class:"selection-hint"},[e("div",{class:"hint-item"},[e("div",{class:"color-indicator available"}),e("span",null,"可预订")]),e("div",{class:"hint-item"},[e("div",{class:"color-indicator occupied"}),e("span",null,"已占用")]),e("div",{class:"hint-item"},[e("div",{class:"color-indicator past"}),e("span",null,"已过时")]),e("div",{class:"hint-item"},[e("div",{class:"color-indicator start-selected"}),e("span",null,"开始时间")]),e("div",{class:"hint-item"},[e("div",{class:"color-indicator selected"}),e("span",null,"已选择")])],-1))])):(d(),p("div",Jn,[l(xe,{spinning:_.value,tip:"加载房间信息..."},{default:c(()=>[U.value.length===0&&!_.value?(d(),p("div",Xn,[l(Ae,{description:"该门店暂无可用房间，请选择其他门店。",image:!1,size:"small"})])):S("",!0)]),_:1},8,["spinning"])]))]))])])):S("",!0),D.value.startTime&&D.value.endTime?(d(),p("div",Kn,[e("div",eo,[e("div",to,v(G.value?3:2),1),t[45]||(t[45]=e("h5",null,"确认预订",-1))]),e("div",ao,[e("div",lo,[e("div",so,[t[46]||(t[46]=e("span",null,"项目：",-1)),e("span",null,v(f.value.name),1)]),e("div",no,[t[47]||(t[47]=e("span",null,"门店：",-1)),e("span",null,v(Ve()),1)]),e("div",oo,[t[48]||(t[48]=e("span",null,"房间：",-1)),e("span",null,v(rt()),1)]),e("div",ro,[t[49]||(t[49]=e("span",null,"时间：",-1)),e("span",null,v(dt()),1)]),e("div",io,[t[50]||(t[50]=e("span",null,"总价：",-1)),e("span",null,"Rp "+v(Ie(it())),1)])]),l(ze,{type:"primary",size:"default",block:"",loading:g.value,onClick:Bt},{default:c(()=>t[51]||(t[51]=[k(" 立即预订 ")])),_:1,__:[51]},8,["loading"])])])):S("",!0)])):C.value?(d(),p("div",uo,[l(Ae,{description:"该项目暂无可选门店"})])):S("",!0)]),_:1},8,["spinning"])])])])):S("",!0)],512),[[gt,A.value==="booking"]]),ft(e("div",co,[ee.value?(d(),K(bs,{key:0,"booking-data":ee.value,onCancel:ta,onSuccess:aa},null,8,["booking-data"])):S("",!0)],512),[[gt,A.value==="payment"]]),l(Le,{open:he.value,"onUpdate:open":t[16]||(t[16]=n=>he.value=n),title:"图片预览",width:"800px",footer:null,centered:""},{default:c(()=>[pe.value.length>0?(d(),p("div",vo,[l(ua,{current:_e.value,"onUpdate:current":t[15]||(t[15]=n=>_e.value=n),arrows:""},{prevArrow:c(()=>[e("div",mo,[l(O(zt))])]),nextArrow:c(()=>[e("div",po,[l(O(ka))])]),default:c(()=>[(d(!0),p(R,null,V(pe.value,(n,H)=>(d(),p("div",{key:H,class:"preview-slide"},[e("img",{src:Re(n),alt:`预览图片 ${H+1}`},null,8,_o)]))),128))]),_:1},8,["current"]),e("div",fo,v(_e.value+1)+" / "+v(pe.value.length),1)])):S("",!0)]),_:1},8,["open"]),l(Le,{open:ve.value,"onUpdate:open":t[19]||(t[19]=n=>ve.value=n),title:"自定义时间段","confirm-loading":g.value,onOk:At,onCancel:Lt},{default:c(()=>[e("div",go,[e("div",yo,[t[52]||(t[52]=e("label",null,"房间：",-1)),e("span",null,v(ut(a.value)),1)]),e("div",bo,[t[53]||(t[53]=e("label",null,"日期：",-1)),e("span",null,v(Vt(q.value)),1)]),e("div",ho,[t[54]||(t[54]=e("label",null,"开始时间：",-1)),l(pt,{value:ce.value,"onUpdate:value":t[17]||(t[17]=n=>ce.value=n),format:"HH:mm",placeholder:"选择开始时间","minute-step":15},null,8,["value"])]),e("div",ko,[t[55]||(t[55]=e("label",null,"结束时间：",-1)),l(pt,{value:y.value,"onUpdate:value":t[18]||(t[18]=n=>y.value=n),format:"HH:mm",placeholder:"选择结束时间","minute-step":15},null,8,["value"])])])]),_:1},8,["open","confirm-loading"]),l(Le,{open:x.value,"onUpdate:open":t[20]||(t[20]=n=>x.value=n),title:"时间段占用详情",footer:null,width:"600px"},{default:c(()=>[M.value?(d(),p("div",Oo,[e("div",wo,[e("h4",null,v(ut(M.value.room_id)),1),e("p",null,"时间段："+v(M.value.time_slot),1)]),e("div",$o,[t[60]||(t[60]=e("h5",null,"冲突订单：",-1)),(d(!0),p(R,null,V(M.value.conflicting_orders,n=>(d(),p("div",{key:n.order_id,class:"order-card"},[e("div",Co,[e("div",Do,[e("span",Io,v(n.order_type),1),e("span",{class:we(["order-status",n.status])},v(n.status),3)]),e("div",So,[e("p",null,[t[56]||(t[56]=e("strong",null,"客户：",-1)),k(v(n.customer_name),1)]),e("p",null,[t[57]||(t[57]=e("strong",null,"时间：",-1)),k(v(n.start_time)+" - "+v(n.end_time),1)]),n.script_name?(d(),p("p",To,[t[58]||(t[58]=e("strong",null,"剧本：",-1)),k(v(n.script_name),1)])):S("",!0),n.escape_room_name?(d(),p("p",Po,[t[59]||(t[59]=e("strong",null,"密室：",-1)),k(v(n.escape_room_name),1)])):S("",!0)])])]))),128))])])):S("",!0)]),_:1},8,["open"])])}}},Vo=xt(zo,[["__scopeId","data-v-64654a01"]]);export{Vo as default};
