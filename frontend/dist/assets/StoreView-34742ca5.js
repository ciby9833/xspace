import{g as t,A as xe,x as re,r as x,k as de,b as fe,l as ye,q as $e,c as u,o as a,n as f,w as e,d as S,s as oe,v as ie,h as i,t as k,i as V,m as j,e as C,f as M,P as Se,z as Je,E as we,G as qe,U as Qe,D as Ge,H as We,a as je,R as Be,S as He}from"./index-979b8016.js";import{s as me}from"./store-4f4116e5.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import{U as Ke}from"./UploadOutlined-d2112608.js";var Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"};const Ze=Xe;function Pe(s){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?Object(arguments[n]):{},U=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(U=U.concat(Object.getOwnPropertySymbols(l).filter(function(D){return Object.getOwnPropertyDescriptor(l,D).enumerable}))),U.forEach(function(D){et(s,D,l[D])})}return s}function et(s,n,l){return n in s?Object.defineProperty(s,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[n]=l,s}var Oe=function(n,l){var U=Pe({},n,l.attrs);return t(xe,Pe({},U,{icon:Ze}),null)};Oe.displayName="ClearOutlined";Oe.inheritAttrs=!1;const tt=Oe;var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};const ot=at;function Ae(s){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?Object(arguments[n]):{},U=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(U=U.concat(Object.getOwnPropertySymbols(l).filter(function(D){return Object.getOwnPropertyDescriptor(l,D).enumerable}))),U.forEach(function(D){lt(s,D,l[D])})}return s}function lt(s,n,l){return n in s?Object.defineProperty(s,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[n]=l,s}var Ue=function(n,l){var U=Ae({},n,l.attrs);return t(xe,Ae({},U,{icon:ot}),null)};Ue.displayName="DatabaseOutlined";Ue.inheritAttrs=!1;const st=Ue;var nt={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const rt=nt;function Ve(s){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?Object(arguments[n]):{},U=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(U=U.concat(Object.getOwnPropertySymbols(l).filter(function(D){return Object.getOwnPropertyDescriptor(l,D).enumerable}))),U.forEach(function(D){it(s,D,l[D])})}return s}function it(s,n,l){return n in s?Object.defineProperty(s,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[n]=l,s}var Re=function(n,l){var U=Ve({},n,l.attrs);return t(xe,Ve({},U,{icon:rt}),null)};Re.displayName="InboxOutlined";Re.inheritAttrs=!1;const ut=Re,ne={getRoomList(s={}){return re({url:"/api/room",method:"get",params:s})},getRoomDetail(s){return re({url:`/api/room/${s}`,method:"get"})},createRoom(s){return re({url:"/api/room",method:"post",data:s})},batchCreateRooms(s){return re({url:"/api/room/batch",method:"post",data:{operation:"batchCreate",...s}})},updateRoom(s,n){return re({url:`/api/room/${s}`,method:"put",data:n})},deleteRoom(s){return re({url:`/api/room/${s}`,method:"delete"})},getAvailableStores(){return re({url:"/api/room/available-stores",method:"get"})},uploadRoomImages(s,n){return re({url:`/api/room/${s}/images`,method:"post",data:n,headers:{"Content-Type":"multipart/form-data"}})},deleteRoomImage(s,n){return re({url:`/api/room/${s}/images/${n}`,method:"delete"})},updateImageOrder(s,n){return re({url:`/api/room/${s}/images/order`,method:"put",data:{imageOrders:n}})},batchOperation(s){return re({url:"/api/room/batch",method:"post",data:s})},getRoomStats(s={}){return re({url:"/api/room/stats",method:"get",params:s})}};const dt={__name:"RoomFormModal",props:{visible:{type:Boolean,default:!1},mode:{type:String,default:"create"},roomData:{type:Object,default:null},storeId:{type:String,default:null}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,U=n,D=x(!1),g=x([]),P=x(),B=de({get:()=>l.visible,set:y=>U("update:visible",y)}),w=fe({store_id:l.storeId||null,name:"",room_type:"",capacity:1,status:"正常",description:"",equipment:"",notes:""}),L=de(()=>({store_id:l.storeId?[]:[{required:!0,message:"请选择所属门店",trigger:"change"}],name:[{required:!0,message:"请输入房间名称",trigger:"blur"},{min:1,max:255,message:"房间名称长度在1-255字符之间",trigger:"blur"}],room_type:[{required:!0,message:"请选择房间类型",trigger:"change"}],capacity:[{required:!0,message:"请输入房间容量",trigger:"blur"},{type:"number",min:1,max:50,message:"房间容量应在1-50之间",trigger:"blur"}],status:[{required:!0,message:"请选择房间状态",trigger:"change"}]})),R=async()=>{if(!l.storeId)try{const y=await ne.getAvailableStores();g.value=y.data||[]}catch(y){console.error("获取可选门店列表失败:",y)}},Y=()=>{Object.assign(w,{store_id:l.storeId||null,name:"",room_type:"",capacity:1,status:"正常",description:"",equipment:"",notes:""}),P.value&&P.value.resetFields()},J=()=>{l.roomData&&l.mode==="edit"&&Object.assign(w,{store_id:l.roomData.store_id,name:l.roomData.name,room_type:l.roomData.room_type,capacity:l.roomData.capacity,status:l.roomData.status,description:l.roomData.description||"",equipment:l.roomData.equipment||"",notes:l.roomData.notes||""})},Q=async()=>{try{await P.value.validate(),D.value=!0;const y={...w};l.storeId&&(y.store_id=l.storeId),l.mode==="create"?(await ne.createRoom(y),j.success("房间创建成功")):(await ne.updateRoom(l.roomData.id,y),j.success("房间更新成功")),U("success")}catch(y){if(y.errorFields)return;j.error("操作失败："+(y.message||"未知错误"))}finally{D.value=!1}},b=()=>{B.value=!1,Y()};return ye(()=>l.visible,y=>{y&&(R(),l.mode==="create"?Y():J())}),$e(()=>{R()}),(y,_)=>{const N=u("a-select-option"),le=u("a-select"),T=u("a-form-item"),G=u("a-input"),m=u("a-col"),I=u("a-row"),c=u("a-input-number"),d=u("a-textarea"),q=u("a-form"),O=u("a-modal");return a(),f(O,{open:B.value,"onUpdate:open":_[8]||(_[8]=$=>B.value=$),title:s.mode==="create"?"新建房间":"编辑房间","confirm-loading":D.value,onOk:Q,onCancel:b,width:"600px"},{default:e(()=>[t(q,{ref_key:"formRef",ref:P,model:w,rules:L.value,layout:"vertical"},{default:e(()=>[s.storeId?V("",!0):(a(),f(T,{key:0,label:"所属门店",name:"store_id"},{default:e(()=>[t(le,{value:w.store_id,"onUpdate:value":_[0]||(_[0]=$=>w.store_id=$),placeholder:"选择门店",disabled:s.mode==="edit"},{default:e(()=>[(a(!0),S(oe,null,ie(g.value,$=>(a(),f(N,{key:$.id,value:$.id},{default:e(()=>[i(k($.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})),t(I,{gutter:16},{default:e(()=>[t(m,{span:12},{default:e(()=>[t(T,{label:"房间名称",name:"name"},{default:e(()=>[t(G,{value:w.name,"onUpdate:value":_[1]||(_[1]=$=>w.name=$),placeholder:"请输入房间名称"},null,8,["value"])]),_:1})]),_:1}),t(m,{span:12},{default:e(()=>[t(T,{label:"房间类型",name:"room_type"},{default:e(()=>[t(le,{value:w.room_type,"onUpdate:value":_[2]||(_[2]=$=>w.room_type=$),placeholder:"选择房间类型"},{default:e(()=>[t(N,{value:"剧本杀"},{default:e(()=>_[9]||(_[9]=[i("剧本杀")])),_:1,__:[9]}),t(N,{value:"密室"},{default:e(()=>_[10]||(_[10]=[i("密室")])),_:1,__:[10]}),t(N,{value:"混合"},{default:e(()=>_[11]||(_[11]=[i("混合")])),_:1,__:[11]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(I,{gutter:16},{default:e(()=>[t(m,{span:12},{default:e(()=>[t(T,{label:"房间容量",name:"capacity"},{default:e(()=>[t(c,{value:w.capacity,"onUpdate:value":_[3]||(_[3]=$=>w.capacity=$),min:1,max:50,placeholder:"1-50人",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),s.mode==="edit"?(a(),f(m,{key:0,span:12},{default:e(()=>[t(T,{label:"房间状态",name:"status"},{default:e(()=>[t(le,{value:w.status,"onUpdate:value":_[4]||(_[4]=$=>w.status=$),placeholder:"选择房间状态"},{default:e(()=>[t(N,{value:"正常"},{default:e(()=>_[12]||(_[12]=[i("正常")])),_:1,__:[12]}),t(N,{value:"维护"},{default:e(()=>_[13]||(_[13]=[i("维护")])),_:1,__:[13]}),t(N,{value:"关闭"},{default:e(()=>_[14]||(_[14]=[i("关闭")])),_:1,__:[14]})]),_:1},8,["value"])]),_:1})]),_:1})):V("",!0)]),_:1}),t(T,{label:"房间描述",name:"description"},{default:e(()=>[t(d,{value:w.description,"onUpdate:value":_[5]||(_[5]=$=>w.description=$),placeholder:"请输入房间描述",rows:3,maxlength:1e3,"show-count":""},null,8,["value"])]),_:1}),t(T,{label:"设备信息",name:"equipment"},{default:e(()=>[t(d,{value:w.equipment,"onUpdate:value":_[6]||(_[6]=$=>w.equipment=$),placeholder:"请输入设备信息",rows:2,maxlength:500,"show-count":""},null,8,["value"])]),_:1}),t(T,{label:"备注",name:"notes"},{default:e(()=>[t(d,{value:w.notes,"onUpdate:value":_[7]||(_[7]=$=>w.notes=$),placeholder:"请输入备注信息",rows:2,maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirm-loading"])}}},ct=ge(dt,[["__scopeId","data-v-3d18db20"]]);const mt={class:"batch-create-content"},pt={class:"toolbar"},_t={key:0,class:"store-selector"},vt={class:"batch-table"},ft={key:1,class:"validation-errors"},yt={__name:"BatchCreateModal",props:{visible:{type:Boolean,default:!1},storeId:{type:String,default:null}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,U=n,D=x(!1),g=x([]),P=x([]),B=x(null),w=x([]),L=de({get:()=>l.visible,set:c=>U("update:visible",c)}),R=de(()=>{const c=[{title:"序号",key:"index",width:60,fixed:"left"},{title:"房间名称",key:"name",width:150,fixed:"left"},{title:"房间类型",key:"room_type",width:100},{title:"容量",key:"capacity",width:80},{title:"描述",key:"description",width:200},{title:"设备",key:"equipment",width:150},{title:"操作",key:"action",width:80,fixed:"right"}];return l.storeId||c.splice(1,0,{title:"所属门店",key:"store_id",width:130,fixed:"left"}),c}),Y=async()=>{if(!l.storeId)try{const c=await ne.getAvailableStores();g.value=c.data||[]}catch(c){console.error("获取可选门店列表失败:",c)}},J=()=>({store_id:l.storeId||B.value||null,name:"",room_type:"",capacity:1,description:"",equipment:"",errors:{}}),Q=()=>{P.value.push(J())},b=c=>{P.value.splice(c,1)},y=()=>{P.value=[],w.value=[]},_=()=>{if(P.value.length===0)for(let c=0;c<3;c++)Q()},N=()=>{w.value=[];let c=!1;return P.value.forEach((d,q)=>{d.errors={},d.store_id||(d.errors.store_id=!0,w.value.push(`第${q+1}行：请选择门店`),c=!0),(!d.name||d.name.trim()==="")&&(d.errors.name=!0,w.value.push(`第${q+1}行：请输入房间名称`),c=!0),d.room_type||(d.errors.room_type=!0,w.value.push(`第${q+1}行：请选择房间类型`),c=!0),(!d.capacity||d.capacity<1||d.capacity>50)&&(d.errors.capacity=!0,w.value.push(`第${q+1}行：房间容量应在1-50之间`),c=!0)}),!c},le=async()=>{if(P.value.length===0){j.warning("请至少添加一个房间");return}if(N())try{D.value=!0;const c=P.value.map(d=>{var q,O;return{store_id:d.store_id,name:d.name.trim(),room_type:d.room_type,capacity:d.capacity,description:((q=d.description)==null?void 0:q.trim())||"",equipment:((O=d.equipment)==null?void 0:O.trim())||""}});await ne.batchCreateRooms({rooms:c}),j.success(`成功创建 ${c.length} 个房间`),U("success")}catch(c){j.error("批量创建失败："+(c.message||"未知错误"))}finally{D.value=!1}},T=()=>{L.value=!1,y()},G=()=>{const d=[["门店名称","房间名称","房间类型","容量","描述","设备"],["示例门店","房间A","剧本杀",6,"适合6人游戏的房间","投影仪、音响"],["示例门店","房间B","密室",4,"适合4人游戏的房间","道具、机关"]].map(te=>te.join(",")).join(`
`),q=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),O=document.createElement("a"),$=URL.createObjectURL(q);O.setAttribute("href",$),O.setAttribute("download","房间批量导入模板.csv"),O.style.visibility="hidden",document.body.appendChild(O),O.click(),document.body.removeChild(O)},m=c=>{const d=new FileReader;return d.onload=q=>{try{const $=q.target.result.split(`
`),te=$[0].split(","),W=[];for(let Z=1;Z<$.length;Z++)if($[Z].trim()){const K=$[Z].split(","),se={store_id:I(K[0])||l.storeId||B.value||null,name:K[1]||"",room_type:K[2]||"",capacity:parseInt(K[3])||1,description:K[4]||"",equipment:K[5]||"",errors:{}};W.push(se)}P.value=W,j.success(`成功导入 ${W.length} 条记录`)}catch(O){j.error("文件解析失败："+O.message)}},d.readAsText(c,"UTF-8"),!1},I=c=>{if(!c)return null;const d=g.value.find(q=>q.name===c);return d?d.id:null};return ye(B,c=>{P.value.forEach(d=>{d.store_id||(d.store_id=c)})}),ye(()=>l.visible,c=>{c&&(Y(),_())}),$e(()=>{Y()}),(c,d)=>{const q=u("a-alert"),O=u("a-button"),$=u("a-upload"),te=u("a-space"),W=u("a-select-option"),Z=u("a-select"),K=u("a-form-item"),se=u("a-input"),pe=u("a-input-number"),H=u("a-table"),v=u("a-modal");return a(),f(v,{open:L.value,"onUpdate:open":d[1]||(d[1]=o=>L.value=o),title:"批量录入房间","confirm-loading":D.value,onOk:le,onCancel:T,width:"900px","mask-closable":!1},{default:e(()=>[C("div",mt,[t(q,{message:"批量录入说明",description:"您可以通过表格快速录入多个房间信息，也可以导入Excel文件进行批量创建。",type:"info","show-icon":"",style:{"margin-bottom":"16px"}}),C("div",pt,[t(te,null,{default:e(()=>[t(O,{onClick:Q,type:"primary",ghost:""},{default:e(()=>[t(M(Se)),d[2]||(d[2]=i(" 添加行 "))]),_:1,__:[2]}),t(O,{onClick:y},{default:e(()=>[t(M(tt)),d[3]||(d[3]=i(" 清空所有 "))]),_:1,__:[3]}),t($,{"before-upload":m,accept:".xlsx,.xls","show-upload-list":!1},{default:e(()=>[t(O,null,{default:e(()=>[t(M(Ke)),d[4]||(d[4]=i(" 导入Excel "))]),_:1,__:[4]})]),_:1}),t(O,{onClick:G},{default:e(()=>[t(M(Je)),d[5]||(d[5]=i(" 下载模板 "))]),_:1,__:[5]})]),_:1})]),s.storeId?V("",!0):(a(),S("div",_t,[t(K,{label:"默认门店",style:{"margin-bottom":"16px"}},{default:e(()=>[t(Z,{value:B.value,"onUpdate:value":d[0]||(d[0]=o=>B.value=o),placeholder:"选择默认门店（可为每行单独设置）","allow-clear":"",style:{width:"300px"}},{default:e(()=>[(a(!0),S(oe,null,ie(g.value,o=>(a(),f(W,{key:o.id,value:o.id},{default:e(()=>[i(k(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})])),C("div",vt,[t(H,{columns:R.value,"data-source":P.value,pagination:!1,size:"small",bordered:"",scroll:{x:1200,y:400}},{bodyCell:e(({column:o,record:A,index:ae})=>{var p,r,X,ce;return[o.key==="index"?(a(),S(oe,{key:0},[i(k(ae+1),1)],64)):o.key==="store_id"?(a(),f(Z,{key:1,value:A.store_id,"onUpdate:value":E=>A.store_id=E,placeholder:"选择门店",size:"small",style:{width:"120px"},class:we({"error-field":(p=A.errors)==null?void 0:p.store_id})},{default:e(()=>[(a(!0),S(oe,null,ie(g.value,E=>(a(),f(W,{key:E.id,value:E.id},{default:e(()=>[i(k(E.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","class"])):o.key==="name"?(a(),f(se,{key:2,value:A.name,"onUpdate:value":E=>A.name=E,placeholder:"房间名称",size:"small",class:we({"error-field":(r=A.errors)==null?void 0:r.name})},null,8,["value","onUpdate:value","class"])):o.key==="room_type"?(a(),f(Z,{key:3,value:A.room_type,"onUpdate:value":E=>A.room_type=E,placeholder:"类型",size:"small",style:{width:"80px"},class:we({"error-field":(X=A.errors)==null?void 0:X.room_type})},{default:e(()=>[t(W,{value:"剧本杀"},{default:e(()=>d[6]||(d[6]=[i("剧本杀")])),_:1,__:[6]}),t(W,{value:"密室"},{default:e(()=>d[7]||(d[7]=[i("密室")])),_:1,__:[7]}),t(W,{value:"混合"},{default:e(()=>d[8]||(d[8]=[i("混合")])),_:1,__:[8]})]),_:2},1032,["value","onUpdate:value","class"])):o.key==="capacity"?(a(),f(pe,{key:4,value:A.capacity,"onUpdate:value":E=>A.capacity=E,min:1,max:50,size:"small",style:{width:"70px"},class:we({"error-field":(ce=A.errors)==null?void 0:ce.capacity})},null,8,["value","onUpdate:value","class"])):o.key==="description"?(a(),f(se,{key:5,value:A.description,"onUpdate:value":E=>A.description=E,placeholder:"房间描述",size:"small"},null,8,["value","onUpdate:value"])):o.key==="equipment"?(a(),f(se,{key:6,value:A.equipment,"onUpdate:value":E=>A.equipment=E,placeholder:"设备信息",size:"small"},null,8,["value","onUpdate:value"])):o.key==="action"?(a(),f(O,{key:7,type:"link",size:"small",danger:"",onClick:E=>b(ae)},{default:e(()=>d[9]||(d[9]=[i(" 删除 ")])),_:2,__:[9]},1032,["onClick"])):V("",!0)]}),_:1},8,["columns","data-source"])]),w.value.length>0?(a(),S("div",ft,[t(q,{message:"数据验证失败",type:"error","show-icon":"",style:{"margin-top":"16px"}},{description:e(()=>[C("ul",null,[(a(!0),S(oe,null,ie(w.value,o=>(a(),S("li",{key:o},k(o),1))),128))])]),_:1})])):V("",!0)])]),_:1},8,["open","confirm-loading"])}}},gt=ge(yt,[["__scopeId","data-v-fe9c0510"]]);const bt={key:0,class:"room-detail"},kt={key:0,class:"room-images"},ht={class:"image-gallery"},wt=["onClick"],Ct=["src","alt"],It={class:"image-overlay"},$t={class:"image-order"},Dt={key:1,class:"no-images"},xt={__name:"RoomDetailModal",props:{visible:{type:Boolean,default:!1},roomData:{type:Object,default:null}},emits:["update:visible"],setup(s,{emit:n}){const l=s,U=n,D=x([]),g=x(!1),P=x(0),B=de({get:()=>l.visible,set:b=>U("update:visible",b)}),w=async()=>{var b;if((b=l.roomData)!=null&&b.id)try{const y=await ne.getRoomDetail(l.roomData.id);D.value=y.data.images||[]}catch(y){console.error("获取房间图片失败:",y),D.value=[]}},L=b=>{P.value=b,g.value=!0},R=b=>{P.value=b},Y=b=>({剧本杀:"blue",密室:"green",混合:"orange"})[b]||"default",J=b=>({正常:"green",维护:"orange",关闭:"red"})[b]||"default",Q=b=>b?qe(b).format("YYYY-MM-DD HH:mm:ss"):"-";return ye(()=>l.visible,b=>{b&&l.roomData&&w()}),(b,y)=>{const _=u("a-descriptions-item"),N=u("a-tag"),le=u("a-descriptions"),T=u("a-empty"),G=u("a-image"),m=u("a-image-preview-group"),I=u("a-modal");return a(),f(I,{open:B.value,"onUpdate:open":y[1]||(y[1]=c=>B.value=c),title:"房间详情",footer:null,width:"800px"},{default:e(()=>[s.roomData?(a(),S("div",bt,[t(le,{title:"基本信息",column:2,bordered:""},{default:e(()=>[t(_,{label:"房间名称"},{default:e(()=>[i(k(s.roomData.name),1)]),_:1}),t(_,{label:"房间类型"},{default:e(()=>[t(N,{color:Y(s.roomData.room_type)},{default:e(()=>[i(k(s.roomData.room_type),1)]),_:1},8,["color"])]),_:1}),t(_,{label:"房间容量"},{default:e(()=>[i(k(s.roomData.capacity)+"人 ",1)]),_:1}),t(_,{label:"房间状态"},{default:e(()=>[t(N,{color:J(s.roomData.status)},{default:e(()=>[i(k(s.roomData.status),1)]),_:1},8,["color"])]),_:1}),t(_,{label:"所属门店",span:2},{default:e(()=>[i(k(s.roomData.store_name)+" ",1),s.roomData.company_name?(a(),f(N,{key:0,size:"small",color:"blue",style:{"margin-left":"8px"}},{default:e(()=>[i(k(s.roomData.company_name),1)]),_:1})):V("",!0)]),_:1}),t(_,{label:"房间描述",span:2},{default:e(()=>[i(k(s.roomData.description||"暂无描述"),1)]),_:1}),t(_,{label:"设备信息",span:2},{default:e(()=>[i(k(s.roomData.equipment||"暂无设备信息"),1)]),_:1}),t(_,{label:"备注",span:2},{default:e(()=>[i(k(s.roomData.notes||"暂无备注"),1)]),_:1}),t(_,{label:"创建时间",span:2},{default:e(()=>[i(k(Q(s.roomData.created_at)),1)]),_:1})]),_:1}),D.value.length>0?(a(),S("div",kt,[y[3]||(y[3]=C("h4",null,"房间图片",-1)),C("div",ht,[(a(!0),S(oe,null,ie(D.value,(c,d)=>(a(),S("div",{key:c.id,class:"image-item",onClick:q=>L(d)},[C("img",{src:c.full_url,alt:c.image_name},null,8,Ct),C("div",It,[c.is_primary?(a(),f(N,{key:0,color:"gold",size:"small"},{default:e(()=>y[2]||(y[2]=[i("主图")])),_:1,__:[2]})):V("",!0),C("span",$t,k(c.sort_order+1),1)])],8,wt))),128))])])):(a(),S("div",Dt,[t(T,{description:"暂无房间图片"})])),t(m,{visible:g.value,"onUpdate:visible":y[0]||(y[0]=c=>g.value=c),current:P.value,onChange:R},{default:e(()=>[(a(!0),S(oe,null,ie(D.value,c=>(a(),f(G,{key:c.id,src:c.full_url,style:{display:"none"}},null,8,["src"]))),128))]),_:1},8,["visible","current"])])):V("",!0)]),_:1},8,["open"])}}},St=ge(xt,[["__scopeId","data-v-318e4e75"]]);const Ot={class:"room-image-management"},Ut={class:"upload-section"},Rt={class:"ant-upload-drag-icon"},zt={key:0,class:"image-list"},Mt={class:"image-grid"},Pt={class:"image-preview"},At=["src","alt","onClick"],Vt={class:"image-overlay"},qt={class:"image-order"},jt={class:"image-actions"},Bt={key:0,class:"upload-progress"},Ht={key:1,class:"empty-state"},Lt={__name:"RoomImageModal",props:{visible:{type:Boolean,default:!1},roomData:{type:Object,default:null}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,U=n,D=x(!1),g=x([]),P=x([]),B=x(!1),w=x(0),L=x(!1),R=de({get:()=>l.visible,set:m=>U("update:visible",m)}),Y=async()=>{var m;if((m=l.roomData)!=null&&m.id)try{const I=await ne.getRoomDetail(l.roomData.id);g.value=(I.data.images||[]).sort((c,d)=>c.sort_order-d.sort_order)}catch(I){console.error("获取房间图片失败:",I),g.value=[]}},J=m=>m.type.startsWith("image/")?m.size/1024/1024<10?g.value.length>=15?(j.error("最多只能上传15张图片!"),!1):!0:(j.error("图片大小不能超过10MB!"),!1):(j.error("只能上传图片文件!"),!1),Q=async({file:m,onProgress:I,onSuccess:c,onError:d})=>{try{const q=new FormData;q.append("images",m);const O={uid:m.uid,name:m.name,status:"uploading",percent:0,url:URL.createObjectURL(m)};g.value.push(O);const $=setInterval(()=>{O.percent<90&&(O.percent+=10,I({percent:O.percent}))},100),te=await ne.uploadRoomImages(l.roomData.id,q);clearInterval($);const W=te.data||[];if(W.length>0){const Z=W[0],K=g.value.findIndex(se=>se.uid===m.uid);K!==-1&&(g.value[K]={...Z,status:"done",percent:100}),L.value=!0,c(te,m),j.success("图片上传成功")}}catch(q){const O=g.value.findIndex($=>$.uid===m.uid);O!==-1&&(g.value[O].status="error"),d(q,m),j.error("图片上传失败："+(q.message||"未知错误"))}},b=async m=>{const I=g.value[m];try{I.id&&(await ne.deleteRoomImage(l.roomData.id,I.id),j.success("图片删除成功")),g.value.splice(m,1),L.value=!0}catch(c){j.error("删除图片失败："+(c.message||"未知错误"))}},y=m=>{if(m>0){const I=g.value[m];g.value[m]=g.value[m-1],g.value[m-1]=I,L.value=!0}},_=m=>{if(m<g.value.length-1){const I=g.value[m];g.value[m]=g.value[m+1],g.value[m+1]=I,L.value=!0}},N=m=>{w.value=m,B.value=!0},le=m=>{w.value=m},T=async()=>{if(!L.value){R.value=!1;return}try{D.value=!0;const m=g.value.filter(I=>I.id).map((I,c)=>({id:I.id,sort_order:c,is_primary:c===0}));m.length>0&&(await ne.updateImageOrder(l.roomData.id,m),j.success("图片排序更新成功")),U("success"),R.value=!1}catch(m){j.error("保存失败："+(m.message||"未知错误"))}finally{D.value=!1}},G=()=>{L.value,R.value=!1,L.value=!1};return ye(()=>l.visible,m=>{m&&l.roomData&&(Y(),L.value=!1)}),(m,I)=>{const c=u("a-alert"),d=u("a-upload-dragger"),q=u("a-tag"),O=u("a-button"),$=u("a-popconfirm"),te=u("a-space"),W=u("a-progress"),Z=u("a-empty"),K=u("a-image"),se=u("a-image-preview-group"),pe=u("a-modal");return a(),f(pe,{open:R.value,"onUpdate:open":I[2]||(I[2]=H=>R.value=H),title:"房间图片管理","confirm-loading":D.value,onOk:T,onCancel:G,width:"900px","mask-closable":!1},{default:e(()=>[C("div",Ot,[t(c,{message:"图片管理说明",description:"最多可上传15张图片，支持拖拽排序。第一张图片将作为主图显示。",type:"info","show-icon":"",style:{"margin-bottom":"16px"}}),C("div",Ut,[t(d,{"file-list":P.value,"onUpdate:fileList":I[0]||(I[0]=H=>P.value=H),name:"images",multiple:"","before-upload":J,"custom-request":Q,"show-upload-list":!1,accept:"image/*",disabled:g.value.length>=15},{default:e(()=>[C("p",Rt,[t(M(ut))]),I[3]||(I[3]=C("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域上传",-1)),I[4]||(I[4]=C("p",{class:"ant-upload-hint"}," 支持单个或批量上传，最多15张图片，每张不超过10MB ",-1))]),_:1,__:[3,4]},8,["file-list","disabled"])]),g.value.length>0?(a(),S("div",zt,[C("h4",null,"已上传图片 ("+k(g.value.length)+"/15)",1),C("div",Mt,[(a(!0),S(oe,null,ie(g.value,(H,v)=>(a(),S("div",{key:H.id||H.uid,class:we(["image-item",{"primary-image":v===0}])},[C("div",Pt,[C("img",{src:H.full_url||H.url||H.thumbUrl,alt:H.image_name||H.name,onClick:o=>N(v)},null,8,At),C("div",Vt,[v===0?(a(),f(q,{key:0,color:"gold",size:"small"},{default:e(()=>I[5]||(I[5]=[i("主图")])),_:1,__:[5]})):V("",!0),C("span",qt,k(v+1),1)])]),C("div",jt,[t(te,null,{default:e(()=>[t(O,{type:"link",size:"small",onClick:o=>y(v),disabled:v===0},{default:e(()=>[t(M(Qe))]),_:2},1032,["onClick","disabled"]),t(O,{type:"link",size:"small",onClick:o=>_(v),disabled:v===g.value.length-1},{default:e(()=>[t(M(Ge))]),_:2},1032,["onClick","disabled"]),t($,{title:"确定要删除这张图片吗？",onConfirm:o=>b(v)},{default:e(()=>[t(O,{type:"link",size:"small",danger:""},{default:e(()=>[t(M(We))]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),H.status==="uploading"?(a(),S("div",Bt,[t(W,{percent:H.percent,size:"small"},null,8,["percent"])])):V("",!0)],2))),128))])])):(a(),S("div",Ht,[t(Z,{description:"暂无图片，请上传房间图片"})])),t(se,{visible:B.value,"onUpdate:visible":I[1]||(I[1]=H=>B.value=H),current:w.value,onChange:le},{default:e(()=>[(a(!0),S(oe,null,ie(g.value,H=>(a(),f(K,{key:H.id||H.uid,src:H.full_url||H.url||H.thumbUrl,style:{display:"none"}},null,8,["src"]))),128))]),_:1},8,["visible","current"])])]),_:1},8,["open","confirm-loading"])}}},Ft=ge(Lt,[["__scopeId","data-v-102c87e4"]]);const Et={class:"room-management"},Tt={class:"page-header"},Yt={class:"header-content"},Nt={class:"header-actions"},Jt={class:"filter-section"},Qt={key:0,class:"batch-actions"},Gt={class:"table-section"},Wt={key:0,class:"room-name"},Kt={class:"room-meta"},Xt={class:"capacity"},Zt={key:1,class:"store-info"},ea={class:"company-name"},ta={__name:"RoomManagement",props:{storeId:{type:String,default:null}},setup(s){const n=s,l=je(),U=x(!1),D=x([]),g=x([]),P=x(!1),B=x(!1),w=x(!1),L=x(!1),R=x("create"),Y=x(null),J=x([]),Q=x(""),b=fe({store_id:n.storeId||null,room_type:null,status:null,keyword:""}),y=de(()=>{const v=[{title:"房间名称",dataIndex:"name",key:"name",width:200},{title:"容量",dataIndex:"capacity",key:"capacity",width:80},{title:"图片",dataIndex:"image_count",key:"image_count",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:200}];return n.storeId||v.splice(1,0,{title:"所属门店",dataIndex:"store_name",key:"store_name",width:150}),v}),_=fe({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:v=>`共 ${v} 条记录`}),N=de(()=>({selectedRowKeys:J.value,onChange:v=>{J.value=v}})),le=async()=>{try{U.value=!0;const v={...b};Object.keys(v).forEach(A=>{v[A]||delete v[A]});const o=await ne.getRoomList(v);D.value=o.data||[],_.total=D.value.length}catch(v){j.error("获取房间列表失败："+(v.message||"未知错误"))}finally{U.value=!1}},T=async()=>{if(!n.storeId)try{const v=await ne.getAvailableStores();g.value=v.data||[]}catch(v){console.error("获取可选门店列表失败:",v)}},G=()=>{le(),T()},m=()=>{_.current=1,le()},I=v=>{_.current=v.current,_.pageSize=v.pageSize},c=()=>{R.value="create",Y.value=null,P.value=!0},d=v=>{R.value="edit",Y.value=v,P.value=!0},q=()=>{B.value=!0},O=v=>{Y.value=v,w.value=!0},$=v=>{Y.value=v,L.value=!0},te=()=>{P.value=!1,G()},W=()=>{B.value=!1,G()},Z=async v=>{try{await ne.deleteRoom(v.id),j.success("房间删除成功"),G()}catch(o){j.error("删除失败："+(o.message||"未知错误"))}},K=async()=>{try{await ne.batchOperation({operation:"updateStatus",room_ids:J.value,status:Q.value}),j.success("批量更新状态成功"),se(),G()}catch(v){j.error("批量更新失败："+(v.message||"未知错误"))}},se=()=>{J.value=[],Q.value=""},pe=v=>({剧本杀:"blue",密室:"green",混合:"orange"})[v]||"default",H=v=>({正常:"green",维护:"orange",关闭:"red"})[v]||"default";return ye(()=>n.storeId,v=>{b.store_id=v,G()},{immediate:!0}),$e(()=>{G()}),(v,o)=>{const A=u("a-button"),ae=u("a-select-option"),p=u("a-select"),r=u("a-col"),X=u("a-input"),ce=u("a-row"),E=u("a-space"),ue=u("a-tag"),be=u("a-popconfirm"),Ce=u("a-table");return a(),S("div",Et,[C("div",Tt,[C("div",Yt,[o[12]||(o[12]=C("h3",null,"房间管理",-1)),C("div",Nt,[M(l).hasPermission("room.create")?(a(),f(A,{key:0,type:"primary",onClick:c},{default:e(()=>[t(M(Se)),o[9]||(o[9]=i(" 新建房间 "))]),_:1,__:[9]})):V("",!0),M(l).hasPermission("room.create")?(a(),f(A,{key:1,onClick:q},{default:e(()=>[t(M(st)),o[10]||(o[10]=i(" 批量录入 "))]),_:1,__:[10]})):V("",!0),t(A,{onClick:G},{default:e(()=>[t(M(Be)),o[11]||(o[11]=i(" 刷新 "))]),_:1,__:[11]})])])]),C("div",Jt,[t(ce,{gutter:16},{default:e(()=>[s.storeId?V("",!0):(a(),f(r,{key:0,span:6},{default:e(()=>[t(p,{value:b.store_id,"onUpdate:value":o[0]||(o[0]=z=>b.store_id=z),placeholder:"选择门店","allow-clear":"",onChange:m,style:{width:"100%"}},{default:e(()=>[(a(!0),S(oe,null,ie(g.value,z=>(a(),f(ae,{key:z.id,value:z.id},{default:e(()=>[i(k(z.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})),t(r,{span:6},{default:e(()=>[t(p,{value:b.room_type,"onUpdate:value":o[1]||(o[1]=z=>b.room_type=z),placeholder:"房间类型","allow-clear":"",onChange:m,style:{width:"100%"}},{default:e(()=>[t(ae,{value:"剧本杀"},{default:e(()=>o[13]||(o[13]=[i("剧本杀")])),_:1,__:[13]}),t(ae,{value:"密室"},{default:e(()=>o[14]||(o[14]=[i("密室")])),_:1,__:[14]}),t(ae,{value:"混合"},{default:e(()=>o[15]||(o[15]=[i("混合")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),t(r,{span:6},{default:e(()=>[t(p,{value:b.status,"onUpdate:value":o[2]||(o[2]=z=>b.status=z),placeholder:"房间状态","allow-clear":"",onChange:m,style:{width:"100%"}},{default:e(()=>[t(ae,{value:"正常"},{default:e(()=>o[16]||(o[16]=[i("正常")])),_:1,__:[16]}),t(ae,{value:"维护"},{default:e(()=>o[17]||(o[17]=[i("维护")])),_:1,__:[17]}),t(ae,{value:"关闭"},{default:e(()=>o[18]||(o[18]=[i("关闭")])),_:1,__:[18]})]),_:1},8,["value"])]),_:1}),t(r,{span:6},{default:e(()=>[t(X,{value:b.keyword,"onUpdate:value":o[3]||(o[3]=z=>b.keyword=z),placeholder:"搜索房间名称",onChange:m},{prefix:e(()=>[t(M(He))]),_:1},8,["value"])]),_:1})]),_:1})]),J.value.length>0?(a(),S("div",Qt,[t(E,null,{default:e(()=>[C("span",null,"已选择 "+k(J.value.length)+" 项",1),t(p,{value:Q.value,"onUpdate:value":o[4]||(o[4]=z=>Q.value=z),placeholder:"批量设置状态",style:{width:"120px"}},{default:e(()=>[t(ae,{value:"正常"},{default:e(()=>o[19]||(o[19]=[i("正常")])),_:1,__:[19]}),t(ae,{value:"维护"},{default:e(()=>o[20]||(o[20]=[i("维护")])),_:1,__:[20]}),t(ae,{value:"关闭"},{default:e(()=>o[21]||(o[21]=[i("关闭")])),_:1,__:[21]})]),_:1},8,["value"]),t(A,{type:"primary",onClick:K,disabled:!Q.value},{default:e(()=>o[22]||(o[22]=[i(" 批量更新状态 ")])),_:1,__:[22]},8,["disabled"]),t(A,{onClick:se},{default:e(()=>o[23]||(o[23]=[i("取消选择")])),_:1,__:[23]})]),_:1})])):V("",!0),C("div",Gt,[t(Ce,{columns:y.value,"data-source":D.value,loading:U.value,pagination:_,"row-selection":N.value,"row-key":"id",onChange:I},{bodyCell:e(({column:z,record:ee})=>[z.key==="name"?(a(),S("div",Wt,[C("strong",null,k(ee.name),1),C("div",Kt,[t(ue,{size:"small",color:pe(ee.room_type)},{default:e(()=>[i(k(ee.room_type),1)]),_:2},1032,["color"]),C("span",Xt,k(ee.capacity)+"人",1)])])):z.key==="store_name"?(a(),S("div",Zt,[C("div",null,k(ee.store_name),1),C("small",ea,k(ee.company_name),1)])):z.key==="image_count"?(a(),f(A,{key:2,type:"link",size:"small",onClick:_e=>$(ee)},{default:e(()=>[i(k(ee.image_count||0)+"张 ",1)]),_:2},1032,["onClick"])):z.key==="status"?(a(),f(ue,{key:3,color:H(ee.status)},{default:e(()=>[i(k(ee.status),1)]),_:2},1032,["color"])):z.key==="action"?(a(),f(E,{key:4},{default:e(()=>[t(A,{type:"link",size:"small",onClick:_e=>O(ee)},{default:e(()=>o[24]||(o[24]=[i(" 查看 ")])),_:2,__:[24]},1032,["onClick"]),M(l).hasPermission("room.edit")?(a(),f(A,{key:0,type:"link",size:"small",onClick:_e=>d(ee)},{default:e(()=>o[25]||(o[25]=[i(" 编辑 ")])),_:2,__:[25]},1032,["onClick"])):V("",!0),M(l).hasPermission("room.manage")?(a(),f(A,{key:1,type:"link",size:"small",onClick:_e=>$(ee)},{default:e(()=>o[26]||(o[26]=[i(" 图片 ")])),_:2,__:[26]},1032,["onClick"])):V("",!0),M(l).hasPermission("room.delete")?(a(),f(be,{key:2,title:"确定要删除这个房间吗？",onConfirm:_e=>Z(ee)},{default:e(()=>[t(A,{type:"link",size:"small",danger:""},{default:e(()=>o[27]||(o[27]=[i(" 删除 ")])),_:1,__:[27]})]),_:2},1032,["onConfirm"])):V("",!0)]),_:2},1024)):V("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])]),t(ct,{visible:P.value,"onUpdate:visible":o[5]||(o[5]=z=>P.value=z),mode:R.value,"room-data":Y.value,"store-id":s.storeId,onSuccess:te},null,8,["visible","mode","room-data","store-id"]),t(gt,{visible:B.value,"onUpdate:visible":o[6]||(o[6]=z=>B.value=z),"store-id":s.storeId,onSuccess:W},null,8,["visible","store-id"]),t(St,{visible:w.value,"onUpdate:visible":o[7]||(o[7]=z=>w.value=z),"room-data":Y.value},null,8,["visible","room-data"]),t(Ft,{visible:L.value,"onUpdate:visible":o[8]||(o[8]=z=>L.value=z),"room-data":Y.value,onSuccess:G},null,8,["visible","room-data"])])}}},aa=ge(ta,[["__scopeId","data-v-64be48db"]]);const oa={class:"store-view"},la={class:"page-header"},sa={class:"header-content"},na={class:"header-actions"},ra={class:"filter-section"},ia={class:"table-section"},ua={key:0,class:"store-name"},da={class:"store-meta"},ca={key:1,class:"address-info"},ma={key:1},pa={key:1},_a={key:0,class:"store-detail"},va={key:0,class:"store-stats"},fa={key:0},ya={__name:"StoreView",setup(s){const n=je(),l=x(!1),U=x([]),D=x([]),g=x(!1),P=x(!1),B=x("create"),w=x(!1),L=x(!1),R=x(null),Y=x([]),J=x(),Q=x("info"),b=fe({company_id:null,keyword:"",is_active:void 0}),y=fe({company_id:null,name:"",address:"",is_active:!0}),_=de(()=>({company_id:n.isPlatformAdmin?[{required:!0,message:"请选择所属公司",trigger:"change"}]:[],name:[{required:!0,message:"请输入门店名称",trigger:"blur"},{min:1,max:255,message:"门店名称长度在1-255字符之间",trigger:"blur"}]})),N=[{title:"门店名称",dataIndex:"name",key:"name"},{title:"地址",dataIndex:"address",key:"address"},{title:"用户数量",dataIndex:"user_count",key:"user_count",width:100},{title:"房间数量",dataIndex:"room_count",key:"room_count",width:100},{title:"状态",dataIndex:"is_active",key:"is_active",width:80},{title:"操作",key:"action",width:200}],le=[{title:"姓名",dataIndex:"name",key:"name"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"角色",dataIndex:"role",key:"role"},{title:"账户级别",dataIndex:"account_level",key:"account_level"},{title:"主门店",dataIndex:"is_primary",key:"is_primary"}],T=fe({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:p=>`共 ${p} 条记录`}),G=de(()=>{let p=U.value;if(b.keyword){const r=b.keyword.toLowerCase();p=p.filter(X=>X.name.toLowerCase().includes(r)||X.address&&X.address.toLowerCase().includes(r))}return T.total=p.length,p}),m=async()=>{try{l.value=!0;const p={};n.isPlatformAdmin&&b.company_id&&(p.company_id=b.company_id),b.is_active!==void 0&&(p.is_active=b.is_active);const r=await me.getStoreList(p);U.value=r.data.stores||[]}catch(p){j.error("获取门店列表失败："+(p.message||"未知错误"))}finally{l.value=!1}},I=async()=>{try{const p=await me.getAvailableCompanies();D.value=p.data||[]}catch(p){console.error("获取可选公司列表失败:",p)}},c=()=>{m(),n.isPlatformAdmin&&I()},d=()=>{T.current=1,m()},q=p=>{T.current=p.current,T.pageSize=p.pageSize},O=()=>{B.value="create",te(),g.value=!0},$=p=>{B.value="edit",te(),Object.assign(y,{company_id:p.company_id,name:p.name,address:p.address,is_active:p.is_active}),R.value=p,g.value=!0},te=()=>{Object.assign(y,{company_id:n.isCompanyAdmin?n.companyId:null,name:"",address:"",is_active:!0}),J.value&&J.value.resetFields()},W=async()=>{try{await J.value.validate(),P.value=!0;const p={...y};n.isCompanyAdmin&&(p.company_id=n.companyId),B.value==="create"?(await me.createStore(p),j.success("门店创建成功")):(await me.updateStore(R.value.id,p),j.success("门店更新成功")),g.value=!1,m()}catch(p){if(p.errorFields)return;j.error("操作失败："+(p.message||"未知错误"))}finally{P.value=!1}},Z=()=>{g.value=!1,te()},K=async p=>{try{await me.deleteStore(p.id),j.success("门店删除成功"),m()}catch(r){j.error("删除失败："+(r.message||"未知错误"))}},se=async p=>{try{const r=await me.getStoreDetail(p.id);R.value=r.data,Q.value="info",w.value=!0}catch(r){j.error("获取门店详情失败："+(r.message||"未知错误"))}},pe=async p=>{try{const r=await me.getStoreUsers(p.id);Y.value=r.data.users||[],L.value=!0}catch(r){j.error("获取门店用户失败："+(r.message||"未知错误"))}},H=async p=>{try{const r=await me.getStoreDetail(p.id);R.value=r.data,Q.value="rooms",w.value=!0}catch(r){j.error("获取门店详情失败："+(r.message||"未知错误"))}},v=p=>n.isPlatformAdmin?!0:n.isCompanyAdmin?p.company_id===n.companyId:!1,o=p=>p?qe(p).format("YYYY-MM-DD HH:mm:ss"):"-",A=p=>({platform:"purple",company:"blue",store:"green"})[p]||"default",ae=p=>({platform:"平台级",company:"公司级",store:"门店级"})[p]||p;return $e(()=>{c()}),(p,r)=>{const X=u("a-button"),ce=u("a-select-option"),E=u("a-select"),ue=u("a-col"),be=u("a-input"),Ce=u("a-row"),z=u("a-tag"),ee=u("a-popconfirm"),_e=u("a-space"),ze=u("a-table"),ke=u("a-form-item"),Le=u("a-textarea"),Fe=u("a-switch"),Ee=u("a-form"),De=u("a-modal"),ve=u("a-descriptions-item"),Te=u("a-descriptions"),Ie=u("a-statistic"),Me=u("a-tab-pane"),Ye=u("a-tabs"),Ne=u("a-empty");return a(),S("div",oa,[C("div",la,[C("div",sa,[r[13]||(r[13]=C("h2",null,"门店管理",-1)),C("div",na,[M(n).hasPermission("store.create")&&(M(n).isPlatformAdmin||M(n).isCompanyAdmin)?(a(),f(X,{key:0,type:"primary",onClick:O},{default:e(()=>[t(M(Se)),r[11]||(r[11]=i(" 新建门店 "))]),_:1,__:[11]})):V("",!0),t(X,{onClick:c},{default:e(()=>[t(M(Be)),r[12]||(r[12]=i(" 刷新 "))]),_:1,__:[12]})])])]),C("div",ra,[t(Ce,{gutter:16},{default:e(()=>[M(n).isPlatformAdmin?(a(),f(ue,{key:0,span:6},{default:e(()=>[t(E,{value:b.company_id,"onUpdate:value":r[0]||(r[0]=h=>b.company_id=h),placeholder:"选择公司","allow-clear":"",onChange:d,style:{width:"100%"}},{default:e(()=>[(a(!0),S(oe,null,ie(D.value,h=>(a(),f(ce,{key:h.id,value:h.id},{default:e(()=>[i(k(h.name)+" ("+k(h.type)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):V("",!0),t(ue,{span:6},{default:e(()=>[t(be,{value:b.keyword,"onUpdate:value":r[1]||(r[1]=h=>b.keyword=h),placeholder:"搜索门店名称或地址",onChange:d},{prefix:e(()=>[t(M(He))]),_:1},8,["value"])]),_:1}),t(ue,{span:6},{default:e(()=>[t(E,{value:b.is_active,"onUpdate:value":r[2]||(r[2]=h=>b.is_active=h),placeholder:"选择状态","allow-clear":"",onChange:d,style:{width:"100%"}},{default:e(()=>[t(ce,{value:!0},{default:e(()=>r[14]||(r[14]=[i("正常")])),_:1,__:[14]}),t(ce,{value:!1},{default:e(()=>r[15]||(r[15]=[i("停用")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1})]),_:1})]),C("div",ia,[t(ze,{columns:N,"data-source":G.value,loading:l.value,pagination:T,"row-key":"id",onChange:q},{bodyCell:e(({column:h,record:F})=>[h.key==="name"?(a(),S("div",ua,[C("strong",null,k(F.name),1),C("div",da,[F.company_name?(a(),f(z,{key:0,size:"small",color:"blue"},{default:e(()=>[i(k(F.company_name),1)]),_:2},1024)):V("",!0)])])):h.key==="address"?(a(),S("div",ca,k(F.address||"未设置"),1)):h.key==="user_count"?(a(),S(oe,{key:2},[M(n).hasPermission("user.view")?(a(),f(X,{key:0,type:"link",size:"small",onClick:he=>pe(F)},{default:e(()=>[i(k(F.user_count||0)+"人 ",1)]),_:2},1032,["onClick"])):(a(),S("span",ma,k(F.user_count||0)+"人",1))],64)):h.key==="room_count"?(a(),S(oe,{key:3},[M(n).hasPermission("room.view")?(a(),f(X,{key:0,type:"link",size:"small",onClick:he=>H(F)},{default:e(()=>[i(k(F.room_count||0)+"间 ",1)]),_:2},1032,["onClick"])):(a(),S("span",pa,k(F.room_count||0)+"间",1))],64)):h.key==="is_active"?(a(),f(z,{key:4,color:F.is_active?"green":"red"},{default:e(()=>[i(k(F.is_active?"正常":"停用"),1)]),_:2},1032,["color"])):h.key==="action"?(a(),f(_e,{key:5},{default:e(()=>[t(X,{type:"link",size:"small",onClick:he=>se(F)},{default:e(()=>r[16]||(r[16]=[i(" 查看 ")])),_:2,__:[16]},1032,["onClick"]),M(n).hasPermission("room.view")?(a(),f(X,{key:0,type:"link",size:"small",onClick:he=>H(F)},{default:e(()=>r[17]||(r[17]=[i(" 房间管理 ")])),_:2,__:[17]},1032,["onClick"])):V("",!0),M(n).hasPermission("store.edit")&&v(F)?(a(),f(X,{key:1,type:"link",size:"small",onClick:he=>$(F)},{default:e(()=>r[18]||(r[18]=[i(" 编辑 ")])),_:2,__:[18]},1032,["onClick"])):V("",!0),M(n).hasPermission("store.delete")&&v(F)?(a(),f(ee,{key:2,title:"确定要删除这个门店吗？",onConfirm:he=>K(F)},{default:e(()=>[t(X,{type:"link",size:"small",danger:""},{default:e(()=>r[19]||(r[19]=[i(" 删除 ")])),_:1,__:[19]})]),_:2},1032,["onConfirm"])):V("",!0)]),_:2},1024)):V("",!0)]),_:1},8,["data-source","loading","pagination"])]),t(De,{open:g.value,"onUpdate:open":r[7]||(r[7]=h=>g.value=h),title:B.value==="create"?"新建门店":"编辑门店","confirm-loading":P.value,onOk:W,onCancel:Z,width:"600px"},{default:e(()=>[t(Ee,{ref_key:"formRef",ref:J,model:y,rules:_.value,layout:"vertical"},{default:e(()=>[M(n).isPlatformAdmin?(a(),f(ke,{key:0,label:"所属公司",name:"company_id"},{default:e(()=>[t(E,{value:y.company_id,"onUpdate:value":r[3]||(r[3]=h=>y.company_id=h),placeholder:"选择公司",disabled:B.value==="edit"},{default:e(()=>[(a(!0),S(oe,null,ie(D.value,h=>(a(),f(ce,{key:h.id,value:h.id},{default:e(()=>[i(k(h.name)+" ("+k(h.type)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})):M(n).isCompanyAdmin?(a(),f(ke,{key:1,label:"所属公司"},{default:e(()=>{var h;return[t(be,{value:((h=M(n).user)==null?void 0:h.company_name)||"当前公司",disabled:""},null,8,["value"]),r[20]||(r[20]=C("div",{class:"form-item-tip"},"门店将自动关联到您的公司",-1))]}),_:1,__:[20]})):V("",!0),t(ke,{label:"门店名称",name:"name"},{default:e(()=>[t(be,{value:y.name,"onUpdate:value":r[4]||(r[4]=h=>y.name=h),placeholder:"请输入门店名称"},null,8,["value"])]),_:1}),t(ke,{label:"门店地址",name:"address"},{default:e(()=>[t(Le,{value:y.address,"onUpdate:value":r[5]||(r[5]=h=>y.address=h),placeholder:"请输入门店地址",rows:3},null,8,["value"])]),_:1}),B.value==="edit"?(a(),f(ke,{key:2,label:"状态",name:"is_active"},{default:e(()=>[t(Fe,{checked:y.is_active,"onUpdate:checked":r[6]||(r[6]=h=>y.is_active=h),"checked-children":"正常","un-checked-children":"停用"},null,8,["checked"])]),_:1})):V("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirm-loading"]),t(De,{open:w.value,"onUpdate:open":r[9]||(r[9]=h=>w.value=h),title:"门店详情",footer:null,width:"1200px"},{default:e(()=>[R.value?(a(),S("div",_a,[t(Ye,{activeKey:Q.value,"onUpdate:activeKey":r[8]||(r[8]=h=>Q.value=h)},{default:e(()=>[t(Me,{key:"info",tab:"基本信息"},{default:e(()=>[t(Te,{column:2,bordered:""},{default:e(()=>[t(ve,{label:"门店名称"},{default:e(()=>[i(k(R.value.name),1)]),_:1}),t(ve,{label:"所属公司"},{default:e(()=>[i(k(R.value.company_name),1)]),_:1}),t(ve,{label:"门店地址",span:2},{default:e(()=>[i(k(R.value.address||"未设置"),1)]),_:1}),t(ve,{label:"时区"},{default:e(()=>[i(k(R.value.timezone),1)]),_:1}),t(ve,{label:"状态"},{default:e(()=>[t(z,{color:R.value.is_active?"green":"red"},{default:e(()=>[i(k(R.value.is_active?"正常":"停用"),1)]),_:1},8,["color"])]),_:1}),t(ve,{label:"创建时间",span:2},{default:e(()=>[i(k(o(R.value.created_at)),1)]),_:1})]),_:1}),R.value.stats?(a(),S("div",va,[r[21]||(r[21]=C("h4",null,"门店统计",-1)),t(Ce,{gutter:16},{default:e(()=>[t(ue,{span:6},{default:e(()=>[t(Ie,{title:"总用户数",value:R.value.stats.total_users},null,8,["value"])]),_:1}),t(ue,{span:6},{default:e(()=>[t(Ie,{title:"活跃用户",value:R.value.stats.active_users},null,8,["value"])]),_:1}),t(ue,{span:6},{default:e(()=>[t(Ie,{title:"门店级用户",value:R.value.stats.store_level_users},null,8,["value"])]),_:1}),t(ue,{span:6},{default:e(()=>[t(Ie,{title:"房间数量",value:R.value.room_count||0},null,8,["value"])]),_:1})]),_:1})])):V("",!0)]),_:1}),M(n).hasPermission("room.view")?(a(),f(Me,{key:"rooms",tab:"房间管理"},{default:e(()=>[t(aa,{"store-id":R.value.id},null,8,["store-id"])]),_:1})):V("",!0)]),_:1},8,["activeKey"])])):V("",!0)]),_:1},8,["open"]),t(De,{open:L.value,"onUpdate:open":r[10]||(r[10]=h=>L.value=h),title:"门店用户列表",footer:null,width:"800px"},{default:e(()=>[Y.value.length>0?(a(),S("div",fa,[t(ze,{columns:le,"data-source":Y.value,pagination:!1,size:"small"},{bodyCell:e(({column:h,record:F})=>[h.key==="role"?(a(),f(z,{key:0,color:"blue"},{default:e(()=>[i(k(F.role_display_name||F.role_name),1)]),_:2},1024)):h.key==="account_level"?(a(),f(z,{key:1,color:A(F.account_level)},{default:e(()=>[i(k(ae(F.account_level)),1)]),_:2},1032,["color"])):h.key==="is_primary"?(a(),S(oe,{key:2},[F.is_primary?(a(),f(z,{key:0,color:"gold"},{default:e(()=>r[22]||(r[22]=[i("主门店")])),_:1,__:[22]})):V("",!0)],64)):V("",!0)]),_:1},8,["data-source"])])):(a(),f(Ne,{key:1,description:"该门店暂无用户"}))]),_:1},8,["open"])])}}},wa=ge(ya,[["__scopeId","data-v-15e4bf0f"]]);export{wa as default};
